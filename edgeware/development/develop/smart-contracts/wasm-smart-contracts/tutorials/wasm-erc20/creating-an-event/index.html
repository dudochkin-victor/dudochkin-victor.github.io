<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Создание события | Dudochkin Victor </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="google-site-verification" content="Kepqb6k6uptlwngnHbBVJmqQtwNW8zfHyQBbTXLYAgA" />
    <meta name="yandex-verification" content="8e8bc73c2566b473" />
    <style>
    :root {
        /* Primary theme color */
        /* --primary-color: #121A26; */
        --primary-color: #0f1419;
        /* Primary theme text color */
        /* --primary-text-color: #121A26; */
        --primary-text-color: #0f1419;
        /* Primary theme link color */
        --primary-link-color: #053961;
        /* Secondary color: the background body color */
        --secondary-color: #F0F0F0;
        --secondary-text-color: #1C2834;
        /* Highlight text color of table of content */
        --toc-highlight-text-color: #053961;
    }
</style>
    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-47MMPLLY44"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-47MMPLLY44');
    </script>
    

    
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
    
        ym('87064264', "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true
        });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/87064264" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    
    
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/mdl.min.css">
    <link rel="stylesheet" href="https://dudochkin-victor.github.io/style.css">
    
    
</head>

<body>
    
<header class="box-shadow">
    

<a href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;">
    <div class="logo">
        <img src="https://dudochkin-victor.github.io/ferris.png" alt="logo">
        Dudochkin Victor
    </div>
</a>

<nav>
    <!-- 
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;showcases&#x2F;">Showcases</a>
    
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;changelog&#x2F;">Changelog</a>
    
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;about&#x2F;">About</a>
     -->

    
        
        <a class="nav-item subtitle-text" href="&#x2F;solana&#x2F;">Solana</a>
        
        <a class="nav-item subtitle-text" href="&#x2F;edgeware&#x2F;">Edgeware</a>
        
        <a class="nav-item subtitle-text" href="&#x2F;blog&#x2F;">Блог</a>
        
        <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;github.com&#x2F;dudochkin-victor">Github</a>
        
    
</nav>

</header>

 
    <main>
        
        
        
        
        
        <div class="toc">
            <div class="toc-sticky">
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/edgeware/development/develop/smart-contracts/wasm-smart-contracts/tutorials/wasm-erc20/creating-an-event/#obiavlenie-sobytii">Объявление событий </a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/edgeware/development/develop/smart-contracts/wasm-smart-contracts/tutorials/wasm-erc20/creating-an-event/#otpravka-sobytii">Отправка событий </a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/edgeware/development/develop/smart-contracts/wasm-smart-contracts/tutorials/wasm-erc20/creating-an-event/#tvoia-ochered">Твоя очередь!</a>
                </div>
                
                
            </div>
        </div>
        
        

        <div class="content text">
            
<h1>Создание события</h1>

<p>Напомним, что вызовы контрактов не могут напрямую возвращать значение во внешний мир при отправке транзакции. Однако часто нам нужно указать внешнему миру, что что-то произошло (например, произошла транзакция или было достигнуто определенное состояние). Мы можем предупредить других о том, что это произошло, используя <code>событие</code>.</p>
<h2 id="obiavlenie-sobytii">Объявление событий <a id="declaring-events"></a></h2>
<p>Событие может передавать произвольное количество данных, определенных аналогично <code>структуре</code>. События должны быть объявлены с использованием атрибута <code>#[ink(event)]</code>.</p>
<p>Например,</p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(event)]
</span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Transfer </span><span>{
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(topic)]
</span><span>    from</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;AccountId&gt;,
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(topic)]
</span><span>    to</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;AccountId&gt;,
</span><span>    value</span><span style="color:#bfbab0cc;">:</span><span> Balance,
</span><span>}
</span></code></pre>
<p>Это событие <code>Transfer</code> будет содержать три части данных: значение типа <code>Balance</code> и две переменные <code>AccountId</code>, заключенные в Option, указывающие на счета <code>from</code> и <code>to</code>. Для более быстрого доступа к данным о событиях они могут иметь <em>индексированные поля</em>. Мы можем сделать это, используя тег атрибута <code>#[ink(topic)]</code> в этом поле.</p>
<p>Одним из способов извлечения данных из переменной Option является использование функции <code>.unwrap_or()</code>. Вы можете вспомнить использование этого в функциях <code>my_value_or_zero()</code> и <code>balance_of_or_zero()</code> в этом проекте и проекте Incrementer.</p>
<h2 id="otpravka-sobytii">Отправка событий <a id="emitting-events"></a></h2>
<p>Теперь, когда мы определили, какие данные будут содержаться в событии и как их объявить, пришло время фактически генерировать некоторые события. Мы делаем это, вызывая <code>self.env().emit_event</code> и включаем событие в качестве единственного аргумента в вызов метода.</p>
<p>Помните, что поскольку поля «от» и «до» являются опциональными, мы не можем просто установить для них определенные значения. Предположим, мы хотим установить значение 100 для начального развертывателя. Это значение не получено ни от какой другой учетной записи, поэтому значение «от» должно быть «Нет».</p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span style="color:#f07178;">env</span><span>()
</span><span>    </span><span style="color:#f29668;">.</span><span style="color:#f07178;">emit_event</span><span>(
</span><span>        Transfer {
</span><span>            from</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>            to</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span style="color:#f07178;">env</span><span>()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">caller</span><span>())</span><span style="color:#bfbab0cc;">,
</span><span>            value</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">100</span><span style="color:#bfbab0cc;">,
</span><span>        })</span><span style="color:#bfbab0cc;">;
</span></code></pre>
<blockquote>
<p>Примечание: <strong><code>значение</code></strong> не нуждается в <strong><code>Some()</code></strong>, так как значение не хранится в <strong><code>Option</code></strong>.</p>
</blockquote>
<p>Мы хотим генерировать событие Transfer каждый раз, когда происходит передача. В шаблоне ERC-20, над которым мы работали, это происходит в двух местах: во-первых, во время «нового» вызова, а во-вторых, каждый раз, когда вызывается «transfer_from_to».</p>
<h2 id="tvoia-ochered">Твоя очередь!<a id="your-turn"></a></h2>
<p>Следуйте ДЕЙСТВИЯМ в коде шаблона, чтобы генерировать событие <code>Transfer</code> каждый раз, когда происходит передача токена.</p>
<p>Не забудьте запустить <code>cargo +nightly test</code>, чтобы проверить свою работу.</p>
<p>{% tabs %}
{% tab title=&quot;🔨Starting Point&quot; %}</p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#bfbab0cc;">#!</span><span>[</span><span style="color:#ffb454;">cfg_attr</span><span>(</span><span style="color:#ffb454;">not</span><span>(feature </span><span style="color:#f29668;">= </span><span style="color:#c2d94c;">&quot;std&quot;</span><span>)</span><span style="color:#bfbab0cc;">,</span><span> no_std)]
</span><span>
</span><span style="color:#ff7733;">use</span><span> ink_lang </span><span style="color:#f29668;">as</span><span> ink</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>::</span><span style="color:#ffb454;">contract</span><span>]
</span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">erc20 </span><span>{
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">cfg</span><span>(</span><span style="color:#ffb454;">not</span><span>(feature </span><span style="color:#f29668;">= </span><span style="color:#c2d94c;">&quot;ink-as-dependency&quot;</span><span>))]
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(storage)]
</span><span>    </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Erc20 </span><span>{
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// The total supply.
</span><span>        total_supply</span><span style="color:#bfbab0cc;">:</span><span> Balance,
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// The balance of each user.
</span><span>        balances</span><span style="color:#bfbab0cc;">: </span><span>ink_storage</span><span style="color:#f29668;">::</span><span>collections</span><span style="color:#f29668;">::</span><span>HashMap&lt;AccountId, Balance&gt;,
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(event)]
</span><span>    </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Transfer </span><span>{
</span><span>    </span><span style="font-style:italic;color:#5c6773;">//  ACTION: Create a `Transfer` event with:
</span><span>    </span><span style="font-style:italic;color:#5c6773;">//          * from: Option&lt;AccountId&gt;
</span><span>    </span><span style="font-style:italic;color:#5c6773;">//          * to: Option&lt;AccountId&gt;
</span><span>    </span><span style="font-style:italic;color:#5c6773;">//          * value: Balance
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">impl </span><span style="color:#59c2ff;">Erc20 </span><span>{
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(constructor)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">new</span><span>(</span><span style="color:#f29718;">initial_supply</span><span style="color:#bfbab0cc;">:</span><span> Balance) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span>            </span><span style="color:#ff7733;">let mut</span><span> balances </span><span style="color:#f29668;">= </span><span>ink_storage</span><span style="color:#f29668;">::</span><span>collections</span><span style="color:#f29668;">::</span><span>HashMap</span><span style="color:#f29668;">::</span><span>new()</span><span style="color:#bfbab0cc;">;
</span><span>            balances</span><span style="color:#f29668;">.</span><span style="color:#f07178;">insert</span><span>(</span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>env()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">caller</span><span>()</span><span style="color:#bfbab0cc;">,</span><span> initial_supply)</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// ACTION: Call `self.env().emit_event` with the `Transfer` event
</span><span>            </span><span style="font-style:italic;color:#5c6773;">//   HINT: Since we use `Option&lt;AccountId&gt;`, you need to wrap accounts in `Some()`
</span><span>
</span><span>            </span><span style="color:#ff7733;">Self </span><span>{
</span><span>                total_supply</span><span style="color:#bfbab0cc;">:</span><span> initial_supply</span><span style="color:#bfbab0cc;">,
</span><span>                balances
</span><span>            }
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(message)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">total_supply</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Balance {
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>total_supply
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(message)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">balance_of</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">owner</span><span style="color:#bfbab0cc;">:</span><span> AccountId) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Balance {
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span style="color:#f07178;">balance_of_or_zero</span><span>(</span><span style="color:#f29668;">&amp;</span><span>owner)
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(message)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">transfer</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">to</span><span style="color:#bfbab0cc;">:</span><span> AccountId, </span><span style="color:#f29718;">value</span><span style="color:#bfbab0cc;">:</span><span> Balance) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">bool </span><span>{
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span style="color:#f07178;">transfer_from_to</span><span>(</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span style="color:#f07178;">env</span><span>()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">caller</span><span>()</span><span style="color:#bfbab0cc;">,</span><span> to</span><span style="color:#bfbab0cc;">,</span><span> value)
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">transfer_from_to</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">from</span><span style="color:#bfbab0cc;">:</span><span> AccountId, </span><span style="color:#f29718;">to</span><span style="color:#bfbab0cc;">:</span><span> AccountId, </span><span style="color:#f29718;">value</span><span style="color:#bfbab0cc;">:</span><span> Balance) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">bool </span><span>{
</span><span>            </span><span style="color:#ff7733;">let</span><span> from_balance </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span style="color:#f07178;">balance_of_or_zero</span><span>(</span><span style="color:#f29668;">&amp;</span><span>from)</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#ff7733;">if</span><span> from_balance </span><span style="color:#f29668;">&lt;</span><span> value {
</span><span>                </span><span style="color:#ff7733;">return </span><span style="color:#f29718;">false
</span><span>            }
</span><span>
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// Update the sender&#39;s balance.
</span></code></pre>
<p>{% endtab %}</p>
<p>{% tab title=&quot;✅Potential Solution&quot; %}</p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#bfbab0cc;">#!</span><span>[</span><span style="color:#ffb454;">cfg_attr</span><span>(</span><span style="color:#ffb454;">not</span><span>(feature </span><span style="color:#f29668;">= </span><span style="color:#c2d94c;">&quot;std&quot;</span><span>)</span><span style="color:#bfbab0cc;">,</span><span> no_std)]
</span><span>
</span><span style="color:#ff7733;">use</span><span> ink_lang </span><span style="color:#f29668;">as</span><span> ink</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>::</span><span style="color:#ffb454;">contract</span><span>]
</span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">erc20 </span><span>{
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">cfg</span><span>(</span><span style="color:#ffb454;">not</span><span>(feature </span><span style="color:#f29668;">= </span><span style="color:#c2d94c;">&quot;ink-as-dependency&quot;</span><span>))]
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(storage)]
</span><span>    </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Erc20 </span><span>{
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// The total supply.
</span><span>        total_supply</span><span style="color:#bfbab0cc;">:</span><span> Balance,
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// The balance of each user.
</span><span>        balances</span><span style="color:#bfbab0cc;">: </span><span>ink_storage</span><span style="color:#f29668;">::</span><span>collections</span><span style="color:#f29668;">::</span><span>HashMap&lt;AccountId, Balance&gt;,
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(event)]
</span><span>    </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Transfer </span><span>{
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(topic)]
</span><span>        from</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;AccountId&gt;,
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(topic)]
</span><span>        to</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;AccountId&gt;,
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(topic)]
</span><span>        value</span><span style="color:#bfbab0cc;">:</span><span> Balance,
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">impl </span><span style="color:#59c2ff;">Erc20 </span><span>{
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(constructor)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">new</span><span>(</span><span style="color:#f29718;">initial_supply</span><span style="color:#bfbab0cc;">:</span><span> Balance) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span>            </span><span style="color:#ff7733;">let</span><span> caller </span><span style="color:#f29668;">= </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>env()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">caller</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#ff7733;">let mut</span><span> balances </span><span style="color:#f29668;">= </span><span>ink_storage</span><span style="color:#f29668;">::</span><span>collections</span><span style="color:#f29668;">::</span><span>HashMap</span><span style="color:#f29668;">::</span><span>new()</span><span style="color:#bfbab0cc;">;
</span><span>            balances</span><span style="color:#f29668;">.</span><span style="color:#f07178;">insert</span><span>(caller</span><span style="color:#bfbab0cc;">,</span><span> initial_supply)</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>            </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>env()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">emit_event</span><span>(Transfer {
</span><span>                from</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>                to</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(caller)</span><span style="color:#bfbab0cc;">,
</span><span>                value</span><span style="color:#bfbab0cc;">:</span><span> initial_supply</span><span style="color:#bfbab0cc;">,
</span><span>            })</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>            </span><span style="color:#ff7733;">Self </span><span>{
</span><span>                total_supply</span><span style="color:#bfbab0cc;">:</span><span> initial_supply</span><span style="color:#bfbab0cc;">,
</span><span>                balances
</span><span>            }
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(message)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">total_supply</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Balance {
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>total_supply
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(message)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">balance_of</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">owner</span><span style="color:#bfbab0cc;">:</span><span> AccountId) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Balance {
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span style="color:#f07178;">balance_of_or_zero</span><span>(</span><span style="color:#f29668;">&amp;</span><span>owner)
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(message)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">transfer</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">to</span><span style="color:#bfbab0cc;">:</span><span> AccountId, </span><span style="color:#f29718;">value</span><span style="color:#bfbab0cc;">:</span><span> Balance) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">bool </span><span>{
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span style="color:#f07178;">transfer_from_to</span><span>(</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span style="color:#f07178;">env</span><span>()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">caller</span><span>()</span><span style="color:#bfbab0cc;">,</span><span> to</span><span style="color:#bfbab0cc;">,</span><span> value)
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">transfer_from_to</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">from</span><span style="color:#bfbab0cc;">:</span><span> AccountId, </span><span style="color:#f29718;">to</span><span style="color:#bfbab0cc;">:</span><span> AccountId, </span><span style="color:#f29718;">value</span><span style="color:#bfbab0cc;">:</span><span> Balance) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">bool </span><span>{
</span><span>            </span><span style="color:#ff7733;">let</span><span> from_balance </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span style="color:#f07178;">balance_of_or_zero</span><span>(</span><span style="color:#f29668;">&amp;</span><span>from)</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#ff7733;">if</span><span> from_balance </span><span style="color:#f29668;">&lt;</span><span> value {
</span><span>                </span><span style="color:#ff7733;">return </span><span style="color:#f29718;">false
</span><span>            }
</span><span>
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// Update the sender&#39;s balance.
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>balances</span><span style="color:#f29668;">.</span><span style="color:#f07178;">insert</span><span>(from</span><span style="color:#bfbab0cc;">,</span><span> from_balance </span><span style="color:#f29668;">-</span><span> value)</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// Update the receiver&#39;s balance.
</span><span>            </span><span style="color:#ff7733;">let</span><span> to_balance </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span style="color:#f07178;">balance_of_or_zero</span><span>(</span><span style="color:#f29668;">&amp;</span><span>to)</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>balances</span><span style="color:#f29668;">.</span><span style="color:#f07178;">insert</span><span>(to</span><span style="color:#bfbab0cc;">,</span><span> to_balance </span><span style="color:#f29668;">+</span><span> value)</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span style="color:#f07178;">env</span><span>()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">emit_event</span><span>(Transfer {
</span><span>                from</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(from)</span><span style="color:#bfbab0cc;">,
</span><span>                to</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(to)</span><span style="color:#bfbab0cc;">,
</span><span>                value</span><span style="color:#bfbab0cc;">,
</span><span>            })</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>            </span><span style="color:#f29718;">true
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">balance_of_or_zero</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">owner</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29668;">&amp;</span><span>AccountId) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Balance {
</span><span>            </span><span style="color:#f29668;">*</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>balances</span><span style="color:#f29668;">.</span><span style="color:#f07178;">get</span><span>(owner)</span><span style="color:#f29668;">.</span><span style="color:#f07178;">unwrap_or</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">0</span><span>)
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">cfg</span><span>(test)]
</span><span>    </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">tests </span><span>{
</span><span>        </span><span style="color:#ff7733;">use super</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>        </span><span style="color:#ff7733;">use</span><span> ink_lang </span><span style="color:#f29668;">as</span><span> ink</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>::</span><span style="color:#ffb454;">test</span><span>]
</span><span>        </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">new_works</span><span>() {
</span><span>            </span><span style="color:#ff7733;">let</span><span> contract </span><span style="color:#f29668;">= </span><span>Erc20</span><span style="color:#f29668;">::</span><span>new(</span><span style="color:#f29718;">777</span><span>)</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#f07178;">assert_eq!</span><span>(contract</span><span style="color:#f29668;">.</span><span style="color:#f07178;">total_supply</span><span>()</span><span style="color:#bfbab0cc;">, </span><span style="color:#f29718;">777</span><span>)</span><span style="color:#bfbab0cc;">;
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>::</span><span style="color:#ffb454;">test</span><span>]
</span><span>        </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">balance_works</span><span>() {
</span><span>            </span><span style="color:#ff7733;">let</span><span> contract </span><span style="color:#f29668;">= </span><span>Erc20</span><span style="color:#f29668;">::</span><span>new(</span><span style="color:#f29718;">100</span><span>)</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#f07178;">assert_eq!</span><span>(contract</span><span style="color:#f29668;">.</span><span style="color:#f07178;">total_supply</span><span>()</span><span style="color:#bfbab0cc;">, </span><span style="color:#f29718;">100</span><span>)</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#f07178;">assert_eq!</span><span>(contract</span><span style="color:#f29668;">.</span><span style="color:#f07178;">balance_of</span><span>(AccountId</span><span style="color:#f29668;">::</span><span>from([</span><span style="color:#f29718;">0x1</span><span style="color:#bfbab0cc;">; </span><span style="color:#f29718;">32</span><span>]))</span><span style="color:#bfbab0cc;">, </span><span style="color:#f29718;">100</span><span>)</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#f07178;">assert_eq!</span><span>(contract</span><span style="color:#f29668;">.</span><span style="color:#f07178;">balance_of</span><span>(AccountId</span><span style="color:#f29668;">::</span><span>from([</span><span style="color:#f29718;">0x0</span><span style="color:#bfbab0cc;">; </span><span style="color:#f29718;">32</span><span>]))</span><span style="color:#bfbab0cc;">, </span><span style="color:#f29718;">0</span><span>)</span><span style="color:#bfbab0cc;">;
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>::</span><span style="color:#ffb454;">test</span><span>]
</span><span>        </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">transfer_works</span><span>() {
</span><span>            </span><span style="color:#ff7733;">let mut</span><span> contract </span><span style="color:#f29668;">= </span><span>Erc20</span><span style="color:#f29668;">::</span><span>new(</span><span style="color:#f29718;">100</span><span>)</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#f07178;">assert_eq!</span><span>(contract</span><span style="color:#f29668;">.</span><span style="color:#f07178;">balance_of</span><span>(AccountId</span><span style="color:#f29668;">::</span><span>from([</span><span style="color:#f29718;">0x1</span><span style="color:#bfbab0cc;">; </span><span style="color:#f29718;">32</span><span>]))</span><span style="color:#bfbab0cc;">, </span><span style="color:#f29718;">100</span><span>)</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#f07178;">assert!</span><span>(contract</span><span style="color:#f29668;">.</span><span style="color:#f07178;">transfer</span><span>(AccountId</span><span style="color:#f29668;">::</span><span>from([</span><span style="color:#f29718;">0x0</span><span style="color:#bfbab0cc;">; </span><span style="color:#f29718;">32</span><span>])</span><span style="color:#bfbab0cc;">, </span><span style="color:#f29718;">10</span><span>))</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#f07178;">assert_eq!</span><span>(contract</span><span style="color:#f29668;">.</span><span style="color:#f07178;">balance_of</span><span>(AccountId</span><span style="color:#f29668;">::</span><span>from([</span><span style="color:#f29718;">0x0</span><span style="color:#bfbab0cc;">; </span><span style="color:#f29718;">32</span><span>]))</span><span style="color:#bfbab0cc;">, </span><span style="color:#f29718;">10</span><span>)</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#f07178;">assert!</span><span>(</span><span style="color:#f29668;">!</span><span>contract</span><span style="color:#f29668;">.</span><span style="color:#f07178;">transfer</span><span>(AccountId</span><span style="color:#f29668;">::</span><span>from([</span><span style="color:#f29718;">0x0</span><span style="color:#bfbab0cc;">; </span><span style="color:#f29718;">32</span><span>])</span><span style="color:#bfbab0cc;">, </span><span style="color:#f29718;">100</span><span>))</span><span style="color:#bfbab0cc;">;
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre>
<p>{% endtab %}
{% endtabs %}</p>










<script src="https://giscus.app/client.js"
    data-repo="dudochkin-victor&#x2F;dudochkin-victor.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzNzgwNTYx"
    data-category="General"
    data-category-id="DIC_kwDOADmv0c4CAhvj"
    data-mapping="pathname"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-theme="light"
    data-lang="en"
    crossorigin="anonymous"
    async>
</script>



        </div>

        
        
    </main>

    
    <footer>
        <small class="subtext">
            <a href="https://angular-rust.github.io">Dudochkin Victor</a> © 2021
        </small>
    </footer>
    
</body>
<script>
    function highlightNav(heading) {
        let pathname = location.pathname;
        document.querySelectorAll(".toc a").forEach((item) => {
            item.classList.remove("active");
        });
        document.querySelector(".toc a[href$='" + pathname + "#" + heading + "']").classList.add("active");
    }

    let currentHeading = "";
    window.onscroll = function () {
        let h = document.querySelectorAll("h1,h2,h3,h4,h5,h6");
        let elementArr = [];

        h.forEach(item => {
            if (item.id !== "") {
                elementArr[item.id] = item.getBoundingClientRect().top;
            }
        });
        elementArr.sort();
        for (let key in elementArr) {
            if (!elementArr.hasOwnProperty(key)) {
                continue;
            }
            if (elementArr[key] > 0 && elementArr[key] < 300) {
                if (currentHeading !== key) {
                    highlightNav(key);
                    currentHeading = key;
                }
                break;
            }
        }
    }
</script>

</html>
