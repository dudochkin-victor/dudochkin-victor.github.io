<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Добавление функциональности | Dudochkin Victor </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="google-site-verification" content="Kepqb6k6uptlwngnHbBVJmqQtwNW8zfHyQBbTXLYAgA" />
    <meta name="yandex-verification" content="8e8bc73c2566b473" />
    <style>
    :root {
        /* Primary theme color */
        /* --primary-color: #121A26; */
        --primary-color: #0f1419;
        /* Primary theme text color */
        /* --primary-text-color: #121A26; */
        --primary-text-color: #0f1419;
        /* Primary theme link color */
        --primary-link-color: #053961;
        /* Secondary color: the background body color */
        --secondary-color: #F0F0F0;
        --secondary-text-color: #1C2834;
        /* Highlight text color of table of content */
        --toc-highlight-text-color: #053961;
    }
</style>
    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-47MMPLLY44"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-47MMPLLY44');
    </script>
    

    
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
    
        ym('87064264', "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true
        });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/87064264" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    
    
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/mdl.min.css">
    <link rel="stylesheet" href="https://dudochkin-victor.github.io/style.css">
    
    
</head>

<body>
    
<header class="box-shadow">
    

<a href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;">
    <div class="logo">
        <img src="https://dudochkin-victor.github.io/ferris.png" alt="logo">
        Dudochkin Victor
    </div>
</a>

<nav>
    <!-- 
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;showcases&#x2F;">Showcases</a>
    
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;changelog&#x2F;">Changelog</a>
    
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;about&#x2F;">About</a>
     -->

    
        
        <a class="nav-item subtitle-text" href="&#x2F;solana&#x2F;">Solana</a>
        
        <a class="nav-item subtitle-text" href="&#x2F;edgeware&#x2F;">Edgeware</a>
        
        <a class="nav-item subtitle-text" href="&#x2F;blog&#x2F;">Блог</a>
        
        <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;github.com&#x2F;dudochkin-victor">Github</a>
        
    
</nav>

</header>

 
    <main>
        
        
        
        
        
        <div class="toc">
            <div class="toc-sticky">
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/edgeware/contribute-and-engage/develop/edgeware-smart-contracts/wasm-ballot-contract/adding-functionality/#kontraktnaia-funktsional-nost">Контрактная функциональность </a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/edgeware/contribute-and-engage/develop/edgeware-smart-contracts/wasm-ballot-contract/adding-functionality/#tvoia-ochered">Твоя очередь! </a>
                </div>
                
                
            </div>
        </div>
        
        

        <div class="content text">
            
<h1>Добавление функциональности</h1>

<p>В этой части мы добавим функциональность в наш бюллетень, чтобы:</p>
<ul>
<li>Люди могут голосовать за предложения</li>
<li>Люди могут делегировать свои голоса</li>
<li>Председатель может назначать право голоса</li>
</ul>
<h3 id="kontraktnaia-funktsional-nost">Контрактная функциональность <a id="contract-functionality"></a></h3>
<p><strong>Конструктор:</strong></p>
<p>Давайте сначала обновим конструктор нашего контракта. Как вы можете видеть в примере кода справа, конструктор теперь принимает параметр <code>Option&lt;Vector&lt;String&gt;&gt;</code>. Конструктор ожидает на входе вектор строк. Нам нужно обновить конструктор, чтобы предоставленные имена предложений использовались для создания объектов «Предложение» и добавлялись в наше хранилище для бюллетеней. Чтобы проверить, предоставлен ли вектор, содержащий строки:</p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>    </span><span style="color:#ff7733;">if</span><span> proposal_name</span><span style="color:#f29668;">.</span><span style="color:#f07178;">is_some</span><span>() {
</span><span>        names </span><span style="color:#f29668;">=</span><span> proposal_name</span><span style="color:#f29668;">.</span><span style="color:#f07178;">unwrap</span><span>()
</span><span>        </span><span style="font-style:italic;color:#5c6773;">// do somethiing with names 
</span><span>
</span><span>    }
</span></code></pre>
<p><strong>Предоставить право голоса:</strong></p>
<p>В предыдущей части мы создали функцию, позволяющую пользователям добавлять себя в качестве избирателей. Мы инициализировали их структуру избирателя значением <code>voter.weight=0</code>, поскольку при создании избирателя он/она по умолчанию не имеет права голоса. Итак, давайте создадим функцию <code>give_voting_right</code>, которая позволит только председателю обновить вес до 1 для любого данного избирателя. Функция будет выглядеть примерно так:</p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>    </span><span style="font-style:italic;color:#5c6773;">// assuming that the caller is the chair person
</span><span>    </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">give_voting_right</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">voter_id</span><span style="color:#bfbab0cc;">:</span><span> AccountId) {
</span><span>        </span><span style="color:#ff7733;">let</span><span> voter_opt </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>voters</span><span style="color:#f29668;">.</span><span style="color:#f07178;">get_mut</span><span>(</span><span style="color:#f29668;">&amp;</span><span>voter_id)</span><span style="color:#bfbab0cc;">;
</span><span>        </span><span style="color:#ff7733;">if</span><span> voter_opt</span><span style="color:#f29668;">.</span><span style="color:#f07178;">is_some</span><span>() {
</span><span>            </span><span style="color:#ff7733;">let</span><span> voter </span><span style="color:#f29668;">=</span><span> voter</span><span style="color:#f29668;">.</span><span style="color:#f07178;">unwrap</span><span>()
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// assuming that the voter has not already voted
</span><span>            voter</span><span style="color:#f29668;">.</span><span>weight </span><span style="color:#f29668;">= </span><span style="color:#f29718;">1
</span><span>        }
</span><span>    }
</span></code></pre>
<p><strong>Голосование:</strong></p>
<p>Теперь давайте реализуем функцию, которая позволит пользователям отдавать свои голоса. Эта функция будет принимать индекс предложения в качестве входных данных. Если «вызывающий» является действительным избирателем и еще не отдал свой голос, обновите предложение в индексе «i» с весом избирателя, обновите «voter.voted» до «истина» и установите «voter.vote» на индекс <code>и</code>.</p>
<p><strong>Получить выигрышное предложение:</strong></p>
<p>Теперь, когда голоса поданы, мы реализуем функцию, которая получит имя выигравшего предложения. На повторных выборах победитель объявляется по истечении времени голосования. Мы оставим вам такую реализацию. На данный момент мы позволим любому пользователю вызывать эту функцию и получать имя выигравшего предложения. Давайте реализуем функцию для возврата индекса предложения с максимальным количеством голосов:</p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">winning_proposal</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;</span><span style="color:#ff7733;">usize</span><span>&gt; {
</span><span>        </span><span style="color:#ff7733;">let mut</span><span> winning_vote_vount</span><span style="color:#bfbab0cc;">:</span><span style="color:#ff7733;">u32 </span><span style="color:#f29668;">= </span><span style="color:#f29718;">0</span><span style="color:#bfbab0cc;">;
</span><span>        </span><span style="color:#ff7733;">let mut</span><span> winning_index</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;</span><span style="color:#ff7733;">usize</span><span>&gt; </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">;
</span><span>        </span><span style="color:#ff7733;">let mut</span><span> index</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">usize </span><span style="color:#f29668;">= </span><span style="color:#f29718;">0</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>        </span><span style="color:#ff7733;">for</span><span> val </span><span style="color:#f29668;">in </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>proposals</span><span style="color:#f29668;">.</span><span style="color:#f07178;">iter</span><span>() {
</span><span>            </span><span style="color:#ff7733;">if</span><span> val</span><span style="color:#f29668;">.</span><span>vote_count </span><span style="color:#f29668;">&gt;</span><span> winning_vote_vount {
</span><span>                winning_vote_vount </span><span style="color:#f29668;">=</span><span> val</span><span style="color:#f29668;">.</span><span>vote_count</span><span style="color:#bfbab0cc;">;
</span><span>                winning_index </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(index)</span><span style="color:#bfbab0cc;">;
</span><span>            }
</span><span>            index </span><span style="color:#f29668;">+= </span><span style="color:#f29718;">1
</span><span>
</span><span>        }
</span><span>        </span><span style="color:#ff7733;">return</span><span> winning_index
</span><span>    }
</span></code></pre>
<p>Обратите внимание, что эта функция возвращает <code>Option&lt;usize&gt;</code>, а не <code>usize</code>, так как возможно, что в бюллетене нет предложений. Эту функцию можно использовать для поиска названия выигравшего предложения.</p>
<p><strong>Делегация:</strong></p>
<p>В нашей структуре избирателя есть поле <code>делегата</code>, определенное как <code>Option&lt;AccountId&gt;</code>, позволяющее избирателям делегировать свой голос кому-то другому. Этого можно добиться с помощью следующей функции:</p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(message)]
</span><span>    </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">delegate</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">to</span><span style="color:#bfbab0cc;">:</span><span> AccountId)  {
</span><span>
</span><span>        </span><span style="font-style:italic;color:#5c6773;">// account id of the person who invoked the function
</span><span>        </span><span style="color:#ff7733;">let</span><span> sender_id </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span style="color:#f07178;">env</span><span>()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">caller</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>        </span><span style="color:#ff7733;">let</span><span> sender_weight</span><span style="color:#bfbab0cc;">;
</span><span>        </span><span style="font-style:italic;color:#5c6773;">// self delegation is not allowd
</span><span>        </span><span style="color:#f07178;">assert_ne!</span><span>(to</span><span style="color:#bfbab0cc;">,</span><span>sender_id</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;Self-delegation is disallowed.&quot;</span><span>)</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>        {
</span><span>            </span><span style="color:#ff7733;">let</span><span> sender_opt </span><span style="color:#f29668;">=  </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>voters</span><span style="color:#f29668;">.</span><span style="color:#f07178;">get_mut</span><span>(</span><span style="color:#f29668;">&amp;</span><span>sender_id)</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// the voter invoking the function should exist in our ballot
</span><span>            </span><span style="color:#f07178;">assert_eq!</span><span>(sender_opt</span><span style="color:#f29668;">.</span><span style="color:#f07178;">is_some</span><span>()</span><span style="color:#bfbab0cc;">,</span><span style="color:#f29718;">true</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;Caller is not a valid voter&quot;</span><span>)</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#ff7733;">let</span><span> sender </span><span style="color:#f29668;">=</span><span> sender_opt</span><span style="color:#f29668;">.</span><span style="color:#f07178;">unwrap</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// the voter must not have already casted their vote
</span><span>            </span><span style="color:#f07178;">assert_eq!</span><span>(sender</span><span style="color:#f29668;">.</span><span>voted</span><span style="color:#bfbab0cc;">,</span><span style="color:#f29718;">false</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;You have already voted&quot;</span><span>)</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>            sender</span><span style="color:#f29668;">.</span><span>voted </span><span style="color:#f29668;">= </span><span style="color:#f29718;">true</span><span style="color:#bfbab0cc;">;
</span><span>            sender</span><span style="color:#f29668;">.</span><span>delegate </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(to)</span><span style="color:#bfbab0cc;">;
</span><span>            sender_weight </span><span style="color:#f29668;">=</span><span> sender</span><span style="color:#f29668;">.</span><span>weight</span><span style="color:#bfbab0cc;">;
</span><span>        }
</span><span>
</span><span>        {
</span><span>            </span><span style="color:#ff7733;">let</span><span> delegate_opt </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>voters</span><span style="color:#f29668;">.</span><span style="color:#f07178;">get_mut</span><span>(</span><span style="color:#f29668;">&amp;</span><span>to)</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// the person to whom the vote is being delegated must be a valid voter
</span><span>            </span><span style="color:#f07178;">assert_eq!</span><span>(delegate_opt</span><span style="color:#f29668;">.</span><span style="color:#f07178;">is_some</span><span>()</span><span style="color:#bfbab0cc;">,</span><span style="color:#f29718;">true</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;The delegated address is not valid&quot;</span><span>)</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>            </span><span style="color:#ff7733;">let</span><span> delegate </span><span style="color:#f29668;">=</span><span> delegate_opt</span><span style="color:#f29668;">.</span><span style="color:#f07178;">unwrap</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// the voter should not have already voted
</span><span>            </span><span style="color:#ff7733;">if</span><span> delegate</span><span style="color:#f29668;">.</span><span>voted {
</span><span>                </span><span style="font-style:italic;color:#5c6773;">// If the delegate already voted,
</span><span>                </span><span style="font-style:italic;color:#5c6773;">// directly add to the number of votes
</span><span>                </span><span style="color:#ff7733;">let</span><span> voted_to </span><span style="color:#f29668;">=</span><span> delegate</span><span style="color:#f29668;">.</span><span>vote</span><span style="color:#f29668;">.</span><span style="color:#f07178;">unwrap</span><span>() </span><span style="color:#f29668;">as </span><span style="color:#ff7733;">usize</span><span style="color:#bfbab0cc;">;
</span><span>                </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>proposals[voted_to]</span><span style="color:#f29668;">.</span><span>vote_count </span><span style="color:#f29668;">+=</span><span> sender_weight</span><span style="color:#bfbab0cc;">;
</span><span>            } </span><span style="color:#ff7733;">else </span><span>{
</span><span>                </span><span style="font-style:italic;color:#5c6773;">// If the delegate did not vote yet,
</span><span>                </span><span style="font-style:italic;color:#5c6773;">// add to her weight.
</span><span>                delegate</span><span style="color:#f29668;">.</span><span>weight </span><span style="color:#f29668;">+=</span><span> sender_weight</span><span style="color:#bfbab0cc;">;
</span><span>            }
</span><span>        }
</span><span>    }
</span></code></pre>
<p>Вы увидите, что в приведенной выше функции делегирования мы обновляем поля <code>sender.voted</code> и <code>sender.delegate</code> перед проверкой, является ли делегируемое лицо действительным избирателем. Функция запаникует, если делегированное лицо не является действительным избирателем, и отменит изменения, внесенные в поля <code>sender.voted</code> и <code>sender.delegate</code>.</p>
<h2 id="tvoia-ochered">Твоя очередь! <a id="your-turn"></a></h2>
<p>На этом урок заканчивается. Практикуйте полученные знания с помощью следующих упражнений:</p>
<ul>
<li>Обновите функцию «конструктор», чтобы при указании вектора имен предложений создавался новый объект предложения и добавлялся в «ballot.proposal».</li>
<li>Определите функцию <code>give_voting_right</code> в соответствии с инструкциями.</li>
<li>Добавьте функцию «голосования» и обновите бюллетень в соответствии с требованиями шаблона.</li>
<li>Обновите функциональность <code>get_winning_proposal_name</code>, чтобы вернуть имя выигравшего предложения.</li>
</ul>
<p>{% tabs %}
{% tab title=&quot;🔨Starting Point&quot; %}</p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#bfbab0cc;">#!</span><span>[</span><span style="color:#ffb454;">cfg_attr</span><span>(</span><span style="color:#ffb454;">not</span><span>(feature </span><span style="color:#f29668;">= </span><span style="color:#c2d94c;">&quot;std&quot;</span><span>)</span><span style="color:#bfbab0cc;">,</span><span> no_std)]
</span><span>
</span><span style="color:#ff7733;">use</span><span> ink_lang </span><span style="color:#f29668;">as</span><span> ink</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>::</span><span style="color:#ffb454;">contract</span><span>]    
</span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">ballot </span><span>{
</span><span>    </span><span style="font-style:italic;color:#5c6773;">// use Hash
</span><span>    </span><span style="color:#ff7733;">use </span><span>ink_storage</span><span style="color:#f29668;">::</span><span>collections</span><span style="color:#f29668;">::</span><span>HashMap</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#ff7733;">use </span><span>ink_prelude</span><span style="color:#f29668;">::</span><span>vec</span><span style="color:#f29668;">::</span><span>Vec</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#ff7733;">use </span><span>ink_storage</span><span style="color:#f29668;">::</span><span>traits</span><span style="color:#f29668;">::</span><span>{PackedLayout</span><span style="color:#bfbab0cc;">,</span><span> SpreadLayout}</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>    </span><span style="font-style:italic;color:#5c6773;">// Structure to store Proposal information
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Clone</span><span style="color:#bfbab0cc;">,</span><span> Debug</span><span style="color:#bfbab0cc;">,</span><span> scale::Encode</span><span style="color:#bfbab0cc;">,</span><span> scale::Decode</span><span style="color:#bfbab0cc;">,</span><span> SpreadLayout</span><span style="color:#bfbab0cc;">,</span><span> PackedLayout</span><span style="color:#bfbab0cc;">,</span><span>scale_info::TypeInfo)]
</span><span>    </span><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">Proposal </span><span>{
</span><span>        name</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>        vote_count</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">u32</span><span>, 
</span><span>    }
</span><span>
</span><span>    </span><span style="font-style:italic;color:#5c6773;">// Structure to store Proposal information
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Clone</span><span style="color:#bfbab0cc;">,</span><span> Debug</span><span style="color:#bfbab0cc;">,</span><span> scale::Encode</span><span style="color:#bfbab0cc;">,</span><span> scale::Decode</span><span style="color:#bfbab0cc;">,</span><span> SpreadLayout</span><span style="color:#bfbab0cc;">,</span><span> PackedLayout</span><span style="color:#bfbab0cc;">,</span><span>scale_info::TypeInfo)]
</span><span>    </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Voter </span><span>{
</span><span>        weight</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">u32</span><span>,
</span><span>        voted</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">bool</span><span>,
</span><span>        delegate</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;AccountId&gt;, 
</span><span>        vote</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;</span><span style="color:#ff7733;">i32</span><span>&gt;, 
</span><span>    }
</span><span>
</span><span>    </span><span style="font-style:italic;color:#5c6773;">/// Defines the storage of your contract.
</span><span>    </span><span style="font-style:italic;color:#5c6773;">/// Add new fields to the below struct in order
</span><span>    </span><span style="font-style:italic;color:#5c6773;">/// to add new static storage fields to your contract.
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(storage)]
</span><span>    </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Ballot </span><span>{
</span><span>        chair_person</span><span style="color:#bfbab0cc;">:</span><span> AccountId,
</span><span>        voters</span><span style="color:#bfbab0cc;">: </span><span>HashMap&lt;AccountId, Voter&gt;,
</span><span>        proposals</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Proposal&gt;    
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">impl </span><span style="color:#59c2ff;">Ballot </span><span>{
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(constructor)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">new</span><span>(</span><span style="color:#f29718;">proposal_names</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;</span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;</span><span style="font-style:italic;color:#39bae6;">String</span><span>&gt;&gt; ) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span>
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// get chair person address
</span><span>            </span><span style="color:#ff7733;">let</span><span> chair_person </span><span style="color:#f29668;">=  </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>env()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">caller</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// create empty propsal and voters
</span><span>            </span><span style="color:#ff7733;">let mut</span><span> proposals</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Proposal&gt; </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">Vec</span><span style="color:#f29668;">::</span><span>new()</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#ff7733;">let mut</span><span> voters </span><span style="color:#f29668;">= </span><span>HashMap</span><span style="color:#f29668;">::</span><span>new()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// initialize chair person&#39;s vote
</span><span>            voters</span><span style="color:#f29668;">.</span><span style="color:#f07178;">insert</span><span>(chair_person</span><span style="color:#bfbab0cc;">,</span><span> Voter{
</span><span>                weight</span><span style="color:#bfbab0cc;">:</span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">,
</span><span>                voted</span><span style="color:#bfbab0cc;">:</span><span style="color:#f29718;">false</span><span style="color:#bfbab0cc;">,
</span><span>                delegate</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>                vote</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>            })</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// ACTION : Check if proposal names are provided.
</span><span>            </span><span style="font-style:italic;color:#5c6773;">//        * If yes then create and push proposal objects to proposals vector
</span><span>
</span><span>
</span><span>            </span><span style="color:#ff7733;">Self </span><span>{
</span><span>                chair_person</span><span style="color:#bfbab0cc;">,
</span><span>                voters</span><span style="color:#bfbab0cc;">,
</span><span>                proposals</span><span style="color:#bfbab0cc;">,
</span><span>            }
</span><span>        }
</span><span>
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// default constrcutor
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(constructor)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">default</span><span>() </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span>            </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>new(</span><span style="font-style:italic;color:#39bae6;">Default</span><span style="color:#f29668;">::</span><span>default())
</span><span>        }
</span><span>
</span><span>
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(message)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">get_chairperson</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> AccountId {
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>chair_person
</span><span>        }
</span><span>
</span><span>
</span><span>
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">get_voter</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">voter_id</span><span style="color:#bfbab0cc;">:</span><span> AccountId) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;</span><span style="color:#f29668;">&amp;</span><span>Voter&gt;{
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>voters</span><span style="color:#f29668;">.</span><span style="color:#f07178;">get</span><span>(</span><span style="color:#f29668;">&amp;</span><span>voter_id)
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">get_voter_count</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">usize</span><span>{
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>voters</span><span style="color:#f29668;">.</span><span style="color:#f07178;">len</span><span>() </span><span style="color:#f29668;">as </span><span style="color:#ff7733;">usize
</span><span>        }
</span><span>
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// the function adds the provided voter id into possible
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// list of voters. By default the voter has no voting right,
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// the contract owner must approve the voter before he can cast a vote
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(message)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">add_voter</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">voter_id</span><span style="color:#bfbab0cc;">:</span><span> AccountId) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">bool</span><span>{
</span><span>
</span><span>            </span><span style="color:#ff7733;">let</span><span> voter_opt </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>voters</span><span style="color:#f29668;">.</span><span style="color:#f07178;">get</span><span>(</span><span style="color:#f29668;">&amp;</span><span>voter_id)</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// the voter does not exists
</span><span>            </span><span style="color:#ff7733;">if</span><span> voter_opt</span><span style="color:#f29668;">.</span><span style="color:#f07178;">is_some</span><span>() {
</span><span>                </span><span style="color:#ff7733;">return </span><span style="color:#f29718;">false
</span><span>            }
</span><span>
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>voters</span><span style="color:#f29668;">.</span><span style="color:#f07178;">insert</span><span>(voter_id</span><span style="color:#bfbab0cc;">,</span><span> Voter{
</span><span>                weight</span><span style="color:#bfbab0cc;">:</span><span style="color:#f29718;">0</span><span style="color:#bfbab0cc;">,
</span><span>                voted</span><span style="color:#bfbab0cc;">:</span><span style="color:#f29718;">false</span><span style="color:#bfbab0cc;">,
</span><span>                delegate</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>                vote</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>            })</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#ff7733;">return </span><span style="color:#f29718;">true
</span><span>        }
</span><span>
</span><span>
</span><span>
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// given an index returns the name of the proposal at that index
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">get_proposal_name_at_index</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">index</span><span style="color:#bfbab0cc;">:</span><span style="color:#ff7733;">usize</span><span>) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#f29668;">&amp;</span><span>String {
</span><span>            </span><span style="color:#ff7733;">let</span><span> proposal </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>proposals</span><span style="color:#f29668;">.</span><span style="color:#f07178;">get</span><span>(index)</span><span style="color:#f29668;">.</span><span style="color:#f07178;">unwrap</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#ff7733;">return </span><span style="color:#f29668;">&amp;</span><span>proposal</span><span style="color:#f29668;">.</span><span>name
</span><span>        }
</span><span>
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// returns the number of proposals in ballet
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">get_proposal_count</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">usize </span><span>{
</span><span>            </span><span style="color:#ff7733;">return </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>proposals</span><span style="color:#f29668;">.</span><span style="color:#f07178;">len</span><span>()
</span><span>        }
</span><span>
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// adds the given proposal name in ballet
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// to do: check unqiueness of proposal,
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">add_proposal</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">proposal_name</span><span style="color:#bfbab0cc;">:</span><span> String){
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>proposals</span><span style="color:#f29668;">.</span><span style="color:#f07178;">push</span><span>(
</span><span>                Proposal{
</span><span>                    name</span><span style="color:#bfbab0cc;">:</span><span style="font-style:italic;color:#39bae6;">String</span><span style="color:#f29668;">::</span><span>from(proposal_name)</span><span style="color:#bfbab0cc;">,
</span><span>                    vote_count</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">0</span><span style="color:#bfbab0cc;">,
</span><span>            })</span><span style="color:#bfbab0cc;">;
</span><span>        }
</span><span>
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// Give `voter` the right to vote on this ballot.
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// Should only be called by `chairperson`.
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(message)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">give_voting_right</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">voter_id</span><span style="color:#bfbab0cc;">:</span><span> AccountId) {
</span><span>            </span><span style="color:#ff7733;">let</span><span> caller </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span style="color:#f07178;">env</span><span>()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">caller</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#ff7733;">let</span><span> voter_opt </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>voters</span><span style="color:#f29668;">.</span><span style="color:#f07178;">get_mut</span><span>(</span><span style="color:#f29668;">&amp;</span><span>voter_id)</span><span style="color:#bfbab0cc;">;
</span></code></pre>
<p>{% endtab %}</p>
<p>{% tab title=&quot;✅Potential Solution&quot; %}</p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#bfbab0cc;">#!</span><span>[</span><span style="color:#ffb454;">cfg_attr</span><span>(</span><span style="color:#ffb454;">not</span><span>(feature </span><span style="color:#f29668;">= </span><span style="color:#c2d94c;">&quot;std&quot;</span><span>)</span><span style="color:#bfbab0cc;">,</span><span> no_std)]
</span><span>
</span><span style="color:#ff7733;">use</span><span> ink_lang </span><span style="color:#f29668;">as</span><span> ink</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>::</span><span style="color:#ffb454;">contract</span><span>]    
</span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">ballot </span><span>{
</span><span>    </span><span style="font-style:italic;color:#5c6773;">// use Hash
</span><span>    </span><span style="color:#ff7733;">use </span><span>ink_storage</span><span style="color:#f29668;">::</span><span>collections</span><span style="color:#f29668;">::</span><span>HashMap</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#ff7733;">use </span><span>ink_prelude</span><span style="color:#f29668;">::</span><span>vec</span><span style="color:#f29668;">::</span><span>Vec</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#ff7733;">use </span><span>ink_storage</span><span style="color:#f29668;">::</span><span>traits</span><span style="color:#f29668;">::</span><span>{PackedLayout</span><span style="color:#bfbab0cc;">,</span><span> SpreadLayout}</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>    </span><span style="font-style:italic;color:#5c6773;">// Structure to store Proposal information
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Clone</span><span style="color:#bfbab0cc;">,</span><span> Debug</span><span style="color:#bfbab0cc;">,</span><span> scale::Encode</span><span style="color:#bfbab0cc;">,</span><span> scale::Decode</span><span style="color:#bfbab0cc;">,</span><span> SpreadLayout</span><span style="color:#bfbab0cc;">,</span><span> PackedLayout</span><span style="color:#bfbab0cc;">,</span><span>scale_info::TypeInfo)]
</span><span>    </span><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">Proposal </span><span>{
</span><span>        name</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>        vote_count</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">u32</span><span>, 
</span><span>    }
</span><span>
</span><span>    </span><span style="font-style:italic;color:#5c6773;">// Structure to store Proposal information
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Clone</span><span style="color:#bfbab0cc;">,</span><span> Debug</span><span style="color:#bfbab0cc;">,</span><span> scale::Encode</span><span style="color:#bfbab0cc;">,</span><span> scale::Decode</span><span style="color:#bfbab0cc;">,</span><span> SpreadLayout</span><span style="color:#bfbab0cc;">,</span><span> PackedLayout</span><span style="color:#bfbab0cc;">,</span><span>scale_info::TypeInfo)]
</span><span>    </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Voter </span><span>{
</span><span>        weight</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">u32</span><span>,
</span><span>        voted</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">bool</span><span>,
</span><span>        delegate</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;AccountId&gt;, 
</span><span>        vote</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;</span><span style="color:#ff7733;">i32</span><span>&gt;, 
</span><span>    }
</span><span>
</span><span>    </span><span style="font-style:italic;color:#5c6773;">/// Defines the storage of your contract.
</span><span>    </span><span style="font-style:italic;color:#5c6773;">/// Add new fields to the below struct in order
</span><span>    </span><span style="font-style:italic;color:#5c6773;">/// to add new static storage fields to your contract.
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(storage)]
</span><span>    </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Ballot </span><span>{
</span><span>        chair_person</span><span style="color:#bfbab0cc;">:</span><span> AccountId,
</span><span>        voters</span><span style="color:#bfbab0cc;">: </span><span>HashMap&lt;AccountId, Voter&gt;,
</span><span>        proposals</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Proposal&gt;    
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">impl </span><span style="color:#59c2ff;">Ballot </span><span>{
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(constructor)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">new</span><span>(</span><span style="color:#f29718;">proposal_names</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;</span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;</span><span style="font-style:italic;color:#39bae6;">String</span><span>&gt;&gt; ) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span>
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// get chair person address
</span><span>            </span><span style="color:#ff7733;">let</span><span> chair_person </span><span style="color:#f29668;">=  </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>env()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">caller</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// create empty propsal and voters
</span><span>            </span><span style="color:#ff7733;">let mut</span><span> proposals</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Proposal&gt; </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">Vec</span><span style="color:#f29668;">::</span><span>new()</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#ff7733;">let mut</span><span> voters </span><span style="color:#f29668;">= </span><span>HashMap</span><span style="color:#f29668;">::</span><span>new()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// initialize chair person&#39;s vote
</span><span>            voters</span><span style="color:#f29668;">.</span><span style="color:#f07178;">insert</span><span>(chair_person</span><span style="color:#bfbab0cc;">,</span><span> Voter{
</span><span>                weight</span><span style="color:#bfbab0cc;">:</span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">,
</span><span>                voted</span><span style="color:#bfbab0cc;">:</span><span style="color:#f29718;">false</span><span style="color:#bfbab0cc;">,
</span><span>                delegate</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>                vote</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>            })</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// ACTION : Check if proposal names are provided.
</span><span>            </span><span style="font-style:italic;color:#5c6773;">//        * If yes then create and push proposal objects to proposals vector
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// if proposals are provided
</span><span>            </span><span style="color:#ff7733;">if</span><span> proposal_names</span><span style="color:#f29668;">.</span><span style="color:#f07178;">is_some</span><span>() {
</span><span>                </span><span style="font-style:italic;color:#5c6773;">// store the provided propsal names
</span><span>                </span><span style="color:#ff7733;">let</span><span> names </span><span style="color:#f29668;">=</span><span> proposal_names</span><span style="color:#f29668;">.</span><span style="color:#f07178;">unwrap</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>                </span><span style="color:#ff7733;">for</span><span> name </span><span style="color:#f29668;">in &amp;</span><span>names {
</span><span>                    proposals</span><span style="color:#f29668;">.</span><span style="color:#f07178;">push</span><span>(
</span><span>                        Proposal{
</span><span>                        name</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">String</span><span style="color:#f29668;">::</span><span>from(name)</span><span style="color:#bfbab0cc;">,
</span><span>                        vote_count</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">0</span><span style="color:#bfbab0cc;">,
</span><span>                    })</span><span style="color:#bfbab0cc;">;
</span><span>                }
</span><span>            }
</span><span>
</span><span>            </span><span style="color:#ff7733;">Self </span><span>{
</span><span>                chair_person</span><span style="color:#bfbab0cc;">,
</span><span>                voters</span><span style="color:#bfbab0cc;">,
</span><span>                proposals</span><span style="color:#bfbab0cc;">,
</span><span>            }
</span><span>        }
</span><span>
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// default constrcutor
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(constructor)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">default</span><span>() </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span>            </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>new(</span><span style="font-style:italic;color:#39bae6;">Default</span><span style="color:#f29668;">::</span><span>default())
</span><span>        }
</span><span>
</span><span>
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(message)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">get_chairperson</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> AccountId {
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>chair_person
</span><span>        }
</span><span>
</span><span>
</span><span>
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">get_voter</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">voter_id</span><span style="color:#bfbab0cc;">:</span><span> AccountId) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;</span><span style="color:#f29668;">&amp;</span><span>Voter&gt;{
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>voters</span><span style="color:#f29668;">.</span><span style="color:#f07178;">get</span><span>(</span><span style="color:#f29668;">&amp;</span><span>voter_id)
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">get_voter_count</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">usize</span><span>{
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>voters</span><span style="color:#f29668;">.</span><span style="color:#f07178;">len</span><span>() </span><span style="color:#f29668;">as </span><span style="color:#ff7733;">usize
</span><span>        }
</span><span>
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// the function adds the provided voter id into possible
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// list of voters. By default the voter has no voting right,
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// the contract owner must approve the voter before he can cast a vote
</span><span>        </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">ink</span><span>(message)]
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">add_voter</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">voter_id</span><span style="color:#bfbab0cc;">:</span><span> AccountId) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">bool</span><span>{
</span><span>
</span><span>            </span><span style="color:#ff7733;">let</span><span> voter_opt </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>voters</span><span style="color:#f29668;">.</span><span style="color:#f07178;">get</span><span>(</span><span style="color:#f29668;">&amp;</span><span>voter_id)</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="font-style:italic;color:#5c6773;">// the voter does not exists
</span><span>            </span><span style="color:#ff7733;">if</span><span> voter_opt</span><span style="color:#f29668;">.</span><span style="color:#f07178;">is_some</span><span>() {
</span><span>                </span><span style="color:#ff7733;">return </span><span style="color:#f29718;">false
</span><span>            }
</span><span>
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>voters</span><span style="color:#f29668;">.</span><span style="color:#f07178;">insert</span><span>(voter_id</span><span style="color:#bfbab0cc;">,</span><span> Voter{
</span><span>                weight</span><span style="color:#bfbab0cc;">:</span><span style="color:#f29718;">0</span><span style="color:#bfbab0cc;">,
</span><span>                voted</span><span style="color:#bfbab0cc;">:</span><span style="color:#f29718;">false</span><span style="color:#bfbab0cc;">,
</span><span>                delegate</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>                vote</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>            })</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#ff7733;">return </span><span style="color:#f29718;">true
</span><span>        }
</span><span>
</span><span>
</span><span>
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// given an index returns the name of the proposal at that index
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">get_proposal_name_at_index</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">index</span><span style="color:#bfbab0cc;">:</span><span style="color:#ff7733;">usize</span><span>) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#f29668;">&amp;</span><span>String {
</span><span>            </span><span style="color:#ff7733;">let</span><span> proposal </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>proposals</span><span style="color:#f29668;">.</span><span style="color:#f07178;">get</span><span>(index)</span><span style="color:#f29668;">.</span><span style="color:#f07178;">unwrap</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>            </span><span style="color:#ff7733;">return </span><span style="color:#f29668;">&amp;</span><span>proposal</span><span style="color:#f29668;">.</span><span>name
</span><span>        }
</span><span>
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// returns the number of proposals in ballet
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">get_proposal_count</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">usize </span><span>{
</span><span>            </span><span style="color:#ff7733;">return </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>proposals</span><span style="color:#f29668;">.</span><span style="color:#f07178;">len</span><span>()
</span><span>        }
</span><span>
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// adds the given proposal name in ballet
</span><span>        </span><span style="font-style:italic;color:#5c6773;">/// to do: check unqiueness of proposal,
</span><span>        </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">add_proposal</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">proposal_name</span><span style="color:#bfbab0cc;">:</span><span> String){
</span><span>            </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>proposals</span><span style="color:#f29668;">.</span><span style="color:#f07178;">push</span><span>(
</span><span>                Proposal{
</span><span>                    name</span><span style="color:#bfbab0cc;">:</span><span style="font-style:italic;color:#39bae6;">String</span><span style="color:#f29668;">::</span><span>from(proposal_name)</span><span style="color:#bfbab0cc;">,
</span></code></pre>
<p>{% endtab %}
{% endtabs %}</p>










<script src="https://giscus.app/client.js"
    data-repo="dudochkin-victor&#x2F;dudochkin-victor.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzNzgwNTYx"
    data-category="General"
    data-category-id="DIC_kwDOADmv0c4CAhvj"
    data-mapping="pathname"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-theme="light"
    data-lang="en"
    crossorigin="anonymous"
    async>
</script>



        </div>

        
        
    </main>

    
    <footer>
        <small class="subtext">
            <a href="https://angular-rust.github.io">Dudochkin Victor</a> © 2021
        </small>
    </footer>
    
</body>
<script>
    function highlightNav(heading) {
        let pathname = location.pathname;
        document.querySelectorAll(".toc a").forEach((item) => {
            item.classList.remove("active");
        });
        document.querySelector(".toc a[href$='" + pathname + "#" + heading + "']").classList.add("active");
    }

    let currentHeading = "";
    window.onscroll = function () {
        let h = document.querySelectorAll("h1,h2,h3,h4,h5,h6");
        let elementArr = [];

        h.forEach(item => {
            if (item.id !== "") {
                elementArr[item.id] = item.getBoundingClientRect().top;
            }
        });
        elementArr.sort();
        for (let key in elementArr) {
            if (!elementArr.hasOwnProperty(key)) {
                continue;
            }
            if (elementArr[key] > 0 && elementArr[key] < 300) {
                if (currentHeading !== key) {
                    highlightNav(key);
                    currentHeading = key;
                }
                break;
            }
        }
    }
</script>

</html>
