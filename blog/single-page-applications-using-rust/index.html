<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Одностраничные приложения, использующие Rust | Dudochkin Victor </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="google-site-verification" content="Kepqb6k6uptlwngnHbBVJmqQtwNW8zfHyQBbTXLYAgA" />
    <meta name="yandex-verification" content="8e8bc73c2566b473" />
    <style>
    :root {
        /* Primary theme color */
        /* --primary-color: #121A26; */
        --primary-color: #0f1419;
        /* Primary theme text color */
        /* --primary-text-color: #121A26; */
        --primary-text-color: #0f1419;
        /* Primary theme link color */
        --primary-link-color: #053961;
        /* Secondary color: the background body color */
        --secondary-color: #F0F0F0;
        --secondary-text-color: #1C2834;
        /* Highlight text color of table of content */
        --toc-highlight-text-color: #053961;
    }
</style>
    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-47MMPLLY44"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-47MMPLLY44');
    </script>
    

    
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
    
        ym('87064264', "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true
        });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/87064264" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    
    
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/mdl.min.css">
    <link rel="stylesheet" href="https://dudochkin-victor.github.io/style.css">
    
    
</head>

<body>
    
<header class="box-shadow">
    

<a href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;">
    <div class="logo">
        <img src="https://dudochkin-victor.github.io/ferris.png" alt="logo">
        Dudochkin Victor
    </div>
</a>

<nav>
    <!-- 
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;showcases&#x2F;">Showcases</a>
    
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;changelog&#x2F;">Changelog</a>
    
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;about&#x2F;">About</a>
     -->

    
        
        <a class="nav-item subtitle-text" href="&#x2F;solana&#x2F;">Solana</a>
        
        <a class="nav-item subtitle-text" href="&#x2F;edgeware&#x2F;">Edgeware</a>
        
        <a class="nav-item subtitle-text" href="&#x2F;blog&#x2F;">Блог</a>
        
        <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;github.com&#x2F;dudochkin-victor">Github</a>
        
    
</nav>

</header>

 
    <main>
        
        
        
        
        
        <div class="toc">
            <div class="toc-sticky">
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/blog/single-page-applications-using-rust/#nastroika">Настройка</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/blog/single-page-applications-using-rust/#privet-mir">Привет мир</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/blog/single-page-applications-using-rust/#myshlenie-komponentami">Мышление компонентами</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/blog/single-page-applications-using-rust/#domashniaia-stranitsa">Домашняя страница</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/blog/single-page-applications-using-rust/#poluchenie-dannykh">Получение данных</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/blog/single-page-applications-using-rust/#razdelenie-na-povtorno-ispol-zuemye-komponenty">Разделение на повторно используемые компоненты</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/blog/single-page-applications-using-rust/#stil">Стиль</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/blog/single-page-applications-using-rust/#marshrutizatsiia">Маршрутизация</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/blog/single-page-applications-using-rust/#productdetailpage">ProductDetailPage</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/blog/single-page-applications-using-rust/#gosudarstvennoe-upravlenie">Государственное управление</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/blog/single-page-applications-using-rust/#sostoianie-podema">Состояние подъема</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/blog/single-page-applications-using-rust/#vyvod">Вывод</a>
                </div>
                
                
            </div>
        </div>
        
        

        <div class="content text">
            
<h1>Одностраничные приложения, использующие Rust</h1>

<p><a href="https://www.sheshbabu.com/posts/rust-wasm-yew-single-page-application/">Перевод</a> | Автор оригинала: Shesh</p>
<p>WebAssembly (wasm) позволяет запускать в браузерах код, написанный на языках, отличных от JavaScript. Если вы не обращали внимания, все основные браузеры поддерживают wasm, и во всем мире более 90% пользователей имеют браузеры, которые могут запускать wasm.</p>
<p>Поскольку Rust компилируется в wasm, возможно ли создавать SPA (одностраничные приложения) исключительно на Rust и без написания ни одной строчки JavaScript? Краткий ответ - да! Читайте дальше, чтобы узнать больше, или посетите демонстрационный сайт, если не можете сдержать волнение!</p>
<p>Мы будем создавать простой сайт электронной коммерции под названием «RustMart», который будет иметь две страницы:</p>
<ul>
<li>Домашняя страница - список всех продуктов, которые покупатель может добавить в корзину.</li>
<li>ProductDetailPage - показывать подробную информацию о продукте при нажатии на карточку продукта.</li>
</ul>
<p><img src="/imgs/posts/ebe0fe80_01.png" alt="" /></p>
<p>Я использую этот пример, поскольку он проверяет минимальный набор возможностей, необходимых для создания современных SPA:</p>
<ul>
<li>Перемещение между несколькими страницами без перезагрузки страницы</li>
<li>Делайте сетевые запросы без перезагрузки страницы</li>
<li>Возможность повторно использовать компоненты пользовательского интерфейса на нескольких страницах.</li>
<li>Обновление компонентов на разных уровнях иерархии пользовательского интерфейса</li>
</ul>
<h2 id="nastroika">Настройка</h2>
<p>Перейдите по этой ссылке, чтобы установить Rust, если вы еще этого не сделали.</p>
<p>Установите эти инструменты Rust: </p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">$</span><span> cargo install wasm-pack          </span><span style="font-style:italic;color:#5c6773;"># Compile Rust to Wasm and generate JS interop code
</span><span style="color:#ffb454;">$</span><span> cargo install cargo-make         </span><span style="font-style:italic;color:#5c6773;"># Task runner
</span><span style="color:#ffb454;">$</span><span> cargo install simple-http-server </span><span style="font-style:italic;color:#5c6773;"># Simple server to serve assets
</span></code></pre>
<p>Создайте новый проект: </p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">$</span><span> cargo new</span><span style="color:#f29718;"> --lib</span><span> rustmart </span><span style="color:#f29668;">&amp;&amp; </span><span style="color:#f07178;">cd</span><span> rustmart
</span></code></pre>
<p>Мы будем использовать библиотеку Yew для создания компонентов пользовательского интерфейса. Давайте добавим это и зависимости wasm в Cargo.toml: </p>
<pre data-lang="toml" style="background-color:#0f1419;color:#bfbab0;" class="language-toml "><code class="language-toml" data-lang="toml"><span>[</span><span style="color:#59c2ff;">lib</span><span>]
</span><span style="color:#59c2ff;">crate-type </span><span>= [</span><span style="color:#c2d94c;">&quot;cdylib&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;rlib&quot;</span><span>]
</span><span>
</span><span>[</span><span style="color:#59c2ff;">dependencies</span><span>]
</span><span style="color:#59c2ff;">yew </span><span>= </span><span style="color:#c2d94c;">&quot;0.17&quot;
</span><span style="color:#59c2ff;">wasm-bindgen </span><span>= </span><span style="color:#c2d94c;">&quot;0.2&quot;
</span></code></pre>
<p>Создайте новый файл с именем Makefile.toml и добавьте это: </p>
<pre data-lang="toml" style="background-color:#0f1419;color:#bfbab0;" class="language-toml "><code class="language-toml" data-lang="toml"><span>[</span><span style="color:#59c2ff;">tasks</span><span style="color:#bfbab0cc;">.</span><span style="color:#59c2ff;">build</span><span>]
</span><span style="color:#59c2ff;">command </span><span>= </span><span style="color:#c2d94c;">&quot;wasm-pack&quot;
</span><span style="color:#59c2ff;">args </span><span>= [</span><span style="color:#c2d94c;">&quot;build&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;--dev&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;--target&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;web&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;--out-name&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;wasm&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;--out-dir&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;./static&quot;</span><span>]
</span><span style="color:#59c2ff;">watch </span><span>= { </span><span style="color:#59c2ff;">ignore_pattern </span><span>= </span><span style="color:#c2d94c;">&quot;static/*&quot; </span><span>}
</span><span>
</span><span>[</span><span style="color:#59c2ff;">tasks</span><span style="color:#bfbab0cc;">.</span><span style="color:#59c2ff;">serve</span><span>]
</span><span style="color:#59c2ff;">command </span><span>= </span><span style="color:#c2d94c;">&quot;simple-http-server&quot;
</span><span style="color:#59c2ff;">args </span><span>= [</span><span style="color:#c2d94c;">&quot;-i&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;./static/&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;-p&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;3000&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;--nocache&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;--try-file&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;./static/index.html&quot;</span><span>]
</span></code></pre>
<p>Запустите задачу сборки: </p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">$</span><span> cargo make build
</span></code></pre>
<p>Если вы новичок в Rust, я написал несколько руководств для начинающих, которые помогут вам лучше следить за этим постом.</p>
<h2 id="privet-mir">Привет мир</h2>
<p>Начнем с простого примера &quot;привет, мир&quot;:</p>
<p>Создайте static / index.html и добавьте это: </p>
<pre data-lang="html" style="background-color:#0f1419;color:#bfbab0;" class="language-html "><code class="language-html" data-lang="html"><span style="color:#39bae690;">&lt;!</span><span style="color:#ff7733;">DOCTYPE </span><span style="color:#f29718;">html</span><span style="color:#39bae690;">&gt;
</span><span style="color:#39bae690;">&lt;</span><span style="color:#59c2ff;">html </span><span style="color:#ffb454;">lang</span><span style="color:#bfbab0cc;">=</span><span style="color:#c2d94c;">&quot;en&quot;</span><span style="color:#39bae690;">&gt;
</span><span>  </span><span style="color:#39bae690;">&lt;</span><span style="color:#59c2ff;">head</span><span style="color:#39bae690;">&gt;
</span><span>    </span><span style="color:#39bae690;">&lt;</span><span style="color:#59c2ff;">meta </span><span style="color:#ffb454;">charset</span><span style="color:#bfbab0cc;">=</span><span style="color:#c2d94c;">&quot;utf-8&quot; </span><span style="color:#39bae690;">/&gt;
</span><span>    </span><span style="color:#39bae690;">&lt;</span><span style="color:#59c2ff;">title</span><span style="color:#39bae690;">&gt;</span><span>RustMart</span><span style="color:#39bae690;">&lt;/</span><span style="color:#59c2ff;">title</span><span style="color:#39bae690;">&gt;
</span><span>    </span><span style="color:#39bae690;">&lt;</span><span style="color:#59c2ff;">script </span><span style="color:#ffb454;">type</span><span style="color:#bfbab0cc;">=</span><span style="color:#c2d94c;">&quot;module&quot;</span><span style="color:#39bae690;">&gt;
</span><span>      </span><span style="color:#ff7733;">import </span><span>init </span><span style="color:#ff7733;">from </span><span style="color:#c2d94c;">&quot;/wasm.js&quot;</span><span style="color:#bfbab0cc;">;
</span><span>      </span><span style="color:#ffb454;">init</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#39bae690;">&lt;/</span><span style="color:#59c2ff;">script</span><span style="color:#39bae690;">&gt;
</span><span>    </span><span style="color:#39bae690;">&lt;</span><span style="color:#59c2ff;">link </span><span style="color:#ffb454;">rel</span><span style="color:#bfbab0cc;">=</span><span style="color:#c2d94c;">&quot;shortcut icon&quot; </span><span style="color:#ffb454;">href</span><span style="color:#bfbab0cc;">=</span><span style="color:#c2d94c;">&quot;#&quot; </span><span style="color:#39bae690;">/&gt;
</span><span>  </span><span style="color:#39bae690;">&lt;/</span><span style="color:#59c2ff;">head</span><span style="color:#39bae690;">&gt;
</span><span>  </span><span style="color:#39bae690;">&lt;</span><span style="color:#59c2ff;">body</span><span style="color:#39bae690;">&gt;&lt;/</span><span style="color:#59c2ff;">body</span><span style="color:#39bae690;">&gt;
</span><span style="color:#39bae690;">&lt;/</span><span style="color:#59c2ff;">html</span><span style="color:#39bae690;">&gt;
</span></code></pre>
<p>Добавьте это в src/lib.rs: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="font-style:italic;color:#5c6773;">// src/lib.rs
</span><span style="color:#ff7733;">use </span><span>wasm_bindgen</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">Hello </span><span>{}
</span><span>
</span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">Hello </span><span>{
</span><span>    </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Message </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Properties </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29668;">_</span><span>: ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span>        </span><span style="color:#ff7733;">Self </span><span>{}
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">update</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Message) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>        </span><span style="color:#f29718;">true
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">change</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>        </span><span style="color:#f29718;">true
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span>        </span><span style="color:#f07178;">html! </span><span>{ </span><span style="color:#f29668;">&lt;</span><span>span</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Hello World!&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>span</span><span style="color:#f29668;">&gt; </span><span>}
</span><span>    }
</span><span>}
</span><span>
</span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">wasm_bindgen</span><span>(start)]
</span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">run_app</span><span>() {
</span><span>    App</span><span style="color:#f29668;">::</span><span>&lt;Hello&gt;</span><span style="color:#f29668;">::</span><span>new()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">mount_to_body</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>}
</span></code></pre>
<p>Многое происходит, но вы видите, что мы создаем новый компонент с именем «Hello», который отображает <span> Hello World! </span> в DOM. Мы узнаем больше о компонентах Yew позже.</p>
<p>Запустите задачу обслуживания в новом терминале и загрузите http: // localhost: 3000 в свой браузер. </p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">$</span><span> cargo make serve
</span></code></pre>
<p><img src="/imgs/posts/ebe0fe80_02.png" alt="" /></p>
<p>Оно работает!! Это всего лишь «привет, мир», но это полностью написано на Rust.</p>
<p>Прежде чем продолжить, давайте узнаем о компонентах и других концепциях SPA.</p>
<h2 id="myshlenie-komponentami">Мышление компонентами</h2>
<p>Создание пользовательского интерфейса путем компоновки компонентов и однонаправленной передачи данных - это сдвиг парадигмы в мире внешнего интерфейса. Это огромное улучшение в том, как мы рассуждаем о пользовательском интерфейсе, и очень сложно вернуться к императивным манипуляциям с DOM, когда вы к этому привыкнете.</p>
<p>Компонент в таких библиотеках, как React, Vue, Yew, Flutter и т.д., Имеет следующие особенности:</p>
<ul>
<li>Возможность составлять из более крупных компонентов</li>
<li>Props - передавать данные и обратные вызовы от этого компонента к его дочерним компонентам.</li>
<li>Состояние - манипулировать состоянием, локальным для этого компонента.</li>
<li>AppState - управлять глобальным состоянием.</li>
<li>Слушайте события жизненного цикла, такие как «Создан», «Установлен в DOM» и т.д.</li>
<li>Выполнять побочные эффекты, такие как получение удаленных данных, манипулирование локальным хранилищем и т.д.</li>
</ul>
<p>Компонент обновляется (повторно отображается), когда происходит одно из следующих событий:</p>
<ul>
<li>Родительский компонент перерисован</li>
<li>Изменения реквизита</li>
<li>Изменения состояния</li>
<li>Изменения в AppState</li>
</ul>
<p>Таким образом, вместо обязательного обновления пользовательского интерфейса при взаимодействии с пользователем, сетевых запросах и т.д. Мы обновляем данные (свойства, состояние, AppState), и пользовательский интерфейс обновляется на основе этих данных. Это то, что имеют в виду, когда говорят: «UI - это функция состояния».</p>
<p>Точные детали различаются в разных библиотеках, но это должно дать вам общее представление. Если вы новичок в этом, возможно, потребуется время, чтобы «щелкнуть» и привыкнуть к такому образу мышления.</p>
<h2 id="domashniaia-stranitsa">Домашняя страница</h2>
<p>Давайте сначала создадим домашнюю страницу. Мы будем строить HomePage как монолитный компонент, а позже разложим его на более мелкие повторно используемые компоненты.</p>
<p>Создадим следующие файлы: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="font-style:italic;color:#5c6773;">// src/pages/home.rs
</span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Home </span><span>{}
</span><span>
</span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">Home </span><span>{
</span><span>    </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Message </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Properties </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29668;">_</span><span>: ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span>        </span><span style="color:#ff7733;">Self </span><span>{}
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">update</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Message) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>        </span><span style="color:#f29718;">true
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">change</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>        </span><span style="color:#f29718;">true
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span>        </span><span style="color:#f07178;">html! </span><span>{ </span><span style="color:#f29668;">&lt;</span><span>span</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Home Sweet Home!&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>span</span><span style="color:#f29668;">&gt; </span><span>}
</span><span>    }
</span><span>}
</span><span>
</span><span style="font-style:italic;color:#5c6773;">// src/pages/mod.rs
</span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">home</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">pub use </span><span>home</span><span style="color:#f29668;">::</span><span>Home</span><span style="color:#bfbab0cc;">;
</span></code></pre>
<p>Давайте обновим src/lib.rs, чтобы импортировать компонент HomePage: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>  </span><span style="font-style:italic;color:#5c6773;">// src/lib.rs
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">pages</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">use </span><span>pages</span><span style="color:#f29668;">::</span><span>Home</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>wasm_bindgen</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">- </span><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">Hello </span><span>{}
</span><span>
</span><span style="color:#f29668;">- </span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">Hello </span><span>{
</span><span style="color:#f29668;">-     </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Message </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">-     </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Properties </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">-     </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29668;">_</span><span>: ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span style="color:#f29668;">-         </span><span style="color:#ff7733;">Self </span><span>{}
</span><span style="color:#f29668;">-     </span><span>}
</span><span>
</span><span style="color:#f29668;">-     </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">update</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Message) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span style="color:#f29668;">-         </span><span style="color:#f29718;">true
</span><span style="color:#f29668;">-     </span><span>}
</span><span>
</span><span style="color:#f29668;">-     </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">change</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span style="color:#f29668;">-         </span><span style="color:#f29718;">true
</span><span style="color:#f29668;">-     </span><span>}
</span><span>
</span><span style="color:#f29668;">-     </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span style="color:#f29668;">-         </span><span style="color:#f07178;">html! </span><span>{ </span><span style="color:#f29668;">&lt;</span><span>span</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Hello World!&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>span</span><span style="color:#f29668;">&gt; </span><span>}
</span><span style="color:#f29668;">-     </span><span>}
</span><span style="color:#f29668;">- </span><span>}
</span><span>
</span><span>  </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">wasm_bindgen</span><span>(start)]
</span><span>  </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">run_app</span><span>() {
</span><span style="color:#f29668;">-   </span><span>App</span><span style="color:#f29668;">::</span><span>&lt;Hello&gt;</span><span style="color:#f29668;">::</span><span>new()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">mount_to_body</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+   </span><span>App</span><span style="color:#f29668;">::</span><span>&lt;Home&gt;</span><span style="color:#f29668;">::</span><span>new()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">mount_to_body</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>  }
</span></code></pre>
<p>Теперь вы должны увидеть «Дом, милый дом!» вместо «Hello World!» отображается в вашем браузере.</p>
<p>Приступим к проектированию состояния этого компонента:</p>
<ul>
<li>Нам нужно хранить список продуктов, полученных с сервера</li>
<li>Храните продукты, добавленные пользователем в корзину.</li>
</ul>
<p>Мы создаем простую структуру для хранения сведений о продукте: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">Product </span><span>{
</span><span>    name</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>    description</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>    image</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>    price</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">f64</span><span>,
</span><span>}
</span></code></pre>
<p>Затем мы создаем новую структуру State с полем products для хранения продуктов с сервера: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">State </span><span>{
</span><span>    products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Product&gt;,
</span><span>}
</span></code></pre>
<p>Вот полный список изменений в компоненте HomePage: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">Product </span><span>{
</span><span>+     id</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">i32</span><span>,
</span><span>+     name</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>+     description</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>+     image</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>+     price</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">f64</span><span>,
</span><span>+ }
</span><span>
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">State </span><span>{
</span><span>+     products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Product&gt;,
</span><span>+ }
</span><span>
</span><span style="color:#f29668;">- </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Home </span><span>{}
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Home </span><span>{
</span><span>+     state</span><span style="color:#bfbab0cc;">:</span><span> State,
</span><span>+ }
</span><span>
</span><span>  </span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">Home </span><span>{
</span><span>      </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Message </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>      </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Properties </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29668;">_</span><span>: ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span style="color:#f29668;">+       </span><span style="color:#ff7733;">let</span><span> products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Product&gt; </span><span style="color:#f29668;">= </span><span style="color:#f07178;">vec!</span><span>[
</span><span style="color:#f29668;">+</span><span>           Product {
</span><span style="color:#f29668;">+</span><span>               id</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>               name</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;Apple&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>               description</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;An apple a day keeps the doctor away&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>               image</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;/products/apple.png&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>               price</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">3.65</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+           </span><span>}</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>           Product {
</span><span style="color:#f29668;">+</span><span>               id</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">2</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>               name</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;Banana&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>               description</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;An old banana leaf was once young and green&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>               image</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;/products/banana.png&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>               price</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">7.99</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+           </span><span>}</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+       </span><span>]</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">-       </span><span style="color:#ff7733;">Self </span><span>{}
</span><span style="color:#f29668;">+       </span><span style="color:#ff7733;">Self </span><span>{
</span><span style="color:#f29668;">+</span><span>           state</span><span style="color:#bfbab0cc;">:</span><span> State {
</span><span style="color:#f29668;">+</span><span>               products</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+           </span><span>}</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+       </span><span>}
</span><span>      }
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">update</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Message) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>          </span><span style="color:#f29718;">true
</span><span>      }
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">change</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>          </span><span style="color:#f29718;">true
</span><span>      }
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span style="color:#f29668;">+        </span><span style="color:#ff7733;">let</span><span> products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Html&gt; </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span style="color:#f29668;">+            .</span><span>state
</span><span style="color:#f29668;">+            .</span><span>products
</span><span style="color:#f29668;">+            .</span><span style="color:#f07178;">iter</span><span>()
</span><span style="color:#f29668;">+            .</span><span style="color:#f07178;">map</span><span>(|</span><span style="color:#f29718;">product</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29668;">&amp;</span><span>Product| {
</span><span style="color:#f29668;">+                </span><span style="color:#f07178;">html! </span><span>{
</span><span style="color:#f29668;">+                  &lt;</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+                    &lt;</span><span>img src</span><span style="color:#f29668;">=</span><span>{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>image}</span><span style="color:#f29668;">/&gt;
</span><span style="color:#f29668;">+                    &lt;</span><span>div</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>name}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+                    &lt;</span><span>div</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;$&quot;</span><span>}{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>price}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+                  &lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+                </span><span>}
</span><span style="color:#f29668;">+            </span><span>})
</span><span style="color:#f29668;">+            .</span><span style="color:#f07178;">collect</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+
</span><span style="color:#f29668;">+        </span><span style="color:#f07178;">html! </span><span>{ </span><span style="color:#f29668;">&lt;</span><span>span</span><span style="color:#f29668;">&gt;</span><span>{products}</span><span style="color:#f29668;">&lt;/</span><span>span</span><span style="color:#f29668;">&gt; </span><span>}
</span><span style="color:#f29668;">-        </span><span style="color:#f07178;">html! </span><span>{ </span><span style="color:#f29668;">&lt;</span><span>span</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Home!&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>span</span><span style="color:#f29668;">&gt; </span><span>}
</span><span>      }
</span><span>  }
</span></code></pre>
<p>Метод создания жизненного цикла вызывается при создании компонента, и именно здесь мы устанавливаем начальное состояние. На данный момент мы создали фиктивный список продуктов и присвоили его продуктам внутри штата в качестве начального значения. Позже мы получим этот список с помощью сетевого запроса.</p>
<p>Метод жизненного цикла представления вызывается при визуализации компонента. Здесь мы перебирали продукты внутри состояния для создания карточек продуктов. Если вы знакомы с React, это то же самое, что метод рендеринга и HTML! макрос похож на JSX.</p>
<p>Сохраните несколько случайных изображений как static / products / apple.png и static / products / banana.png, и вы получите следующий интерфейс:</p>
<p><img src="/imgs/posts/ebe0fe80_03.png" alt="" /></p>
<p>Давайте реализуем функцию «добавить в корзину»:</p>
<ul>
<li>Мы отслеживаем все товары, добавленные в корзину, в новом поле состояния под названием cart_products.</li>
<li>Оформляем кнопку «добавить в корзину» для каждого товара.</li>
<li>Добавить логику для обновления состояния cart_products при нажатии кнопки «добавить в корзину». </li>
</ul>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">+ </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Clone)]
</span><span>  </span><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">Product </span><span>{
</span><span>      id</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">i32</span><span>,
</span><span>      name</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>      description</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>      image</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>      price</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">f64</span><span>,
</span><span>  }
</span><span>
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">CartProduct </span><span>{
</span><span>+     product</span><span style="color:#bfbab0cc;">:</span><span> Product,
</span><span>+     quantity</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">i32</span><span>,
</span><span>+ }
</span><span>
</span><span>  </span><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">State </span><span>{
</span><span>      products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Product&gt;,
</span><span>+     cart_products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;CartProduct&gt;,
</span><span>  }
</span><span>
</span><span>  </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Home </span><span>{
</span><span>      state</span><span style="color:#bfbab0cc;">:</span><span> State,
</span><span>+     link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;,
</span><span>  }
</span><span>
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">pub enum </span><span style="color:#59c2ff;">Msg </span><span>{
</span><span style="color:#f29668;">+</span><span>     AddToCart(</span><span style="color:#ff7733;">i32</span><span>)</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+ </span><span>}
</span><span>
</span><span>  </span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">Home </span><span>{
</span><span style="color:#f29668;">-   </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Message </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+   </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Message </span><span style="color:#f29668;">=</span><span> Msg</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Properties </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">-   </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29668;">_</span><span>: ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span style="color:#f29668;">+   </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29718;">link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span>        </span><span style="color:#ff7733;">let</span><span> products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Product&gt; </span><span style="color:#f29668;">= </span><span style="color:#f07178;">vec!</span><span>[
</span><span>            Product {
</span><span>                id</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">,
</span><span>                name</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;Apple&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span>                description</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;An apple a day keeps the doctor away&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span>                image</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;/products/apple.png&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span>                price</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">3.65</span><span style="color:#bfbab0cc;">,
</span><span>            }</span><span style="color:#bfbab0cc;">,
</span><span>            Product {
</span><span>                id</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">2</span><span style="color:#bfbab0cc;">,
</span><span>                name</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;Banana&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span>                description</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;An old banana leaf was once young and green&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span>                image</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;/products/banana.png&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span>                price</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">7.99</span><span style="color:#bfbab0cc;">,
</span><span>            }</span><span style="color:#bfbab0cc;">,
</span><span>        ]</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+       </span><span style="color:#ff7733;">let</span><span> cart_products </span><span style="color:#f29668;">= </span><span style="color:#f07178;">vec!</span><span>[]</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>        </span><span style="color:#ff7733;">Self </span><span>{
</span><span>            state</span><span style="color:#bfbab0cc;">:</span><span> State {
</span><span>                products</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>               cart_products</span><span style="color:#bfbab0cc;">,
</span><span>            }</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>           link</span><span style="color:#bfbab0cc;">,
</span><span>        }
</span><span>    }
</span><span>
</span><span style="color:#f29668;">-   </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">update</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Message) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span style="color:#f29668;">+   </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">update</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">message</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Message) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span style="color:#f29668;">+       </span><span style="color:#ff7733;">match</span><span> message {
</span><span style="color:#f29668;">+           </span><span>Msg</span><span style="color:#f29668;">::</span><span>AddToCart(product_id) </span><span style="color:#f29668;">=&gt; </span><span>{
</span><span style="color:#f29668;">+               </span><span style="color:#ff7733;">let</span><span> product </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span style="color:#f29668;">+                   .</span><span>state
</span><span style="color:#f29668;">+                   .</span><span>products
</span><span style="color:#f29668;">+                   .</span><span style="color:#f07178;">iter</span><span>()
</span><span style="color:#f29668;">+                   .</span><span style="color:#f07178;">find</span><span>(|</span><span style="color:#f29718;">p</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29668;">&amp;&amp;</span><span>Product| p</span><span style="color:#f29668;">.</span><span>id </span><span style="color:#f29668;">==</span><span> product_id)
</span><span style="color:#f29668;">+                   .</span><span style="color:#f07178;">unwrap</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+               </span><span style="color:#ff7733;">let</span><span> cart_product </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span style="color:#f29668;">+                   .</span><span>state
</span><span style="color:#f29668;">+                   .</span><span>cart_products
</span><span style="color:#f29668;">+                   .</span><span style="color:#f07178;">iter_mut</span><span>()
</span><span style="color:#f29668;">+                   .</span><span style="color:#f07178;">find</span><span>(|</span><span style="color:#f29718;">cp</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29668;">&amp;&amp;</span><span style="color:#ff7733;">mut</span><span> CartProduct| cp</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>id </span><span style="color:#f29668;">==</span><span> product_id)</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+
</span><span style="color:#f29668;">+               </span><span style="color:#ff7733;">if let </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(cp) </span><span style="color:#f29668;">=</span><span> cart_product {
</span><span style="color:#f29668;">+</span><span>                   cp</span><span style="color:#f29668;">.</span><span>quantity </span><span style="color:#f29668;">+= </span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+               </span><span>} </span><span style="color:#ff7733;">else </span><span>{
</span><span style="color:#f29668;">+                   </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>cart_products</span><span style="color:#f29668;">.</span><span style="color:#f07178;">push</span><span>(CartProduct {
</span><span style="color:#f29668;">+</span><span>                       product</span><span style="color:#bfbab0cc;">:</span><span> product</span><span style="color:#f29668;">.</span><span style="color:#f07178;">clone</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>                       quantity</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+                   </span><span>})
</span><span style="color:#f29668;">+               </span><span>}
</span><span style="color:#f29668;">+               </span><span style="color:#f29718;">true
</span><span style="color:#f29668;">+           </span><span>}
</span><span style="color:#f29668;">+       </span><span>}
</span><span style="color:#f29668;">-       </span><span style="color:#f29718;">true
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">change</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>        </span><span style="color:#f29718;">true
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span>        </span><span style="color:#ff7733;">let</span><span> products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Html&gt; </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span>            </span><span style="color:#f29668;">.</span><span>state
</span><span>            </span><span style="color:#f29668;">.</span><span>products
</span><span>            </span><span style="color:#f29668;">.</span><span style="color:#f07178;">iter</span><span>()
</span><span>            </span><span style="color:#f29668;">.</span><span style="color:#f07178;">map</span><span>(|</span><span style="color:#f29718;">product</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29668;">&amp;</span><span>Product| {
</span><span style="color:#f29668;">+              </span><span style="color:#ff7733;">let</span><span> product_id </span><span style="color:#f29668;">=</span><span> product</span><span style="color:#f29668;">.</span><span>id</span><span style="color:#bfbab0cc;">;
</span><span>                </span><span style="color:#f07178;">html! </span><span>{
</span><span>                  </span><span style="color:#f29668;">&lt;</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                    </span><span style="color:#f29668;">&lt;</span><span>img src</span><span style="color:#f29668;">=</span><span>{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>image}</span><span style="color:#f29668;">/&gt;
</span><span>                    </span><span style="color:#f29668;">&lt;</span><span>div</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>name}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                    </span><span style="color:#f29668;">&lt;</span><span>div</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;$&quot;</span><span>}{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>price}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+                   &lt;</span><span>button onclick</span><span style="color:#f29668;">=</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>link</span><span style="color:#f29668;">.</span><span style="color:#f07178;">callback</span><span>(</span><span style="color:#ff7733;">move </span><span style="color:#f29668;">|_| </span><span>Msg</span><span style="color:#f29668;">::</span><span>AddToCart(product_id))</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Add To Cart&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>button</span><span style="color:#f29668;">&gt;
</span><span>                  </span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                }
</span><span>            })
</span><span>            </span><span style="color:#f29668;">.</span><span style="color:#f07178;">collect</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">+       </span><span style="color:#ff7733;">let</span><span> cart_value </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span style="color:#f29668;">+           .</span><span>state
</span><span style="color:#f29668;">+           .</span><span>cart_products
</span><span style="color:#f29668;">+           .</span><span style="color:#f07178;">iter</span><span>()
</span><span style="color:#f29668;">+           .</span><span style="color:#f07178;">fold</span><span>(</span><span style="color:#f29718;">0.0</span><span style="color:#bfbab0cc;">, </span><span>|</span><span style="color:#f29718;">acc</span><span style="color:#bfbab0cc;">, </span><span style="color:#f29718;">cp</span><span>| acc </span><span style="color:#f29668;">+ </span><span>(cp</span><span style="color:#f29668;">.</span><span>quantity </span><span style="color:#f29668;">as </span><span style="color:#ff7733;">f64 </span><span style="color:#f29668;">*</span><span> cp</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>price))</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">-       </span><span style="color:#f07178;">html! </span><span>{ </span><span style="color:#f29668;">&lt;</span><span>span</span><span style="color:#f29668;">&gt;</span><span>{products}</span><span style="color:#f29668;">&lt;/</span><span>span</span><span style="color:#f29668;">&gt; </span><span>}
</span><span style="color:#f29668;">+       </span><span style="color:#f07178;">html! </span><span>{
</span><span style="color:#f29668;">+         &lt;</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+           &lt;</span><span>span</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f07178;">format!</span><span>(</span><span style="color:#c2d94c;">&quot;Cart Value: </span><span style="color:#f29718;">{:.2}</span><span style="color:#c2d94c;">&quot;</span><span style="color:#bfbab0cc;">,</span><span> cart_value)}</span><span style="color:#f29668;">&lt;/</span><span>span</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+           &lt;</span><span>span</span><span style="color:#f29668;">&gt;</span><span>{products}</span><span style="color:#f29668;">&lt;/</span><span>span</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+         &lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+       </span><span>}
</span><span>      }
</span><span>  }
</span></code></pre>
<ul>
<li>clone - Мы получили трэйту Clone в структуре Product, чтобы мы могли сохранять клонированный продукт в CartProduct всякий раз, когда пользователь добавляет его в корзину.</li>
<li>update - этот метод является местом, где существует логика для обновления состояния компонента или выполнения побочных эффектов (например, сетевых запросов). Он вызывается с помощью перечисления Message, которое содержит все действия, поддерживаемые компонентом. Когда мы возвращаем true из этого метода, компонент перерисовывается. В приведенном выше коде, когда пользователь нажимает кнопку «Добавить в корзину», мы отправляем сообщение Msg::AddToCart для обновления. Внутри обновления оно либо добавляет продукт в cart_product, если его не существует, либо увеличивает количество.</li>
<li>ссылка - это позволяет нам регистрировать обратные вызовы, которые могут запускать наш метод жизненного цикла обновления.</li>
</ul>
<p>Если вы раньше использовали Redux, обновление похоже на Reducer (для обновлений состояния) и Action Creator (для побочных эффектов), Message аналогично Action, а ссылка аналогична Dispatch.</p>
<p><img src="/imgs/posts/ebe0fe80_04.png" alt="" /></p>
<p>Вот как выглядит пользовательский интерфейс. Попробуйте нажать кнопку «Добавить в корзину» и увидеть изменения в «Стоимость корзины»:</p>
<p><img src="/imgs/posts/ebe0fe80_05.png" alt="" /></p>
<h2 id="poluchenie-dannykh">Получение данных</h2>
<p>Мы переместим данные о товарах из функции create в static / products / products.json и запросим их с помощью API выборки. </p>
<pre data-lang="json" style="background-color:#0f1419;color:#bfbab0;" class="language-json "><code class="language-json" data-lang="json"><span>[
</span><span>  {
</span><span>    </span><span style="color:#c2d94c;">&quot;id&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">,
</span><span>    </span><span style="color:#c2d94c;">&quot;name&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;Apple&quot;</span><span style="color:#bfbab0cc;">,
</span><span>    </span><span style="color:#c2d94c;">&quot;description&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;An apple a day keeps the doctor away&quot;</span><span style="color:#bfbab0cc;">,
</span><span>    </span><span style="color:#c2d94c;">&quot;image&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;/products/apple.png&quot;</span><span style="color:#bfbab0cc;">,
</span><span>    </span><span style="color:#c2d94c;">&quot;price&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">3</span><span style="color:#bfbab0cc;">.</span><span style="color:#f29718;">65
</span><span>  }</span><span style="color:#bfbab0cc;">,
</span><span>  {
</span><span>    </span><span style="color:#c2d94c;">&quot;id&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">2</span><span style="color:#bfbab0cc;">,
</span><span>    </span><span style="color:#c2d94c;">&quot;name&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;Banana&quot;</span><span style="color:#bfbab0cc;">,
</span><span>    </span><span style="color:#c2d94c;">&quot;description&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;An old banana leaf was once young and green&quot;</span><span style="color:#bfbab0cc;">,
</span><span>    </span><span style="color:#c2d94c;">&quot;image&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;/products/banana.png&quot;</span><span style="color:#bfbab0cc;">,
</span><span>    </span><span style="color:#c2d94c;">&quot;price&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">7</span><span style="color:#bfbab0cc;">.</span><span style="color:#f29718;">99
</span><span>  }
</span><span>]
</span></code></pre>
<p>Yew предоставляет общие API-интерфейсы браузера, такие как fetch, localstorage и т.д., Через так называемые «службы». Мы можем использовать FetchService для выполнения сетевых запросов. Требуются все равно и серде крэйти, давайте их установим: </p>
<pre data-lang="toml" style="background-color:#0f1419;color:#bfbab0;" class="language-toml "><code class="language-toml" data-lang="toml"><span>  [</span><span style="color:#59c2ff;">package</span><span>]
</span><span>  </span><span style="color:#59c2ff;">name </span><span>= </span><span style="color:#c2d94c;">&quot;rustmart&quot;
</span><span>  </span><span style="color:#59c2ff;">version </span><span>= </span><span style="color:#c2d94c;">&quot;0.1.0&quot;
</span><span>  </span><span style="color:#59c2ff;">authors </span><span>= [</span><span style="color:#c2d94c;">&quot;sheshbabu &lt;sheshbabu@gmail.com&gt;&quot;</span><span>]
</span><span>  </span><span style="color:#59c2ff;">edition </span><span>= </span><span style="color:#c2d94c;">&quot;2018&quot;
</span><span>
</span><span>  [</span><span style="color:#59c2ff;">lib</span><span>]
</span><span>  </span><span style="color:#59c2ff;">crate-type </span><span>= [</span><span style="color:#c2d94c;">&quot;cdylib&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;rlib&quot;</span><span>]
</span><span>
</span><span>  [</span><span style="color:#59c2ff;">dependencies</span><span>]
</span><span>  </span><span style="color:#59c2ff;">yew </span><span>= </span><span style="color:#c2d94c;">&quot;0.17&quot;
</span><span>  </span><span style="color:#59c2ff;">wasm-bindgen </span><span>= </span><span style="color:#c2d94c;">&quot;0.2&quot;
</span><span style="color:#ff3333;">+ anyhow = &quot;1.0.32&quot;
</span><span style="color:#ff3333;">+ serde = { version = &quot;1.0&quot;, features = [&quot;derive&quot;] }
</span></code></pre>
<p>Давайте извлечем Product и CartProduct в src/types.rs, чтобы мы могли использовать их в нескольких файлах: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#ff7733;">use </span><span>serde</span><span style="color:#f29668;">::</span><span>{Deserialize</span><span style="color:#bfbab0cc;">,</span><span> Serialize}</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Deserialize</span><span style="color:#bfbab0cc;">,</span><span> Serialize</span><span style="color:#bfbab0cc;">,</span><span> Clone</span><span style="color:#bfbab0cc;">,</span><span> Debug)]
</span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Product </span><span>{
</span><span>    </span><span style="color:#ff7733;">pub </span><span>id</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">i32</span><span>,
</span><span>    </span><span style="color:#ff7733;">pub </span><span>name</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>    </span><span style="color:#ff7733;">pub </span><span>description</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>    </span><span style="color:#ff7733;">pub </span><span>image</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>    </span><span style="color:#ff7733;">pub </span><span>price</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">f64</span><span>,
</span><span>}
</span><span>
</span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Clone</span><span style="color:#bfbab0cc;">,</span><span> Debug)]
</span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">CartProduct </span><span>{
</span><span>    </span><span style="color:#ff7733;">pub </span><span>product</span><span style="color:#bfbab0cc;">:</span><span> Product,
</span><span>    </span><span style="color:#ff7733;">pub </span><span>quantity</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">i32</span><span>,
</span><span>}
</span></code></pre>
<p>Мы сделали обе структуры и их поля общедоступными и унаследовали трэйты Deserialize и Serialize.</p>
<p>Мы воспользуемся шаблоном модуля API и создадим отдельный модуль с именем src/api.rs для хранения нашей логики выборки: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="font-style:italic;color:#5c6773;">// src/api.rs
</span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>types</span><span style="color:#f29668;">::</span><span>Product</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">use </span><span>anyhow</span><span style="color:#f29668;">::</span><span>Error</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>callback</span><span style="color:#f29668;">::</span><span>Callback</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>format</span><span style="color:#f29668;">::</span><span>{Json</span><span style="color:#bfbab0cc;">,</span><span> Nothing}</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>services</span><span style="color:#f29668;">::</span><span>fetch</span><span style="color:#f29668;">::</span><span>{FetchService</span><span style="color:#bfbab0cc;">,</span><span> FetchTask</span><span style="color:#bfbab0cc;">,</span><span> Request</span><span style="color:#bfbab0cc;">,</span><span> Response}</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">pub type </span><span style="color:#59c2ff;">FetchResponse</span><span style="color:#f29668;">&lt;</span><span>T</span><span style="color:#f29668;">&gt; = </span><span>Response&lt;Json&lt;</span><span style="font-style:italic;color:#39bae6;">Result</span><span>&lt;T, Error&gt;&gt;&gt;</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">FetchCallback</span><span style="color:#f29668;">&lt;</span><span>T</span><span style="color:#f29668;">&gt; = </span><span>Callback&lt;FetchResponse&lt;T&gt;&gt;</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">get_products</span><span>(</span><span style="color:#f29718;">callback</span><span style="color:#bfbab0cc;">: </span><span>FetchCallback&lt;</span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Product&gt;&gt;) </span><span style="color:#bfbab0cc;">-&gt;</span><span> FetchTask {
</span><span>    </span><span style="color:#ff7733;">let</span><span> req </span><span style="color:#f29668;">= </span><span>Request</span><span style="color:#f29668;">::</span><span>get(</span><span style="color:#c2d94c;">&quot;/products/products.json&quot;</span><span>)
</span><span>        </span><span style="color:#f29668;">.</span><span style="color:#f07178;">body</span><span>(Nothing)
</span><span>        </span><span style="color:#f29668;">.</span><span style="color:#f07178;">unwrap</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>    FetchService</span><span style="color:#f29668;">::</span><span>fetch(req</span><span style="color:#bfbab0cc;">,</span><span> callback)</span><span style="color:#f29668;">.</span><span style="color:#f07178;">unwrap</span><span>()
</span><span>}
</span></code></pre>
<p>API-интерфейс FetchService немного неудобен - он принимает объект запроса и обратный вызов в качестве аргументов и возвращает нечто, называемое «FetchTask». Одна удивительная проблема заключается в том, что сетевой запрос прерывается, если эта «FetchTask» отбрасывается. Итак, мы возвращаем это и сохраняем в нашем компоненте.</p>
<p>Давайте обновим lib.rs, чтобы добавить эти новые модули в дерево модулей: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>  </span><span style="font-style:italic;color:#5c6773;">// src/lib.rs
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">api</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">types</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">pages</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>  </span><span style="color:#ff7733;">use </span><span>pages</span><span style="color:#f29668;">::</span><span>Home</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>wasm_bindgen</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>  </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">wasm_bindgen</span><span>(start)]
</span><span>  </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">run_app</span><span>() {
</span><span>      App</span><span style="color:#f29668;">::</span><span>&lt;Home&gt;</span><span style="color:#f29668;">::</span><span>new()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">mount_to_body</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>  }
</span></code></pre>
<p>Наконец, давайте обновим наш компонент HomePage: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#f29668;">+ </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>api</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>types</span><span style="color:#f29668;">::</span><span>{CartProduct</span><span style="color:#bfbab0cc;">,</span><span> Product}</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">use </span><span>anyhow</span><span style="color:#f29668;">::</span><span>Error</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>format</span><span style="color:#f29668;">::</span><span>Json</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>services</span><span style="color:#f29668;">::</span><span>fetch</span><span style="color:#f29668;">::</span><span>FetchTask</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">- </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Clone)]
</span><span style="color:#f29668;">- </span><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">Product </span><span>{
</span><span>-     id</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">i32</span><span>,
</span><span>-     name</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>-     description</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>-     image</span><span style="color:#bfbab0cc;">:</span><span> String,
</span><span>-     price</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">f64</span><span>,
</span><span>- }
</span><span>
</span><span style="color:#f29668;">- </span><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">CartProduct </span><span>{
</span><span>-     product</span><span style="color:#bfbab0cc;">:</span><span> Product,
</span><span>-     quantity</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">i32</span><span>,
</span><span>- }
</span><span>
</span><span>  </span><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">State </span><span>{
</span><span>      products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Product&gt;,
</span><span>      cart_products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;CartProduct&gt;,
</span><span>+     get_products_error</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;Error&gt;,
</span><span>+     get_products_loaded</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">bool</span><span>,
</span><span>  }
</span><span>
</span><span>  </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Home </span><span>{
</span><span>      state</span><span style="color:#bfbab0cc;">:</span><span> State,
</span><span>      link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;,
</span><span>+     task</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;FetchTask&gt;,
</span><span>  }
</span><span>
</span><span>  </span><span style="color:#ff7733;">pub enum </span><span style="color:#59c2ff;">Msg </span><span>{
</span><span>      AddToCart(</span><span style="color:#ff7733;">i32</span><span>)</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>     GetProducts</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>     GetProductsSuccess(</span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Product&gt;)</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>     GetProductsError(Error)</span><span style="color:#bfbab0cc;">,
</span><span>  }
</span><span>
</span><span>  </span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">Home </span><span>{
</span><span>      </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Message </span><span style="color:#f29668;">=</span><span> Msg</span><span style="color:#bfbab0cc;">;
</span><span>      </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Properties </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29718;">link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span style="color:#f29668;">-         </span><span style="color:#ff7733;">let</span><span> products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Product&gt; </span><span style="color:#f29668;">= </span><span style="color:#f07178;">vec!</span><span>[
</span><span style="color:#f29668;">-</span><span>             Product {
</span><span style="color:#f29668;">-</span><span>                 id</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-</span><span>                 name</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;Apple&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-</span><span>                 description</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;An apple a day keeps the doctor away&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-</span><span>                 image</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;/products/apple.png&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-</span><span>                 price</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">3.65</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-             </span><span>}</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-</span><span>             Product {
</span><span style="color:#f29668;">-</span><span>                 id</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">2</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-</span><span>                 name</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;Banana&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-</span><span>                 description</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;An old banana leaf was once young and green&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-</span><span>                 image</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;/products/banana.png&quot;</span><span style="color:#f29668;">.</span><span style="color:#f07178;">to_string</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-</span><span>                 price</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">7.99</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-             </span><span>}</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-         </span><span>]</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+         </span><span style="color:#ff7733;">let</span><span> products </span><span style="color:#f29668;">= </span><span style="color:#f07178;">vec!</span><span>[]</span><span style="color:#bfbab0cc;">;
</span><span>          </span><span style="color:#ff7733;">let</span><span> cart_products </span><span style="color:#f29668;">= </span><span style="color:#f07178;">vec!</span><span>[]</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">+</span><span>         link</span><span style="color:#f29668;">.</span><span style="color:#f07178;">send_message</span><span>(Msg</span><span style="color:#f29668;">::</span><span>GetProducts)</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>          </span><span style="color:#ff7733;">Self </span><span>{
</span><span>              state</span><span style="color:#bfbab0cc;">:</span><span> State {
</span><span>                  products</span><span style="color:#bfbab0cc;">,
</span><span>                  cart_products</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>                 get_products_error</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>                 get_products_loaded</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">false</span><span style="color:#bfbab0cc;">,
</span><span>              }</span><span style="color:#bfbab0cc;">,
</span><span>              link</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>             task</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>          }
</span><span>      }
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">update</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">message</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Message) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>          </span><span style="color:#ff7733;">match</span><span> message {
</span><span style="color:#f29668;">+             </span><span>Msg</span><span style="color:#f29668;">::</span><span>GetProducts </span><span style="color:#f29668;">=&gt; </span><span>{
</span><span style="color:#f29668;">+                 </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_products_loaded </span><span style="color:#f29668;">= </span><span style="color:#f29718;">false</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+                 </span><span style="color:#ff7733;">let</span><span> handler </span><span style="color:#f29668;">=
</span><span style="color:#f29668;">+                     </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>link
</span><span style="color:#f29668;">+                         .</span><span style="color:#f07178;">callback</span><span>(</span><span style="color:#ff7733;">move </span><span style="color:#f29668;">|</span><span>response</span><span style="color:#bfbab0cc;">: </span><span>api</span><span style="color:#f29668;">::</span><span>FetchResponse&lt;</span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Product&gt;&gt;</span><span style="color:#f29668;">| </span><span>{
</span><span style="color:#f29668;">+                             </span><span style="color:#ff7733;">let </span><span>(</span><span style="color:#f29668;">_</span><span style="color:#bfbab0cc;">,</span><span> Json(data)) </span><span style="color:#f29668;">=</span><span> response</span><span style="color:#f29668;">.</span><span style="color:#f07178;">into_parts</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+                             </span><span style="color:#ff7733;">match</span><span> data {
</span><span style="color:#f29668;">+                                 </span><span style="font-style:italic;color:#39bae6;">Ok</span><span>(products) </span><span style="color:#f29668;">=&gt; </span><span>Msg</span><span style="color:#f29668;">::</span><span>GetProductsSuccess(products)</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+                                 </span><span style="font-style:italic;color:#39bae6;">Err</span><span>(err) </span><span style="color:#f29668;">=&gt; </span><span>Msg</span><span style="color:#f29668;">::</span><span>GetProductsError(err)</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+                             </span><span>}
</span><span style="color:#f29668;">+                         </span><span>})</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+                 </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>task </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(api</span><span style="color:#f29668;">::</span><span>get_products(handler))</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+                 </span><span style="color:#f29718;">true
</span><span style="color:#f29668;">+             </span><span>}
</span><span style="color:#f29668;">+             </span><span>Msg</span><span style="color:#f29668;">::</span><span>GetProductsSuccess(products) </span><span style="color:#f29668;">=&gt; </span><span>{
</span><span style="color:#f29668;">+                 </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>products </span><span style="color:#f29668;">=</span><span> products</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+                 </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_products_loaded </span><span style="color:#f29668;">= </span><span style="color:#f29718;">true</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+                 </span><span style="color:#f29718;">true
</span><span style="color:#f29668;">+             </span><span>}
</span><span style="color:#f29668;">+             </span><span>Msg</span><span style="color:#f29668;">::</span><span>GetProductsError(error) </span><span style="color:#f29668;">=&gt; </span><span>{
</span><span style="color:#f29668;">+                 </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_products_error </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(error)</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+                 </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_products_loaded </span><span style="color:#f29668;">= </span><span style="color:#f29718;">true</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+                 </span><span style="color:#f29718;">true
</span><span style="color:#f29668;">+             </span><span>}
</span><span>              Msg</span><span style="color:#f29668;">::</span><span>AddToCart(product_id) </span><span style="color:#f29668;">=&gt; </span><span>{
</span><span>                  </span><span style="color:#ff7733;">let</span><span> product </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span>                      </span><span style="color:#f29668;">.</span><span>state
</span><span>                      </span><span style="color:#f29668;">.</span><span>products
</span><span>                      </span><span style="color:#f29668;">.</span><span style="color:#f07178;">iter</span><span>()
</span><span>                      </span><span style="color:#f29668;">.</span><span style="color:#f07178;">find</span><span>(|</span><span style="color:#f29718;">p</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29668;">&amp;&amp;</span><span>Product| p</span><span style="color:#f29668;">.</span><span>id </span><span style="color:#f29668;">==</span><span> product_id)
</span><span>                      </span><span style="color:#f29668;">.</span><span style="color:#f07178;">unwrap</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>                  </span><span style="color:#ff7733;">let</span><span> cart_product </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span>                      </span><span style="color:#f29668;">.</span><span>state
</span><span>                      </span><span style="color:#f29668;">.</span><span>cart_products
</span><span>                      </span><span style="color:#f29668;">.</span><span style="color:#f07178;">iter_mut</span><span>()
</span><span>                      </span><span style="color:#f29668;">.</span><span style="color:#f07178;">find</span><span>(|</span><span style="color:#f29718;">cp</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29668;">&amp;&amp;</span><span style="color:#ff7733;">mut</span><span> CartProduct| cp</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>id </span><span style="color:#f29668;">==</span><span> product_id)</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>                  </span><span style="color:#ff7733;">if let </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(cp) </span><span style="color:#f29668;">=</span><span> cart_product {
</span><span>                      cp</span><span style="color:#f29668;">.</span><span>quantity </span><span style="color:#f29668;">+= </span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">;
</span><span>                  } </span><span style="color:#ff7733;">else </span><span>{
</span><span>                      </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>cart_products</span><span style="color:#f29668;">.</span><span style="color:#f07178;">push</span><span>(CartProduct {
</span><span>                          product</span><span style="color:#bfbab0cc;">:</span><span> product</span><span style="color:#f29668;">.</span><span style="color:#f07178;">clone</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span>                          quantity</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">,
</span><span>                      })
</span><span>                  }
</span><span>                  </span><span style="color:#f29718;">true
</span><span>              }
</span><span>          }
</span><span>      }
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">change</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>          </span><span style="color:#f29718;">true
</span><span>      }
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span>          </span><span style="color:#ff7733;">let</span><span> products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Html&gt; </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span>              </span><span style="color:#f29668;">.</span><span>state
</span><span>              </span><span style="color:#f29668;">.</span><span>products
</span><span>              </span><span style="color:#f29668;">.</span><span style="color:#f07178;">iter</span><span>()
</span><span>              </span><span style="color:#f29668;">.</span><span style="color:#f07178;">map</span><span>(|</span><span style="color:#f29718;">product</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29668;">&amp;</span><span>Product| {
</span><span>                  </span><span style="color:#ff7733;">let</span><span> product_id </span><span style="color:#f29668;">=</span><span> product</span><span style="color:#f29668;">.</span><span>id</span><span style="color:#bfbab0cc;">;
</span><span>                  </span><span style="color:#f07178;">html! </span><span>{
</span><span>                    </span><span style="color:#f29668;">&lt;</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                      </span><span style="color:#f29668;">&lt;</span><span>img src</span><span style="color:#f29668;">=</span><span>{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>image}</span><span style="color:#f29668;">/&gt;
</span><span>                      </span><span style="color:#f29668;">&lt;</span><span>div</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>name}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                      </span><span style="color:#f29668;">&lt;</span><span>div</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;$&quot;</span><span>}{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>price}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                      </span><span style="color:#f29668;">&lt;</span><span>button onclick</span><span style="color:#f29668;">=</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>link</span><span style="color:#f29668;">.</span><span style="color:#f07178;">callback</span><span>(</span><span style="color:#ff7733;">move </span><span style="color:#f29668;">|_| </span><span>Msg</span><span style="color:#f29668;">::</span><span>AddToCart(product_id))</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Add To Cart&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>button</span><span style="color:#f29668;">&gt;
</span><span>                    </span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                  }
</span><span>              })
</span><span>              </span><span style="color:#f29668;">.</span><span style="color:#f07178;">collect</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>          </span><span style="color:#ff7733;">let</span><span> cart_value </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span>              </span><span style="color:#f29668;">.</span><span>state
</span><span>              </span><span style="color:#f29668;">.</span><span>cart_products
</span><span>              </span><span style="color:#f29668;">.</span><span style="color:#f07178;">iter</span><span>()
</span><span>              </span><span style="color:#f29668;">.</span><span style="color:#f07178;">fold</span><span>(</span><span style="color:#f29718;">0.0</span><span style="color:#bfbab0cc;">, </span><span>|</span><span style="color:#f29718;">acc</span><span style="color:#bfbab0cc;">, </span><span style="color:#f29718;">cp</span><span>| acc </span><span style="color:#f29668;">+ </span><span>(cp</span><span style="color:#f29668;">.</span><span>quantity </span><span style="color:#f29668;">as </span><span style="color:#ff7733;">f64 </span><span style="color:#f29668;">*</span><span> cp</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>price))</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">+         </span><span style="color:#ff7733;">if </span><span style="color:#f29668;">!</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_products_loaded {
</span><span style="color:#f29668;">+             </span><span style="color:#f07178;">html! </span><span>{
</span><span style="color:#f29668;">+               &lt;</span><span>div</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Loading ...&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+             </span><span>}
</span><span style="color:#f29668;">+         </span><span>} </span><span style="color:#ff7733;">else if let </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(</span><span style="color:#f29668;">_</span><span>) </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_products_error {
</span><span style="color:#f29668;">+             </span><span style="color:#f07178;">html! </span><span>{
</span><span style="color:#f29668;">+               &lt;</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+                 &lt;</span><span>span</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Error loading products! :(&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>span</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+               &lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+             </span><span>}
</span><span style="color:#f29668;">+         </span><span>} </span><span style="color:#ff7733;">else </span><span>{
</span><span>              </span><span style="color:#f07178;">html! </span><span>{
</span><span>                </span><span style="color:#f29668;">&lt;</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                  </span><span style="color:#f29668;">&lt;</span><span>span</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f07178;">format!</span><span>(</span><span style="color:#c2d94c;">&quot;Cart Value: </span><span style="color:#f29718;">{:.2}</span><span style="color:#c2d94c;">&quot;</span><span style="color:#bfbab0cc;">,</span><span> cart_value)}</span><span style="color:#f29668;">&lt;/</span><span>span</span><span style="color:#f29668;">&gt;
</span><span>                  </span><span style="color:#f29668;">&lt;</span><span>span</span><span style="color:#f29668;">&gt;</span><span>{products}</span><span style="color:#f29668;">&lt;/</span><span>span</span><span style="color:#f29668;">&gt;
</span><span>                </span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>              }
</span><span style="color:#f29668;">+         </span><span>}
</span><span>      }
</span><span>  }
</span></code></pre>
<p>Достаточно много изменений, но вы должны уметь разбираться в большинстве из них.</p>
<ul>
<li>Мы заменили жестко запрограммированный список продуктов в create пустым массивом. Мы также отправляем сообщение Msg::GetProducts для обновления, которое вызывает метод get_products в модуле api. Возвращенный FetchTask сохраняется в task.</li>
<li>При успешном выполнении сетевого запроса вызывается сообщение Msg::GetProductsSuccess со списком продуктов или Msg::GetProductsError с ошибкой.</li>
<li>Эти два сообщения устанавливают поля products и get_products_error в состояние соответственно. Они также устанавливают для состояния get_products_loaded значение true после выполнения запроса.</li>
<li>В методе представления мы использовали условную визуализацию для визуализации представления загрузки, представления ошибок или представления продуктов в зависимости от состояния компонента.</li>
</ul>
<p><img src="/imgs/posts/ebe0fe80_06.png" alt="" /></p>
<h2 id="razdelenie-na-povtorno-ispol-zuemye-komponenty">Разделение на повторно используемые компоненты</h2>
<p>Давайте извлечем компонент «карточка продукта» в отдельный модуль, чтобы мы могли повторно использовать его на других страницах. </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="font-style:italic;color:#5c6773;">// src/components/product_card.rs
</span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>types</span><span style="color:#f29668;">::</span><span>Product</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">ProductCard </span><span>{
</span><span>    props</span><span style="color:#bfbab0cc;">:</span><span> Props,
</span><span>}
</span><span>
</span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Properties</span><span style="color:#bfbab0cc;">,</span><span> Clone)]
</span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Props </span><span>{
</span><span>    </span><span style="color:#ff7733;">pub </span><span>product</span><span style="color:#bfbab0cc;">:</span><span> Product,
</span><span>    </span><span style="color:#ff7733;">pub </span><span>on_add_to_cart</span><span style="color:#bfbab0cc;">: </span><span>Callback&lt;()&gt;,
</span><span>}
</span><span>
</span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">ProductCard </span><span>{
</span><span>    </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Message </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Properties </span><span style="color:#f29668;">=</span><span> Props</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29718;">props</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29718;">_link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span>        </span><span style="color:#ff7733;">Self </span><span>{ props }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">update</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">_msg</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Message) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>        </span><span style="color:#f29718;">true
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">change</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">_props</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>        </span><span style="color:#f29718;">true
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span>        </span><span style="color:#ff7733;">let</span><span> onclick </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>on_add_to_cart</span><span style="color:#f29668;">.</span><span style="color:#f07178;">reform</span><span>(|_|())</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>        </span><span style="color:#f07178;">html! </span><span>{
</span><span>          </span><span style="color:#f29668;">&lt;</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>            </span><span style="color:#f29668;">&lt;</span><span>img src</span><span style="color:#f29668;">=</span><span>{</span><span style="color:#f29668;">&amp;</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>image}</span><span style="color:#f29668;">/&gt;
</span><span>            </span><span style="color:#f29668;">&lt;</span><span>div</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f29668;">&amp;</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>name}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>            </span><span style="color:#f29668;">&lt;</span><span>div</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;$&quot;</span><span>}{</span><span style="color:#f29668;">&amp;</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>price}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>            </span><span style="color:#f29668;">&lt;</span><span>button onclick</span><span style="color:#f29668;">=</span><span>onclick</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Add To Cart&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>button</span><span style="color:#f29668;">&gt;
</span><span>          </span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>        }
</span><span>    }
</span><span>}
</span><span>
</span><span style="font-style:italic;color:#5c6773;">// src/components/mod.rs
</span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">product_card</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">pub use </span><span>product_card</span><span style="color:#f29668;">::</span><span>ProductCard</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6773;">// src/lib.rs
</span><span>  </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">api</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">components</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">pages</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">types</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6773;">// No changes
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6773;">// src/pages/home.rs
</span><span>
</span><span>  </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>api</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>components</span><span style="color:#f29668;">::</span><span>ProductCard</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>types</span><span style="color:#f29668;">::</span><span>{CartProduct</span><span style="color:#bfbab0cc;">,</span><span> Product}</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>anyhow</span><span style="color:#f29668;">::</span><span>Error</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>format</span><span style="color:#f29668;">::</span><span>Json</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>services</span><span style="color:#f29668;">::</span><span>fetch</span><span style="color:#f29668;">::</span><span>FetchTask</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6773;">// No changes
</span><span>
</span><span>  </span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">Home </span><span>{
</span><span>      </span><span style="font-style:italic;color:#5c6773;">// No changes
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span>          </span><span style="color:#ff7733;">let</span><span> products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Html&gt; </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span>              </span><span style="color:#f29668;">.</span><span>state
</span><span>              </span><span style="color:#f29668;">.</span><span>products
</span><span>              </span><span style="color:#f29668;">.</span><span style="color:#f07178;">iter</span><span>()
</span><span>              </span><span style="color:#f29668;">.</span><span style="color:#f07178;">map</span><span>(|</span><span style="color:#f29718;">product</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29668;">&amp;</span><span>Product| {
</span><span>                  </span><span style="color:#ff7733;">let</span><span> product_id </span><span style="color:#f29668;">=</span><span> product</span><span style="color:#f29668;">.</span><span>id</span><span style="color:#bfbab0cc;">;
</span><span>                  </span><span style="color:#f07178;">html! </span><span>{
</span><span style="color:#f29668;">-                   &lt;</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-                     &lt;</span><span>img src</span><span style="color:#f29668;">=</span><span>{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>image}</span><span style="color:#f29668;">/&gt;
</span><span style="color:#f29668;">-                     &lt;</span><span>div</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>name}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-                     &lt;</span><span>div</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;$&quot;</span><span>}{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>price}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-                     &lt;</span><span>button onclick</span><span style="color:#f29668;">=</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>link</span><span style="color:#f29668;">.</span><span style="color:#f07178;">callback</span><span>(</span><span style="color:#ff7733;">move </span><span style="color:#f29668;">|_| </span><span>Msg</span><span style="color:#f29668;">::</span><span>AddToCart(product_id))</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Add To Cart&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>button</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-                   &lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+                   &lt;</span><span>ProductCard product</span><span style="color:#f29668;">=</span><span>{product} on_add_to_cart</span><span style="color:#f29668;">=</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>link</span><span style="color:#f29668;">.</span><span style="color:#f07178;">callback</span><span>(</span><span style="color:#ff7733;">move </span><span style="color:#f29668;">|_| </span><span>Msg</span><span style="color:#f29668;">::</span><span>AddToCart(product_id))</span><span style="color:#f29668;">/&gt;
</span><span>                  }
</span><span>              })
</span><span>              </span><span style="color:#f29668;">.</span><span style="color:#f07178;">collect</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>          </span><span style="font-style:italic;color:#5c6773;">// No changes
</span><span>      }
</span><span>  }
</span></code></pre>
<p>Довольно просто, за исключением свойств, обратного вызова и реформы.</p>
<ul>
<li>Свойства. Как упоминалось в начале сообщения, компоненту вводятся «Свойства» или «Свойства». Если вы думаете о компонентах как о функциях, то Props - это аргументы функции.</li>
<li>Для компонента ProductCard мы передаем структуру Product, а также обратный вызов on_add_to_cart. Этот компонент не содержит никакого состояния, поэтому, когда пользователь нажимает кнопку «Добавить в корзину», этот компонент вызывает родительский компонент для обновления состояния cart_products. Этот обратный вызов представлен с использованием типа Callback<T>, и чтобы вызвать его из дочернего компонента, мы либо используем методы emit, либо методы преобразования для обратного вызова.</li>
</ul>
<p><img src="/imgs/posts/ebe0fe80_07.png" alt="" /></p>
<h2 id="stil">Стиль</h2>
<p>Пользовательский интерфейс выглядит просто, поскольку мы не добавляли никаких стилей.</p>
<p><img src="/imgs/posts/ebe0fe80_08.png" alt="" /></p>
<p>Мы можем использовать либо атрибут class, либо встроенные стили с Yew. Давайте добавим несколько стилей, чтобы интерфейс выглядел хорошо.</p>
<p>Давайте создадим новый файл CSS static / styles.css, добавим его в static / index.html, а затем мы сможем начать использовать классы в наших компонентах. </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>  </span><span style="font-style:italic;color:#5c6773;">// src/pages/home.rs
</span><span>
</span><span>  </span><span style="color:#f07178;">html! </span><span>{
</span><span>    </span><span style="color:#f29668;">&lt;</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-     &lt;</span><span>span</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f07178;">format!</span><span>(</span><span style="color:#c2d94c;">&quot;Cart Value: </span><span style="color:#f29718;">{:.2}</span><span style="color:#c2d94c;">&quot;</span><span style="color:#bfbab0cc;">,</span><span> cart_value)}</span><span style="color:#f29668;">&lt;/</span><span>span</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-     &lt;</span><span>span</span><span style="color:#f29668;">&gt;</span><span>{products}</span><span style="color:#f29668;">&lt;/</span><span>span</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+     &lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;navbar&quot;</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+         &lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;navbar_title&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;RustMart&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+         &lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;navbar_cart_value&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f07178;">format!</span><span>(</span><span style="color:#c2d94c;">&quot;$</span><span style="color:#f29718;">{:.2}</span><span style="color:#c2d94c;">&quot;</span><span style="color:#bfbab0cc;">,</span><span> cart_value)}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+     &lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+     &lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_list&quot;</span><span style="color:#f29668;">&gt;</span><span>{products}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>    </span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>  }
</span></code></pre>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>  </span><span style="font-style:italic;color:#5c6773;">// src/components/product_card.rs
</span><span>  </span><span style="color:#f07178;">html! </span><span>{
</span><span style="color:#f29668;">-   &lt;</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-     &lt;</span><span>img src</span><span style="color:#f29668;">=</span><span>{</span><span style="color:#f29668;">&amp;</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>image}</span><span style="color:#f29668;">/&gt;
</span><span style="color:#f29668;">-     &lt;</span><span>div</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f29668;">&amp;</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>name}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-     &lt;</span><span>div</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;$&quot;</span><span>}{</span><span style="color:#f29668;">&amp;</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>price}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-     &lt;</span><span>button onclick</span><span style="color:#f29668;">=</span><span>onclick</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Add To Cart&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>button</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-   &lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+   &lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_container&quot;</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+     &lt;</span><span>img class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_image&quot;</span><span> src</span><span style="color:#f29668;">=</span><span>{</span><span style="color:#f29668;">&amp;</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>image}</span><span style="color:#f29668;">/&gt;
</span><span style="color:#f29668;">+     &lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_name&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f29668;">&amp;</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>name}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+     &lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_price&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;$&quot;</span><span>}{</span><span style="color:#f29668;">&amp;</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>price}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+     &lt;</span><span>button class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_atc_button&quot;</span><span> onclick</span><span style="color:#f29668;">=</span><span>onclick</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Add To Cart&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>button</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+   &lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>  }
</span></code></pre>
<p>После добавления стилей и еще нескольких продуктов, вот как выглядит пользовательский интерфейс:</p>
<p><img src="/imgs/posts/ebe0fe80_09.png" alt="" /></p>
<p>Изменения CSS выходят за рамки этой публикации, обратитесь к репозиторию GitHub.</p>
<h2 id="marshrutizatsiia">Маршрутизация</h2>
<p>На страницах, отображаемых на сервере (Jinja, ERB, JSP и т.д.), Каждая страница, которую видит пользователь, отображается в отдельный файл шаблона. Например, когда пользователь переходит к «/ login», он отображается на сервере с использованием «login.html», а когда пользователь переходит к «/ settings», он отображается с использованием «settings.html». Использование уникальных URL-адресов для разных страниц пользовательского интерфейса также полезно для создания закладок и обмена.</p>
<p>Поскольку в SPA есть только одна html-страница («Одна страница» в SPA), мы должны иметь возможность воспроизвести описанное выше поведение. Это делается с помощью маршрутизатора. Маршрутизатор сопоставляет разные URL-адреса (с параметрами запроса, фрагментами и т.д.) С разными компонентами страницы и помогает перемещаться между несколькими страницами без перезагрузки.</p>
<p>Для нашего приложения мы будем использовать это сопоставление: </p>
<pre style="background-color:#0f1419;color:#bfbab0;"><code><span>/            =&gt; HomePage
</span><span>/product/:id =&gt; ProductDetailPage
</span></code></pre>
<p>Установим тис-роутер: </p>
<pre data-lang="toml" style="background-color:#0f1419;color:#bfbab0;" class="language-toml "><code class="language-toml" data-lang="toml"><span>  [</span><span style="color:#59c2ff;">package</span><span>]
</span><span>  </span><span style="color:#59c2ff;">name </span><span>= </span><span style="color:#c2d94c;">&quot;rustmart&quot;
</span><span>  </span><span style="color:#59c2ff;">version </span><span>= </span><span style="color:#c2d94c;">&quot;0.1.0&quot;
</span><span>  </span><span style="color:#59c2ff;">authors </span><span>= [</span><span style="color:#c2d94c;">&quot;sheshbabu &lt;sheshbabu@gmail.com&gt;&quot;</span><span>]
</span><span>  </span><span style="color:#59c2ff;">edition </span><span>= </span><span style="color:#c2d94c;">&quot;2018&quot;
</span><span>
</span><span>  [</span><span style="color:#59c2ff;">lib</span><span>]
</span><span>  </span><span style="color:#59c2ff;">crate-type </span><span>= [</span><span style="color:#c2d94c;">&quot;cdylib&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#c2d94c;">&quot;rlib&quot;</span><span>]
</span><span>
</span><span>  [</span><span style="color:#59c2ff;">dependencies</span><span>]
</span><span>  </span><span style="color:#59c2ff;">yew </span><span>= </span><span style="color:#c2d94c;">&quot;0.17&quot;
</span><span style="color:#ff3333;">+ yew-router = &quot;0.14.0&quot;
</span><span>  </span><span style="color:#59c2ff;">wasm-bindgen </span><span>= </span><span style="color:#c2d94c;">&quot;0.2&quot;
</span><span>  </span><span style="color:#59c2ff;">log </span><span>= </span><span style="color:#c2d94c;">&quot;0.4.6&quot;
</span><span>  </span><span style="color:#59c2ff;">wasm-logger </span><span>= </span><span style="color:#c2d94c;">&quot;0.2.0&quot;
</span><span>  </span><span style="color:#59c2ff;">anyhow </span><span>= </span><span style="color:#c2d94c;">&quot;1.0.32&quot;
</span><span>  </span><span style="color:#59c2ff;">serde </span><span>= { </span><span style="color:#59c2ff;">version </span><span>= </span><span style="color:#c2d94c;">&quot;1.0&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#59c2ff;">features </span><span>= [</span><span style="color:#c2d94c;">&quot;derive&quot;</span><span>] }
</span></code></pre>
<p>Давайте добавим маршруты в специальный файл, чтобы было легче увидеть все доступные маршруты: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="font-style:italic;color:#5c6773;">// src/route.rs
</span><span style="color:#ff7733;">use </span><span>yew_router</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Switch</span><span style="color:#bfbab0cc;">,</span><span> Debug</span><span style="color:#bfbab0cc;">,</span><span> Clone)]
</span><span style="color:#ff7733;">pub enum </span><span style="color:#59c2ff;">Route </span><span>{
</span><span>    </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">to </span><span style="color:#f29668;">= </span><span style="color:#c2d94c;">&quot;/&quot;</span><span>]
</span><span>    HomePage</span><span style="color:#bfbab0cc;">,
</span><span>}
</span></code></pre>
<p>Пока у него только один маршрут. Мы добавим больше позже.</p>
<p>Давайте создадим новый файл с именем src/app.rs, чтобы заменить HomePage в качестве нового корневого компонента: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">use </span><span>yew_router</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>pages</span><span style="color:#f29668;">::</span><span>Home</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>route</span><span style="color:#f29668;">::</span><span>Route</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">App </span><span>{}
</span><span>
</span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">App </span><span>{
</span><span>    </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Message </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Properties </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29718;">_link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span>        </span><span style="color:#ff7733;">Self </span><span>{}
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">update</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">_msg</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Message) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>        </span><span style="color:#f29718;">true
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">change</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>        </span><span style="color:#f29718;">false
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span>        </span><span style="color:#ff7733;">let</span><span> render </span><span style="color:#f29668;">= </span><span>Router</span><span style="color:#f29668;">::</span><span>render(|</span><span style="color:#f29718;">switch</span><span style="color:#bfbab0cc;">:</span><span> Route| </span><span style="color:#ff7733;">match</span><span> switch {
</span><span>            Route</span><span style="color:#f29668;">::</span><span>HomePage </span><span style="color:#f29668;">=&gt; </span><span style="color:#f07178;">html! </span><span>{</span><span style="color:#f29668;">&lt;</span><span>Home</span><span style="color:#f29668;">/&gt;</span><span>}</span><span style="color:#bfbab0cc;">,
</span><span>        })</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>        </span><span style="color:#f07178;">html! </span><span>{
</span><span>            </span><span style="color:#f29668;">&lt;</span><span>Router&lt;Route,()&gt; render</span><span style="color:#f29668;">=</span><span>render</span><span style="color:#f29668;">/&gt;
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre>
<p>Сделаем соответствующее изменение в lib.rs: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>  </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">api</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">app</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">components</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">pages</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">route</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">types</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">- </span><span style="color:#ff7733;">use </span><span>pages</span><span style="color:#f29668;">::</span><span>Home</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>wasm_bindgen</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>  </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">wasm_bindgen</span><span>(start)]
</span><span>  </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">run_app</span><span>() {
</span><span>      wasm_logger</span><span style="color:#f29668;">::</span><span>init(wasm_logger</span><span style="color:#f29668;">::</span><span>Config</span><span style="color:#f29668;">::</span><span>default())</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">-     </span><span>App</span><span style="color:#f29668;">::</span><span>&lt;Home&gt;</span><span style="color:#f29668;">::</span><span>new()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">mount_to_body</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+     </span><span>App</span><span style="color:#f29668;">::</span><span>&lt;app</span><span style="color:#f29668;">::</span><span>App&gt;</span><span style="color:#f29668;">::</span><span>new()</span><span style="color:#f29668;">.</span><span style="color:#f07178;">mount_to_body</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>  }
</span></code></pre>
<p>Вот как выглядит наша иерархия компонентов на данный момент:</p>
<p><img src="/imgs/posts/ebe0fe80_10.png" alt="" /></p>
<h2 id="productdetailpage">ProductDetailPage</h2>
<p>Теперь, когда у нас есть маршрутизатор, давайте будем использовать его для перехода с одной страницы на другую. Поскольку это SPA, нам следует избегать перезагрузки страницы во время навигации.</p>
<p>Давайте добавим маршрут для ProductDetailPage в / product /: id. Когда пользователь нажимает на ProductCard, он переходит на страницу сведений с идентификатором в маршруте, переданным как Prop. </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>  </span><span style="font-style:italic;color:#5c6773;">// src/route.rs
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew_router</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>  </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Switch</span><span style="color:#bfbab0cc;">,</span><span> Debug</span><span style="color:#bfbab0cc;">,</span><span> Clone)]
</span><span>  </span><span style="color:#ff7733;">pub enum </span><span style="color:#59c2ff;">Route </span><span>{
</span><span style="color:#f29668;">+     </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">to </span><span style="color:#f29668;">= </span><span style="color:#c2d94c;">&quot;/product/{id}&quot;</span><span>]
</span><span style="color:#f29668;">+</span><span>     ProductDetail(</span><span style="color:#ff7733;">i32</span><span>)</span><span style="color:#bfbab0cc;">,
</span><span>      </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">to </span><span style="color:#f29668;">= </span><span style="color:#c2d94c;">&quot;/&quot;</span><span>]
</span><span>      HomePage</span><span style="color:#bfbab0cc;">,
</span><span>  }
</span></code></pre>
<p>Обратите внимание, что порядок приведенных выше маршрутов определяет, какая страница будет отображаться первой. Например, url / product / 2 соответствует как / product / {id}, так и /, но, поскольку мы сначала написали / product / {id}, страница ProductDetail отображается вместо Home.</p>
<p>Добавьте этот маршрут в app.rs: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew_router</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">- </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>pages</span><span style="color:#f29668;">::</span><span>{Home}</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>pages</span><span style="color:#f29668;">::</span><span>{Home</span><span style="color:#bfbab0cc;">,</span><span> ProductDetail}</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>route</span><span style="color:#f29668;">::</span><span>Route</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>  </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">App </span><span>{}
</span><span>
</span><span>  </span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">App </span><span>{
</span><span>      </span><span style="font-style:italic;color:#5c6773;">// No changes
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span>          </span><span style="color:#ff7733;">let</span><span> render </span><span style="color:#f29668;">= </span><span>Router</span><span style="color:#f29668;">::</span><span>render(|</span><span style="color:#f29718;">switch</span><span style="color:#bfbab0cc;">:</span><span> Route| </span><span style="color:#ff7733;">match</span><span> switch {
</span><span style="color:#f29668;">+             </span><span>Route</span><span style="color:#f29668;">::</span><span>ProductDetail(id) </span><span style="color:#f29668;">=&gt; </span><span style="color:#f07178;">html! </span><span>{</span><span style="color:#f29668;">&lt;</span><span>ProductDetail id</span><span style="color:#f29668;">=</span><span>id</span><span style="color:#f29668;">/&gt;</span><span>}</span><span style="color:#bfbab0cc;">,
</span><span>              Route</span><span style="color:#f29668;">::</span><span>HomePage </span><span style="color:#f29668;">=&gt; </span><span style="color:#f07178;">html! </span><span>{</span><span style="color:#f29668;">&lt;</span><span>Home</span><span style="color:#f29668;">/&gt;</span><span>}</span><span style="color:#bfbab0cc;">,
</span><span>          })</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>          </span><span style="color:#f07178;">html! </span><span>{
</span><span>              </span><span style="color:#f29668;">&lt;</span><span>Router&lt;Route,()&gt; render</span><span style="color:#f29668;">=</span><span>render</span><span style="color:#f29668;">/&gt;
</span><span>          }
</span><span>      }
</span><span>  }
</span></code></pre>
<p>Давайте обновим ProductCard, чтобы при нажатии на изображение, название или цену продукта мы попадали на эту новую страницу: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>  </span><span style="font-style:italic;color:#5c6773;">// src/components/product_card.rs
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>route</span><span style="color:#f29668;">::</span><span>Route</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>types</span><span style="color:#f29668;">::</span><span>Product</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">use </span><span>yew_router</span><span style="color:#f29668;">::</span><span>components</span><span style="color:#f29668;">::</span><span>RouterAnchor</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6773;">// No changes
</span><span>
</span><span>  </span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">ProductCard </span><span>{
</span><span>      </span><span style="font-style:italic;color:#5c6773;">// No changes
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span style="color:#f29668;">+         </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Anchor </span><span style="color:#f29668;">= </span><span>RouterAnchor&lt;Route&gt;</span><span style="color:#bfbab0cc;">;
</span><span>          </span><span style="color:#ff7733;">let</span><span> onclick </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>on_add_to_cart</span><span style="color:#f29668;">.</span><span style="color:#f07178;">reform</span><span>(|_|())</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>          </span><span style="color:#f07178;">html! </span><span>{
</span><span>              </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_container&quot;</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+                 &lt;</span><span>Anchor route</span><span style="color:#f29668;">=</span><span>Route</span><span style="color:#f29668;">::</span><span>ProductDetail(</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>id) classes</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_anchor&quot;</span><span style="color:#f29668;">&gt;
</span><span>                      </span><span style="color:#f29668;">&lt;</span><span>img class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_image&quot;</span><span> src</span><span style="color:#f29668;">=</span><span>{</span><span style="color:#f29668;">&amp;</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>image}</span><span style="color:#f29668;">/&gt;
</span><span>                      </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_name&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f29668;">&amp;</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>name}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                      </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_price&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;$&quot;</span><span>}{</span><span style="color:#f29668;">&amp;</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>price}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+                 &lt;/</span><span>Anchor</span><span style="color:#f29668;">&gt;
</span><span>                  </span><span style="color:#f29668;">&lt;</span><span>button class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_atc_button&quot;</span><span> onclick</span><span style="color:#f29668;">=</span><span>onclick</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Add To Cart&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>button</span><span style="color:#f29668;">&gt;
</span><span>              </span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>          }
</span><span>      }
</span><span>  }
</span></code></pre>
<p>Обратите внимание, как мы использовали классы вместо класса для якоря.</p>
<p>Мы создадим файлы с именами static / products / 1.json, static / products / 2.json и т.д. С фиктивными данными: </p>
<pre data-lang="json" style="background-color:#0f1419;color:#bfbab0;" class="language-json "><code class="language-json" data-lang="json"><span>{
</span><span>  </span><span style="color:#c2d94c;">&quot;id&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">,
</span><span>  </span><span style="color:#c2d94c;">&quot;name&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;Apple&quot;</span><span style="color:#bfbab0cc;">,
</span><span>  </span><span style="color:#c2d94c;">&quot;description&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;An apple a day keeps the doctor away&quot;</span><span style="color:#bfbab0cc;">,
</span><span>  </span><span style="color:#c2d94c;">&quot;image&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;/products/apple.png&quot;</span><span style="color:#bfbab0cc;">,
</span><span>  </span><span style="color:#c2d94c;">&quot;price&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">3</span><span style="color:#bfbab0cc;">.</span><span style="color:#f29718;">65
</span><span>}
</span></code></pre>
<p>Давайте обновим модуль api.rs новым маршрутом: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>  </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>types</span><span style="color:#f29668;">::</span><span>Product</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>anyhow</span><span style="color:#f29668;">::</span><span>Error</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>callback</span><span style="color:#f29668;">::</span><span>Callback</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>format</span><span style="color:#f29668;">::</span><span>{Json</span><span style="color:#bfbab0cc;">,</span><span> Nothing}</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>services</span><span style="color:#f29668;">::</span><span>fetch</span><span style="color:#f29668;">::</span><span>{FetchService</span><span style="color:#bfbab0cc;">,</span><span> FetchTask</span><span style="color:#bfbab0cc;">,</span><span> Request</span><span style="color:#bfbab0cc;">,</span><span> Response}</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>  </span><span style="color:#ff7733;">pub type </span><span style="color:#59c2ff;">FetchResponse</span><span style="color:#f29668;">&lt;</span><span>T</span><span style="color:#f29668;">&gt; = </span><span>Response&lt;Json&lt;</span><span style="font-style:italic;color:#39bae6;">Result</span><span>&lt;T, Error&gt;&gt;&gt;</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">FetchCallback</span><span style="color:#f29668;">&lt;</span><span>T</span><span style="color:#f29668;">&gt; = </span><span>Callback&lt;FetchResponse&lt;T&gt;&gt;</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>  </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">get_products</span><span>(</span><span style="color:#f29718;">callback</span><span style="color:#bfbab0cc;">: </span><span>FetchCallback&lt;</span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Product&gt;&gt;) </span><span style="color:#bfbab0cc;">-&gt;</span><span> FetchTask {
</span><span>      </span><span style="color:#ff7733;">let</span><span> req </span><span style="color:#f29668;">= </span><span>Request</span><span style="color:#f29668;">::</span><span>get(</span><span style="color:#c2d94c;">&quot;/products/products.json&quot;</span><span>)
</span><span>          </span><span style="color:#f29668;">.</span><span style="color:#f07178;">body</span><span>(Nothing)
</span><span>          </span><span style="color:#f29668;">.</span><span style="color:#f07178;">unwrap</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>      FetchService</span><span style="color:#f29668;">::</span><span>fetch(req</span><span style="color:#bfbab0cc;">,</span><span> callback)</span><span style="color:#f29668;">.</span><span style="color:#f07178;">unwrap</span><span>()
</span><span>  }
</span><span>
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">pub fn </span><span style="color:#ffb454;">get_product</span><span>(</span><span style="color:#f29718;">id</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">i32</span><span>, </span><span style="color:#f29718;">callback</span><span style="color:#bfbab0cc;">: </span><span>FetchCallback&lt;Product&gt;) </span><span style="color:#bfbab0cc;">-&gt;</span><span> FetchTask {
</span><span style="color:#f29668;">+     </span><span style="color:#ff7733;">let</span><span> req </span><span style="color:#f29668;">= </span><span>Request</span><span style="color:#f29668;">::</span><span>get(</span><span style="color:#f07178;">format!</span><span>(</span><span style="color:#c2d94c;">&quot;/products/</span><span style="color:#f29718;">{}</span><span style="color:#c2d94c;">.json&quot;</span><span style="color:#bfbab0cc;">,</span><span> id))
</span><span style="color:#f29668;">+         .</span><span style="color:#f07178;">body</span><span>(Nothing)
</span><span style="color:#f29668;">+         .</span><span style="color:#f07178;">unwrap</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+
</span><span style="color:#f29668;">+     </span><span>FetchService</span><span style="color:#f29668;">::</span><span>fetch(req</span><span style="color:#bfbab0cc;">,</span><span> callback)</span><span style="color:#f29668;">.</span><span style="color:#f07178;">unwrap</span><span>()
</span><span style="color:#f29668;">+ </span><span>}
</span></code></pre>
<p>Наконец, вот компонент страницы ProductDetail:</p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="font-style:italic;color:#5c6773;">// src/pages/product_detail.rs
</span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>api</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>types</span><span style="color:#f29668;">::</span><span>Product</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">use </span><span>anyhow</span><span style="color:#f29668;">::</span><span>Error</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>format</span><span style="color:#f29668;">::</span><span>Json</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>services</span><span style="color:#f29668;">::</span><span>fetch</span><span style="color:#f29668;">::</span><span>FetchTask</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">State </span><span>{
</span><span>    product</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;Product&gt;,
</span><span>    get_product_error</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;Error&gt;,
</span><span>    get_product_loaded</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">bool</span><span>,
</span><span>}
</span><span>
</span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">ProductDetail </span><span>{
</span><span>    props</span><span style="color:#bfbab0cc;">:</span><span> Props,
</span><span>    state</span><span style="color:#bfbab0cc;">:</span><span> State,
</span><span>    link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;,
</span><span>    task</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;FetchTask&gt;,
</span><span>}
</span><span>
</span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Properties</span><span style="color:#bfbab0cc;">,</span><span> Clone)]
</span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Props </span><span>{
</span><span>    </span><span style="color:#ff7733;">pub </span><span>id</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">i32</span><span>,
</span><span>}
</span><span>
</span><span style="color:#ff7733;">pub enum </span><span style="color:#59c2ff;">Msg </span><span>{
</span><span>    GetProduct</span><span style="color:#bfbab0cc;">,
</span><span>    GetProductSuccess(Product)</span><span style="color:#bfbab0cc;">,
</span><span>    GetProductError(Error)</span><span style="color:#bfbab0cc;">,
</span><span>}
</span><span>
</span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">ProductDetail </span><span>{
</span><span>    </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Message </span><span style="color:#f29668;">=</span><span> Msg</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Properties </span><span style="color:#f29668;">=</span><span> Props</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29718;">props</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29718;">link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span>        link</span><span style="color:#f29668;">.</span><span style="color:#f07178;">send_message</span><span>(Msg</span><span style="color:#f29668;">::</span><span>GetProduct)</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>        </span><span style="color:#ff7733;">Self </span><span>{
</span><span>            props</span><span style="color:#bfbab0cc;">,
</span><span>            state</span><span style="color:#bfbab0cc;">:</span><span> State {
</span><span>                product</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>                get_product_error</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>                get_product_loaded</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">false</span><span style="color:#bfbab0cc;">,
</span><span>            }</span><span style="color:#bfbab0cc;">,
</span><span>            link</span><span style="color:#bfbab0cc;">,
</span><span>            task</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">update</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">message</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Message) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>        </span><span style="color:#ff7733;">match</span><span> message {
</span><span>            Msg</span><span style="color:#f29668;">::</span><span>GetProduct </span><span style="color:#f29668;">=&gt; </span><span>{
</span><span>                </span><span style="color:#ff7733;">let</span><span> handler </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span>                    </span><span style="color:#f29668;">.</span><span>link
</span><span>                    </span><span style="color:#f29668;">.</span><span style="color:#f07178;">callback</span><span>(</span><span style="color:#ff7733;">move </span><span style="color:#f29668;">|</span><span>response</span><span style="color:#bfbab0cc;">: </span><span>api</span><span style="color:#f29668;">::</span><span>FetchResponse&lt;Product&gt;</span><span style="color:#f29668;">| </span><span>{
</span><span>                        </span><span style="color:#ff7733;">let </span><span>(</span><span style="color:#f29668;">_</span><span style="color:#bfbab0cc;">,</span><span> Json(data)) </span><span style="color:#f29668;">=</span><span> response</span><span style="color:#f29668;">.</span><span style="color:#f07178;">into_parts</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>                        </span><span style="color:#ff7733;">match</span><span> data {
</span><span>                            </span><span style="font-style:italic;color:#39bae6;">Ok</span><span>(product) </span><span style="color:#f29668;">=&gt; </span><span>Msg</span><span style="color:#f29668;">::</span><span>GetProductSuccess(product)</span><span style="color:#bfbab0cc;">,
</span><span>                            </span><span style="font-style:italic;color:#39bae6;">Err</span><span>(err) </span><span style="color:#f29668;">=&gt; </span><span>Msg</span><span style="color:#f29668;">::</span><span>GetProductError(err)</span><span style="color:#bfbab0cc;">,
</span><span>                        }
</span><span>                    })</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>                </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>task </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(api</span><span style="color:#f29668;">::</span><span>get_product(</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>id</span><span style="color:#bfbab0cc;">,</span><span> handler))</span><span style="color:#bfbab0cc;">;
</span><span>                </span><span style="color:#f29718;">true
</span><span>            }
</span><span>            Msg</span><span style="color:#f29668;">::</span><span>GetProductSuccess(product) </span><span style="color:#f29668;">=&gt; </span><span>{
</span><span>                </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>product </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(product)</span><span style="color:#bfbab0cc;">;
</span><span>                </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_product_loaded </span><span style="color:#f29668;">= </span><span style="color:#f29718;">true</span><span style="color:#bfbab0cc;">;
</span><span>                </span><span style="color:#f29718;">true
</span><span>            }
</span><span>            Msg</span><span style="color:#f29668;">::</span><span>GetProductError(error) </span><span style="color:#f29668;">=&gt; </span><span>{
</span><span>                </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_product_error </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(error)</span><span style="color:#bfbab0cc;">;
</span><span>                </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_product_loaded </span><span style="color:#f29668;">= </span><span style="color:#f29718;">true</span><span style="color:#bfbab0cc;">;
</span><span>                </span><span style="color:#f29718;">true
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">change</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>        </span><span style="color:#f29718;">false
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span>        </span><span style="color:#ff7733;">if let </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(</span><span style="color:#ff7733;">ref</span><span> product) </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>product {
</span><span>            </span><span style="color:#f07178;">html! </span><span>{
</span><span>                </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_detail_container&quot;</span><span style="color:#f29668;">&gt;
</span><span>                    </span><span style="color:#f29668;">&lt;</span><span>img class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_detail_image&quot;</span><span> src</span><span style="color:#f29668;">=</span><span>{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>image}</span><span style="color:#f29668;">/&gt;
</span><span>                    </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_name&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>name}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                    </span><span style="color:#f29668;">&lt;</span><span>div style</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;margin: 10px 0; line-height: 24px;&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>description}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                    </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_price&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;$&quot;</span><span>}{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>price}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                    </span><span style="color:#f29668;">&lt;</span><span>button class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_atc_button&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Add To Cart&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>button</span><span style="color:#f29668;">&gt;
</span><span>                </span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>            }
</span><span>        } </span><span style="color:#ff7733;">else if </span><span style="color:#f29668;">!</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_product_loaded {
</span><span>            </span><span style="color:#f07178;">html! </span><span>{
</span><span>                </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;loading_spinner_container&quot;</span><span style="color:#f29668;">&gt;
</span><span>                    </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;loading_spinner&quot;</span><span style="color:#f29668;">&gt;&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                    </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;loading_spinner_text&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Loading ...&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                </span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>            }
</span><span>        } </span><span style="color:#ff7733;">else </span><span>{
</span><span>            </span><span style="color:#f07178;">html! </span><span>{
</span><span>                </span><span style="color:#f29668;">&lt;</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                    </span><span style="color:#f29668;">&lt;</span><span>span</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Error loading product! :(&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>span</span><span style="color:#f29668;">&gt;
</span><span>                </span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre>
<p>Очень похоже на компонент HomePage. Давайте также добавим этот файл в дерево модулей: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>  </span><span style="font-style:italic;color:#5c6773;">// src/pages/mod.rs
</span><span>  </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">home</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">product_detail</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>  </span><span style="color:#ff7733;">pub use </span><span>home</span><span style="color:#f29668;">::</span><span>Home</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">pub use </span><span>product_detail</span><span style="color:#f29668;">::</span><span>ProductDetail</span><span style="color:#bfbab0cc;">;
</span></code></pre>
<p>Вот как это выглядит:</p>
<p><img src="/imgs/posts/ebe0fe80_11.png" alt="" /></p>
<p>Теперь мы можем перемещаться между несколькими страницами, не обновляя страницу!</p>
<h2 id="gosudarstvennoe-upravlenie">Государственное управление</h2>
<p>На странице ProductDetail вы могли заметить одну вещь: нажатие кнопки «Добавить в корзину» не приводит к обновлению корзины. Это связано с тем, что состояние, содержащее список продуктов в корзине cart_products, в настоящее время находится внутри компонента домашней страницы:</p>
<p><img src="/imgs/posts/ebe0fe80_12.png" alt="" /></p>
<p>Чтобы разделить состояние между двумя компонентами, мы можем:</p>
<ul>
<li>Поднимите состояние к общему предку</li>
<li>Переместить состояние в глобальное состояние приложения</li>
</ul>
<p>Компонент App является общим предком как ProductDetail, так и Home. Мы можем переместить туда состояние cart_products и передать его в качестве реквизита в ProductDetail и Home.</p>
<p><img src="/imgs/posts/ebe0fe80_13.png" alt="" /></p>
<p>Это отлично работает для неглубоких иерархий компонентов, но когда у вас есть глубокая иерархия компонентов (что является обычным для больших SPA), вам нужно будет передать это состояние через несколько уровней компонентов (которые могут не использоваться для этой опоры), чтобы достичь желаемого. узел. Это называется «бурение опор».</p>
<p>Вы можете видеть, что cart_products теперь передается из приложения в компонент AddToCart через ProductDetail и Home, хотя они не используют это состояние. Представьте себе тот же сценарий с компонентами, имеющими многоуровневую глубину.</p>
<p>Это проблема, которую решает глобальное государство. Вот как это будет выглядеть:</p>
<p><img src="/imgs/posts/ebe0fe80_14.png" alt="" /></p>
<p>Обратите внимание на прямую связь между компонентами, которым требуется это состояние, и глобальным состоянием.</p>
<p>К сожалению, у Yew нет для этого хорошего решения. Рекомендуемое решение - использовать агентов для трансляции изменений состояния через pubsub. Это то, от чего я держусь подальше, так как это быстро становится грязным. Я надеюсь, что в будущем мы увидим что-то похожее на React’s Context, Redux или Mobx и т.д.</p>
<p>Давайте решим нашу проблему, подняв состояние.</p>
<h2 id="sostoianie-podema">Состояние подъема</h2>
<p>Мы проведем рефакторинг нашего кода, переместив состояние cart_products в приложение и извлекая Navbar и AtcButton как отдельные компоненты: </p>
<p><img src="/imgs/posts/ebe0fe80_15.png" alt="" /></p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="font-style:italic;color:#5c6773;">// src/components/navbar.rs
</span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>types</span><span style="color:#f29668;">::</span><span>CartProduct</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Navbar </span><span>{
</span><span>    props</span><span style="color:#bfbab0cc;">:</span><span> Props,
</span><span>}
</span><span>
</span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Properties</span><span style="color:#bfbab0cc;">,</span><span> Clone)]
</span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Props </span><span>{
</span><span>    </span><span style="color:#ff7733;">pub </span><span>cart_products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;CartProduct&gt;,
</span><span>}
</span><span>
</span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">Navbar </span><span>{
</span><span>    </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Message </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Properties </span><span style="color:#f29668;">=</span><span> Props</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29718;">props</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29718;">_link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span>        </span><span style="color:#ff7733;">Self </span><span>{ props }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">update</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">_msg</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Message) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>        </span><span style="color:#f29718;">true
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">change</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">props</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>        </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props </span><span style="color:#f29668;">=</span><span> props</span><span style="color:#bfbab0cc;">;
</span><span>        </span><span style="color:#f29718;">true
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span>        </span><span style="color:#ff7733;">let</span><span> cart_value </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span>            </span><span style="color:#f29668;">.</span><span>props
</span><span>            </span><span style="color:#f29668;">.</span><span>cart_products
</span><span>            </span><span style="color:#f29668;">.</span><span style="color:#f07178;">iter</span><span>()
</span><span>            </span><span style="color:#f29668;">.</span><span style="color:#f07178;">fold</span><span>(</span><span style="color:#f29718;">0.0</span><span style="color:#bfbab0cc;">, </span><span>|</span><span style="color:#f29718;">acc</span><span style="color:#bfbab0cc;">, </span><span style="color:#f29718;">cp</span><span>| acc </span><span style="color:#f29668;">+ </span><span>(cp</span><span style="color:#f29668;">.</span><span>quantity </span><span style="color:#f29668;">as </span><span style="color:#ff7733;">f64 </span><span style="color:#f29668;">*</span><span> cp</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>price))</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>        </span><span style="color:#f07178;">html! </span><span>{
</span><span>            </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;navbar&quot;</span><span style="color:#f29668;">&gt;
</span><span>                </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;navbar_title&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;RustMart&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>              </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;navbar_cart_value&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f07178;">format!</span><span>(</span><span style="color:#c2d94c;">&quot;$</span><span style="color:#f29718;">{:.2}</span><span style="color:#c2d94c;">&quot;</span><span style="color:#bfbab0cc;">,</span><span> cart_value)}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>            </span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre>
<p>Обратите внимание, как мы начали использовать методы жизненного цикла изменения в компоненте Navbar. Когда реквизиты, отправленные из родительского элемента, изменяются, нам нужно обновить реквизиты внутри компонента, чтобы пользовательский интерфейс отрисовался повторно. </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="font-style:italic;color:#5c6773;">// src/components/atc_button.rs
</span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>types</span><span style="color:#f29668;">::</span><span>Product</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">AtcButton </span><span>{
</span><span>    props</span><span style="color:#bfbab0cc;">:</span><span> Props,
</span><span>    link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;,
</span><span>}
</span><span>
</span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Properties</span><span style="color:#bfbab0cc;">,</span><span> Clone)]
</span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Props </span><span>{
</span><span>    </span><span style="color:#ff7733;">pub </span><span>product</span><span style="color:#bfbab0cc;">:</span><span> Product,
</span><span>    </span><span style="color:#ff7733;">pub </span><span>on_add_to_cart</span><span style="color:#bfbab0cc;">: </span><span>Callback&lt;Product&gt;,
</span><span>}
</span><span>
</span><span style="color:#ff7733;">pub enum </span><span style="color:#59c2ff;">Msg </span><span>{
</span><span>    AddToCart</span><span style="color:#bfbab0cc;">,
</span><span>}
</span><span>
</span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">AtcButton </span><span>{
</span><span>    </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Message </span><span style="color:#f29668;">=</span><span> Msg</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Properties </span><span style="color:#f29668;">=</span><span> Props</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29718;">props</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29718;">link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span>        </span><span style="color:#ff7733;">Self </span><span>{ props</span><span style="color:#bfbab0cc;">,</span><span> link }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">update</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">msg</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Message) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>        </span><span style="color:#ff7733;">match</span><span> msg {
</span><span>            Msg</span><span style="color:#f29668;">::</span><span>AddToCart </span><span style="color:#f29668;">=&gt; </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>on_add_to_cart</span><span style="color:#f29668;">.</span><span style="color:#f07178;">emit</span><span>(</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span style="color:#f07178;">clone</span><span>())</span><span style="color:#bfbab0cc;">,
</span><span>        }
</span><span>        </span><span style="color:#f29718;">true
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">change</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">props</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>        </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props </span><span style="color:#f29668;">=</span><span> props</span><span style="color:#bfbab0cc;">;
</span><span>        </span><span style="color:#f29718;">true
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span>        </span><span style="color:#ff7733;">let</span><span> onclick </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>link</span><span style="color:#f29668;">.</span><span style="color:#f07178;">callback</span><span>(|_| Msg</span><span style="color:#f29668;">::</span><span>AddToCart)</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>        </span><span style="color:#f07178;">html! </span><span>{
</span><span>          </span><span style="color:#f29668;">&lt;</span><span>button class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_atc_button&quot;</span><span> onclick</span><span style="color:#f29668;">=</span><span>onclick</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Add To Cart&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>button</span><span style="color:#f29668;">&gt;
</span><span>        }
</span><span>    }
</span><span>}
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6773;">// src/components/mod.rs
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">atc_button</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">navbar</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">mod </span><span style="color:#59c2ff;">product_card</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">pub use </span><span>atc_button</span><span style="color:#f29668;">::</span><span>AtcButton</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">pub use </span><span>navbar</span><span style="color:#f29668;">::</span><span>Navbar</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">pub use </span><span>product_card</span><span style="color:#f29668;">::</span><span>ProductCard</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>Use the new AtcButton </span><span style="color:#f29668;">in</span><span> ProductCard and ProductDetail</span><span style="color:#bfbab0cc;">:
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6773;">// src/components/product_card.rs
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>components</span><span style="color:#f29668;">::</span><span>AtcButton</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>route</span><span style="color:#f29668;">::</span><span>Route</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>types</span><span style="color:#f29668;">::</span><span>Product</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew_router</span><span style="color:#f29668;">::</span><span>components</span><span style="color:#f29668;">::</span><span>RouterAnchor</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>  </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">ProductCard </span><span>{
</span><span>      props</span><span style="color:#bfbab0cc;">:</span><span> Props,
</span><span>  }
</span><span>
</span><span>  </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Properties</span><span style="color:#bfbab0cc;">,</span><span> Clone)]
</span><span>  </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Props </span><span>{
</span><span>      </span><span style="color:#ff7733;">pub </span><span>product</span><span style="color:#bfbab0cc;">:</span><span> Product,
</span><span>-     </span><span style="color:#ff7733;">pub </span><span>on_add_to_cart</span><span style="color:#bfbab0cc;">: </span><span>Callback&lt;()&gt;,
</span><span>+     </span><span style="color:#ff7733;">pub </span><span>on_add_to_cart</span><span style="color:#bfbab0cc;">: </span><span>Callback&lt;Product&gt;,
</span><span>  }
</span><span>
</span><span>  </span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">ProductCard </span><span>{
</span><span>      </span><span style="font-style:italic;color:#5c6773;">// No changes
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span>          </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Anchor </span><span style="color:#f29668;">= </span><span>RouterAnchor&lt;Route&gt;</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">-         </span><span style="color:#ff7733;">let</span><span> onclick </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>on_add_to_cart</span><span style="color:#f29668;">.</span><span style="color:#f07178;">reform</span><span>(|_|())</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>          </span><span style="color:#f07178;">html! </span><span>{
</span><span>              </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_container&quot;</span><span style="color:#f29668;">&gt;
</span><span>                  </span><span style="color:#f29668;">&lt;</span><span>Anchor route</span><span style="color:#f29668;">=</span><span>Route</span><span style="color:#f29668;">::</span><span>ProductDetail(</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>id) classes</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_anchor&quot;</span><span style="color:#f29668;">&gt;
</span><span>                      </span><span style="color:#f29668;">&lt;</span><span>img class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_image&quot;</span><span> src</span><span style="color:#f29668;">=</span><span>{</span><span style="color:#f29668;">&amp;</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>image}</span><span style="color:#f29668;">/&gt;
</span><span>                      </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_name&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f29668;">&amp;</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>name}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                      </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_price&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;$&quot;</span><span>}{</span><span style="color:#f29668;">&amp;</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>price}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                  </span><span style="color:#f29668;">&lt;/</span><span>Anchor</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-                 &lt;</span><span>button class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_atc_button&quot;</span><span> onclick</span><span style="color:#f29668;">=</span><span>onclick</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Add To Cart&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>button</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+                 &lt;</span><span>AtcButton product</span><span style="color:#f29668;">=</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span style="color:#f07178;">clone</span><span>() on_add_to_cart</span><span style="color:#f29668;">=</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>on_add_to_cart</span><span style="color:#f29668;">.</span><span style="color:#f07178;">clone</span><span>() </span><span style="color:#f29668;">/&gt;
</span><span>              </span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>          }
</span><span>      }
</span><span>  }
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6773;">// src/pages/product_detail.rs
</span><span>  </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>api</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>components</span><span style="color:#f29668;">::</span><span>AtcButton</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>types</span><span style="color:#f29668;">::</span><span>Product</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>anyhow</span><span style="color:#f29668;">::</span><span>Error</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>format</span><span style="color:#f29668;">::</span><span>Json</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>services</span><span style="color:#f29668;">::</span><span>fetch</span><span style="color:#f29668;">::</span><span>FetchTask</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6773;">// No changes
</span><span>
</span><span>  </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Properties</span><span style="color:#bfbab0cc;">,</span><span> Clone)]
</span><span>  </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Props </span><span>{
</span><span>      </span><span style="color:#ff7733;">pub </span><span>id</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">i32</span><span>,
</span><span>+     </span><span style="color:#ff7733;">pub </span><span>on_add_to_cart</span><span style="color:#bfbab0cc;">: </span><span>Callback&lt;Product&gt;,
</span><span>  }
</span><span>
</span><span>  </span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">ProductDetail </span><span>{
</span><span>      </span><span style="font-style:italic;color:#5c6773;">// No changes
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span>          </span><span style="color:#ff7733;">if let </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(</span><span style="color:#ff7733;">ref</span><span> product) </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>product {
</span><span>              </span><span style="color:#f07178;">html! </span><span>{
</span><span>                  </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_detail_container&quot;</span><span style="color:#f29668;">&gt;
</span><span>                      </span><span style="color:#f29668;">&lt;</span><span>img class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_detail_image&quot;</span><span> src</span><span style="color:#f29668;">=</span><span>{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>image}</span><span style="color:#f29668;">/&gt;
</span><span>                      </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_name&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>name}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                      </span><span style="color:#f29668;">&lt;</span><span>div style</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;margin: 10px 0; line-height: 24px;&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>description}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                      </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_price&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;$&quot;</span><span>}{</span><span style="color:#f29668;">&amp;</span><span>product</span><span style="color:#f29668;">.</span><span>price}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-                     &lt;</span><span>button class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_atc_button&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;Add To Cart&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>button</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">+                     &lt;</span><span>AtcButton product</span><span style="color:#f29668;">=</span><span>product</span><span style="color:#f29668;">.</span><span style="color:#f07178;">clone</span><span>() on_add_to_cart</span><span style="color:#f29668;">=</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>on_add_to_cart</span><span style="color:#f29668;">.</span><span style="color:#f07178;">clone</span><span>() </span><span style="color:#f29668;">/&gt;
</span><span>                  </span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>              }
</span><span>          }
</span><span>
</span><span>          </span><span style="font-style:italic;color:#5c6773;">// No changes
</span><span>      }
</span><span>  }
</span></code></pre>
<p>Наконец, переместите состояние cart_products из Home в приложение: </p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>  </span><span style="font-style:italic;color:#5c6773;">// src/app.rs
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>components</span><span style="color:#f29668;">::</span><span>Navbar</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>types</span><span style="color:#f29668;">::</span><span>{CartProduct</span><span style="color:#bfbab0cc;">,</span><span> Product}</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use </span><span>yew_router</span><span style="color:#f29668;">::</span><span>prelude</span><span style="color:#f29668;">::*</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>  </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>pages</span><span style="color:#f29668;">::</span><span>{Home</span><span style="color:#bfbab0cc;">,</span><span> ProductDetail}</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ff7733;">use crate</span><span style="color:#f29668;">::</span><span>route</span><span style="color:#f29668;">::</span><span>Route</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">State </span><span>{
</span><span>+     cart_products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;CartProduct&gt;,
</span><span>+ }
</span><span>
</span><span style="color:#f29668;">- </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">App </span><span>{}
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">App </span><span>{
</span><span>+     state</span><span style="color:#bfbab0cc;">:</span><span> State,
</span><span>+     link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;,
</span><span>+ }
</span><span>
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">pub enum </span><span style="color:#59c2ff;">Msg </span><span>{
</span><span style="color:#f29668;">+</span><span>     AddToCart(Product)</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+ </span><span>}
</span><span>
</span><span>  </span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">App </span><span>{
</span><span style="color:#f29668;">-     </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Message </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+     </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Message </span><span style="color:#f29668;">=</span><span> Msg</span><span style="color:#bfbab0cc;">;
</span><span>      </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Properties </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">-     </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29718;">_link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span style="color:#f29668;">+     </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29718;">link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span style="color:#f29668;">+         </span><span style="color:#ff7733;">let</span><span> cart_products </span><span style="color:#f29668;">= </span><span style="color:#f07178;">vec!</span><span>[]</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">-         </span><span style="color:#ff7733;">Self </span><span>{}
</span><span style="color:#f29668;">+         </span><span style="color:#ff7733;">Self </span><span>{
</span><span style="color:#f29668;">+</span><span>             state</span><span style="color:#bfbab0cc;">:</span><span> State { cart_products }</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>             link</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+         </span><span>}
</span><span>      }
</span><span>
</span><span style="color:#f29668;">-     </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">update</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">_msg</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Message) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span style="color:#f29668;">+     </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">update</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">message</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Message) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span style="color:#f29668;">+         </span><span style="color:#ff7733;">match</span><span> message {
</span><span style="color:#f29668;">+             </span><span>Msg</span><span style="color:#f29668;">::</span><span>AddToCart(product) </span><span style="color:#f29668;">=&gt; </span><span>{
</span><span style="color:#f29668;">+                 </span><span style="color:#ff7733;">let</span><span> cart_product </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span style="color:#f29668;">+                     .</span><span>state
</span><span style="color:#f29668;">+                     .</span><span>cart_products
</span><span style="color:#f29668;">+                     .</span><span style="color:#f07178;">iter_mut</span><span>()
</span><span style="color:#f29668;">+                     .</span><span style="color:#f07178;">find</span><span>(|</span><span style="color:#f29718;">cp</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29668;">&amp;&amp;</span><span style="color:#ff7733;">mut</span><span> CartProduct| cp</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>id </span><span style="color:#f29668;">==</span><span> product</span><span style="color:#f29668;">.</span><span>id)</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">+                 </span><span style="color:#ff7733;">if let </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(cp) </span><span style="color:#f29668;">=</span><span> cart_product {
</span><span style="color:#f29668;">+</span><span>                     cp</span><span style="color:#f29668;">.</span><span>quantity </span><span style="color:#f29668;">+= </span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+                 </span><span>} </span><span style="color:#ff7733;">else </span><span>{
</span><span style="color:#f29668;">+                     </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>cart_products</span><span style="color:#f29668;">.</span><span style="color:#f07178;">push</span><span>(CartProduct {
</span><span style="color:#f29668;">+</span><span>                         product</span><span style="color:#bfbab0cc;">:</span><span> product</span><span style="color:#f29668;">.</span><span style="color:#f07178;">clone</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+</span><span>                         quantity</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+                     </span><span>})
</span><span style="color:#f29668;">+                 </span><span>}
</span><span style="color:#f29668;">+                 </span><span style="color:#f29718;">true
</span><span style="color:#f29668;">+             </span><span>}
</span><span style="color:#f29668;">+         </span><span>}
</span><span style="color:#f29668;">-         </span><span style="color:#f29718;">true
</span><span>      }
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">change</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>          </span><span style="color:#f29718;">false
</span><span>      }
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span style="color:#f29668;">+         </span><span style="color:#ff7733;">let</span><span> handle_add_to_cart </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span style="color:#f29668;">+             .</span><span>link
</span><span style="color:#f29668;">+             .</span><span style="color:#f07178;">callback</span><span>(|</span><span style="color:#f29718;">product</span><span style="color:#bfbab0cc;">:</span><span> Product| Msg</span><span style="color:#f29668;">::</span><span>AddToCart(product))</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+         </span><span style="color:#ff7733;">let</span><span> cart_products </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>cart_products</span><span style="color:#f29668;">.</span><span style="color:#f07178;">clone</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">-         </span><span style="color:#ff7733;">let</span><span> render </span><span style="color:#f29668;">= </span><span>Router</span><span style="color:#f29668;">::</span><span>render(|</span><span style="color:#f29718;">switch</span><span style="color:#bfbab0cc;">:</span><span> Route| </span><span style="color:#ff7733;">match</span><span> switch {
</span><span style="color:#f29668;">-           </span><span>Route</span><span style="color:#f29668;">::</span><span>ProductDetail(id) </span><span style="color:#f29668;">=&gt; </span><span style="color:#f07178;">html! </span><span>{</span><span style="color:#f29668;">&lt;</span><span>ProductDetail id</span><span style="color:#f29668;">=</span><span>id</span><span style="color:#f29668;">/&gt;</span><span>}</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-           </span><span>Route</span><span style="color:#f29668;">::</span><span>HomePage </span><span style="color:#f29668;">=&gt; </span><span style="color:#f07178;">html! </span><span>{</span><span style="color:#f29668;">&lt;</span><span>Home</span><span style="color:#f29668;">/&gt;</span><span>}</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">+         </span><span style="color:#ff7733;">let</span><span> render </span><span style="color:#f29668;">= </span><span>Router</span><span style="color:#f29668;">::</span><span>render(</span><span style="color:#ff7733;">move </span><span style="color:#f29668;">|</span><span>switch</span><span style="color:#bfbab0cc;">:</span><span> Route</span><span style="color:#f29668;">| </span><span style="color:#ff7733;">match</span><span> switch {
</span><span style="color:#f29668;">+             </span><span>Route</span><span style="color:#f29668;">::</span><span>ProductDetail(id) </span><span style="color:#f29668;">=&gt; </span><span>{
</span><span style="color:#f29668;">+                 </span><span style="color:#f07178;">html! </span><span>{</span><span style="color:#f29668;">&lt;</span><span>ProductDetail id</span><span style="color:#f29668;">=</span><span>id on_add_to_cart</span><span style="color:#f29668;">=</span><span>handle_add_to_cart</span><span style="color:#f29668;">.</span><span style="color:#f07178;">clone</span><span>() </span><span style="color:#f29668;">/&gt;</span><span>}
</span><span style="color:#f29668;">+             </span><span>}
</span><span style="color:#f29668;">+             </span><span>Route</span><span style="color:#f29668;">::</span><span>HomePage </span><span style="color:#f29668;">=&gt; </span><span>{
</span><span style="color:#f29668;">+                 </span><span style="color:#f07178;">html! </span><span>{</span><span style="color:#f29668;">&lt;</span><span>Home cart_products</span><span style="color:#f29668;">=</span><span>cart_products</span><span style="color:#f29668;">.</span><span style="color:#f07178;">clone</span><span>() on_add_to_cart</span><span style="color:#f29668;">=</span><span>handle_add_to_cart</span><span style="color:#f29668;">.</span><span style="color:#f07178;">clone</span><span>()</span><span style="color:#f29668;">/&gt;</span><span>}
</span><span style="color:#f29668;">+             </span><span>}
</span><span>          })</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>          </span><span style="color:#f07178;">html! </span><span>{
</span><span style="color:#f29668;">+             &lt;&gt;
</span><span style="color:#f29668;">+                 &lt;</span><span>Navbar cart_products</span><span style="color:#f29668;">=</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>cart_products</span><span style="color:#f29668;">.</span><span style="color:#f07178;">clone</span><span>() </span><span style="color:#f29668;">/&gt;
</span><span>                  </span><span style="color:#f29668;">&lt;</span><span>Router&lt;Route,()&gt; render</span><span style="color:#f29668;">=</span><span>render</span><span style="color:#f29668;">/&gt;
</span><span style="color:#f29668;">+             &lt;/&gt;
</span><span>          }
</span><span>      }
</span><span>  }
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6773;">// src/pages/home.rs
</span><span>  </span><span style="font-style:italic;color:#5c6773;">// No changes
</span><span>
</span><span>  </span><span style="color:#ff7733;">struct </span><span style="color:#59c2ff;">State </span><span>{
</span><span>      products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Product&gt;,
</span><span>-     cart_products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;CartProduct&gt;,
</span><span>      get_products_error</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;Error&gt;,
</span><span>      get_products_loaded</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">bool</span><span>,
</span><span>  }
</span><span>
</span><span style="color:#f29668;">+ </span><span style="color:#bfbab0cc;">#</span><span>[</span><span style="color:#ffb454;">derive</span><span>(Properties</span><span style="color:#bfbab0cc;">,</span><span> Clone)]
</span><span style="color:#f29668;">+ </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Props </span><span>{
</span><span>+     </span><span style="color:#ff7733;">pub </span><span>cart_products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;CartProduct&gt;,
</span><span>+     </span><span style="color:#ff7733;">pub </span><span>on_add_to_cart</span><span style="color:#bfbab0cc;">: </span><span>Callback&lt;Product&gt;,
</span><span>+ }
</span><span>
</span><span>  </span><span style="color:#ff7733;">pub struct </span><span style="color:#59c2ff;">Home </span><span>{
</span><span>+     props</span><span style="color:#bfbab0cc;">:</span><span> Props,
</span><span>      state</span><span style="color:#bfbab0cc;">:</span><span> State,
</span><span>      link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;,
</span><span>      task</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Option</span><span>&lt;FetchTask&gt;,
</span><span>  }
</span><span>
</span><span>  </span><span style="color:#ff7733;">pub enum </span><span style="color:#59c2ff;">Msg </span><span>{
</span><span style="color:#f29668;">-</span><span>     AddToCart(</span><span style="color:#ff7733;">i32</span><span>)</span><span style="color:#bfbab0cc;">,
</span><span>      GetProducts</span><span style="color:#bfbab0cc;">,
</span><span>      GetProductsSuccess(</span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Product&gt;)</span><span style="color:#bfbab0cc;">,
</span><span>      GetProductsError(Error)</span><span style="color:#bfbab0cc;">,
</span><span>  }
</span><span>
</span><span>  </span><span style="color:#ff7733;">impl </span><span>Component </span><span style="color:#ff7733;">for </span><span style="color:#59c2ff;">Home </span><span>{
</span><span>      </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Message </span><span style="color:#f29668;">=</span><span> Msg</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">-     </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Properties </span><span style="color:#f29668;">=</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">+     </span><span style="color:#ff7733;">type </span><span style="color:#59c2ff;">Properties </span><span style="color:#f29668;">=</span><span> Props</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">-     </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29718;">link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span style="color:#f29668;">+     </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">create</span><span>(</span><span style="color:#f29718;">props</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties, </span><span style="color:#f29718;">link</span><span style="color:#bfbab0cc;">: </span><span>ComponentLink&lt;</span><span style="color:#ff7733;">Self</span><span>&gt;) </span><span style="color:#bfbab0cc;">-&gt; </span><span style="color:#ff7733;">Self </span><span>{
</span><span>          </span><span style="color:#ff7733;">let</span><span> products </span><span style="color:#f29668;">= </span><span style="color:#f07178;">vec!</span><span>[]</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">-         </span><span style="color:#ff7733;">let</span><span> cart_products </span><span style="color:#f29668;">= </span><span style="color:#f07178;">vec!</span><span>[]</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>          link</span><span style="color:#f29668;">.</span><span style="color:#f07178;">send_message</span><span>(Msg</span><span style="color:#f29668;">::</span><span>GetProducts)</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>          </span><span style="color:#ff7733;">Self </span><span>{
</span><span>              props</span><span style="color:#bfbab0cc;">,
</span><span>              state</span><span style="color:#bfbab0cc;">:</span><span> State {
</span><span>                  products</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-</span><span>                 cart_products</span><span style="color:#bfbab0cc;">,
</span><span>                  get_products_error</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>                  get_products_loaded</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">false</span><span style="color:#bfbab0cc;">,
</span><span>              }</span><span style="color:#bfbab0cc;">,
</span><span>              link</span><span style="color:#bfbab0cc;">,
</span><span>              task</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">None</span><span style="color:#bfbab0cc;">,
</span><span>          }
</span><span>      }
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">update</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">message</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Message) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span>          </span><span style="color:#ff7733;">match</span><span> message {
</span><span>              Msg</span><span style="color:#f29668;">::</span><span>GetProducts </span><span style="color:#f29668;">=&gt; </span><span>{
</span><span>                  </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_products_loaded </span><span style="color:#f29668;">= </span><span style="color:#f29718;">false</span><span style="color:#bfbab0cc;">;
</span><span>                  </span><span style="color:#ff7733;">let</span><span> handler </span><span style="color:#f29668;">=
</span><span>                      </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>link
</span><span>                          </span><span style="color:#f29668;">.</span><span style="color:#f07178;">callback</span><span>(</span><span style="color:#ff7733;">move </span><span style="color:#f29668;">|</span><span>response</span><span style="color:#bfbab0cc;">: </span><span>api</span><span style="color:#f29668;">::</span><span>FetchResponse&lt;</span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Product&gt;&gt;</span><span style="color:#f29668;">| </span><span>{
</span><span>                              </span><span style="color:#ff7733;">let </span><span>(</span><span style="color:#f29668;">_</span><span style="color:#bfbab0cc;">,</span><span> Json(data)) </span><span style="color:#f29668;">=</span><span> response</span><span style="color:#f29668;">.</span><span style="color:#f07178;">into_parts</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>                              </span><span style="color:#ff7733;">match</span><span> data {
</span><span>                                  </span><span style="font-style:italic;color:#39bae6;">Ok</span><span>(products) </span><span style="color:#f29668;">=&gt; </span><span>Msg</span><span style="color:#f29668;">::</span><span>GetProductsSuccess(products)</span><span style="color:#bfbab0cc;">,
</span><span>                                  </span><span style="font-style:italic;color:#39bae6;">Err</span><span>(err) </span><span style="color:#f29668;">=&gt; </span><span>Msg</span><span style="color:#f29668;">::</span><span>GetProductsError(err)</span><span style="color:#bfbab0cc;">,
</span><span>                              }
</span><span>                          })</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>                  </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>task </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(api</span><span style="color:#f29668;">::</span><span>get_products(handler))</span><span style="color:#bfbab0cc;">;
</span><span>                  </span><span style="color:#f29718;">true
</span><span>              }
</span><span>              Msg</span><span style="color:#f29668;">::</span><span>GetProductsSuccess(products) </span><span style="color:#f29668;">=&gt; </span><span>{
</span><span>                  </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>products </span><span style="color:#f29668;">=</span><span> products</span><span style="color:#bfbab0cc;">;
</span><span>                  </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_products_loaded </span><span style="color:#f29668;">= </span><span style="color:#f29718;">true</span><span style="color:#bfbab0cc;">;
</span><span>                  </span><span style="color:#f29718;">true
</span><span>              }
</span><span>              Msg</span><span style="color:#f29668;">::</span><span>GetProductsError(error) </span><span style="color:#f29668;">=&gt; </span><span>{
</span><span>                  </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_products_error </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(error)</span><span style="color:#bfbab0cc;">;
</span><span>                  </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_products_loaded </span><span style="color:#f29668;">= </span><span style="color:#f29718;">true</span><span style="color:#bfbab0cc;">;
</span><span>                  </span><span style="color:#f29718;">true
</span><span>              }
</span><span style="color:#f29668;">-             </span><span>Msg</span><span style="color:#f29668;">::</span><span>AddToCart(product_id) </span><span style="color:#f29668;">=&gt; </span><span>{
</span><span style="color:#f29668;">-                 </span><span style="color:#ff7733;">let</span><span> product </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span style="color:#f29668;">-                     .</span><span>state
</span><span style="color:#f29668;">-                     .</span><span>products
</span><span style="color:#f29668;">-                     .</span><span style="color:#f07178;">iter</span><span>()
</span><span style="color:#f29668;">-                     .</span><span style="color:#f07178;">find</span><span>(|</span><span style="color:#f29718;">p</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29668;">&amp;&amp;</span><span>Product| p</span><span style="color:#f29668;">.</span><span>id </span><span style="color:#f29668;">==</span><span> product_id)
</span><span style="color:#f29668;">-                     .</span><span style="color:#f07178;">unwrap</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">-                 </span><span style="color:#ff7733;">let</span><span> cart_product </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span style="color:#f29668;">-                     .</span><span>state
</span><span style="color:#f29668;">-                     .</span><span>cart_products
</span><span style="color:#f29668;">-                     .</span><span style="color:#f07178;">iter_mut</span><span>()
</span><span style="color:#f29668;">-                     .</span><span style="color:#f07178;">find</span><span>(|</span><span style="color:#f29718;">cp</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29668;">&amp;&amp;</span><span style="color:#ff7733;">mut</span><span> CartProduct| cp</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>id </span><span style="color:#f29668;">==</span><span> product_id)</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">-                 </span><span style="color:#ff7733;">if let </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(cp) </span><span style="color:#f29668;">=</span><span> cart_product {
</span><span style="color:#f29668;">-</span><span>                     cp</span><span style="color:#f29668;">.</span><span>quantity </span><span style="color:#f29668;">+= </span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">;
</span><span style="color:#f29668;">-                 </span><span>} </span><span style="color:#ff7733;">else </span><span>{
</span><span style="color:#f29668;">-                     </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>cart_products</span><span style="color:#f29668;">.</span><span style="color:#f07178;">push</span><span>(CartProduct {
</span><span style="color:#f29668;">-</span><span>                         product</span><span style="color:#bfbab0cc;">:</span><span> product</span><span style="color:#f29668;">.</span><span style="color:#f07178;">clone</span><span>()</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-</span><span>                         quantity</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">,
</span><span style="color:#f29668;">-                     </span><span>})
</span><span style="color:#f29668;">-                 </span><span>}
</span><span style="color:#f29668;">-                 </span><span style="color:#f29718;">true
</span><span style="color:#f29668;">-             </span><span>}
</span><span>          }
</span><span>      }
</span><span>
</span><span style="color:#f29668;">-     </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">change</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29668;">_</span><span>: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span style="color:#f29668;">+     </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">change</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#ff7733;">mut </span><span style="color:#f29718;">self</span><span>, </span><span style="color:#f29718;">props</span><span style="color:#bfbab0cc;">: </span><span style="color:#ff7733;">Self</span><span style="color:#f29668;">::</span><span>Properties) </span><span style="color:#bfbab0cc;">-&gt;</span><span> ShouldRender {
</span><span style="color:#f29668;">+         </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props </span><span style="color:#f29668;">=</span><span> props</span><span style="color:#bfbab0cc;">;
</span><span>          </span><span style="color:#f29718;">true
</span><span>      }
</span><span>
</span><span>      </span><span style="color:#ff7733;">fn </span><span style="color:#ffb454;">view</span><span>(</span><span style="color:#f29668;">&amp;</span><span style="color:#f29718;">self</span><span>) </span><span style="color:#bfbab0cc;">-&gt;</span><span> Html {
</span><span>          </span><span style="color:#ff7733;">let</span><span> products</span><span style="color:#bfbab0cc;">: </span><span style="font-style:italic;color:#39bae6;">Vec</span><span>&lt;Html&gt; </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span>              </span><span style="color:#f29668;">.</span><span>state
</span><span>              </span><span style="color:#f29668;">.</span><span>products
</span><span>              </span><span style="color:#f29668;">.</span><span style="color:#f07178;">iter</span><span>()
</span><span>              </span><span style="color:#f29668;">.</span><span style="color:#f07178;">map</span><span>(|</span><span style="color:#f29718;">product</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29668;">&amp;</span><span>Product| {
</span><span style="color:#f29668;">-                 </span><span style="color:#ff7733;">let</span><span> product_id </span><span style="color:#f29668;">=</span><span> product</span><span style="color:#f29668;">.</span><span>id</span><span style="color:#bfbab0cc;">;
</span><span>                  </span><span style="color:#f07178;">html! </span><span>{
</span><span style="color:#f29668;">-                   &lt;</span><span>ProductCard product</span><span style="color:#f29668;">=</span><span>{product} on_add_to_cart</span><span style="color:#f29668;">=</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>link</span><span style="color:#f29668;">.</span><span style="color:#f07178;">callback</span><span>(</span><span style="color:#ff7733;">move </span><span style="color:#f29668;">|_| </span><span>Msg</span><span style="color:#f29668;">::</span><span>AddToCart(product_id))</span><span style="color:#f29668;">/&gt;
</span><span style="color:#f29668;">+                   &lt;</span><span>ProductCard product</span><span style="color:#f29668;">=</span><span>{product} on_add_to_cart</span><span style="color:#f29668;">=</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>props</span><span style="color:#f29668;">.</span><span>on_add_to_cart</span><span style="color:#f29668;">.</span><span style="color:#f07178;">clone</span><span>()</span><span style="color:#f29668;">/&gt;
</span><span>                  }
</span><span>              })
</span><span>              </span><span style="color:#f29668;">.</span><span style="color:#f07178;">collect</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#f29668;">-        </span><span style="color:#ff7733;">let</span><span> cart_value </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self
</span><span style="color:#f29668;">-            .</span><span>state
</span><span style="color:#f29668;">-            .</span><span>cart_products
</span><span style="color:#f29668;">-            .</span><span style="color:#f07178;">iter</span><span>()
</span><span style="color:#f29668;">-            .</span><span style="color:#f07178;">fold</span><span>(</span><span style="color:#f29718;">0.0</span><span style="color:#bfbab0cc;">, </span><span>|</span><span style="color:#f29718;">acc</span><span style="color:#bfbab0cc;">, </span><span style="color:#f29718;">cp</span><span>| acc </span><span style="color:#f29668;">+ </span><span>(cp</span><span style="color:#f29668;">.</span><span>quantity </span><span style="color:#f29668;">as </span><span style="color:#ff7733;">f64 </span><span style="color:#f29668;">*</span><span> cp</span><span style="color:#f29668;">.</span><span>product</span><span style="color:#f29668;">.</span><span>price))</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span>          </span><span style="color:#ff7733;">if </span><span style="color:#f29668;">!</span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_products_loaded {
</span><span>              </span><span style="font-style:italic;color:#5c6773;">// No changes
</span><span>          } </span><span style="color:#ff7733;">else if let </span><span style="font-style:italic;color:#39bae6;">Some</span><span>(</span><span style="color:#f29668;">_</span><span>) </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">self</span><span style="color:#f29668;">.</span><span>state</span><span style="color:#f29668;">.</span><span>get_products_error {
</span><span>              </span><span style="font-style:italic;color:#5c6773;">// No changes
</span><span>          } </span><span style="color:#ff7733;">else </span><span>{
</span><span>              </span><span style="color:#f07178;">html! </span><span>{
</span><span style="color:#f29668;">-               &lt;</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-                 &lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;navbar&quot;</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-                     &lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;navbar_title&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#c2d94c;">&quot;RustMart&quot;</span><span>}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-                     &lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;navbar_cart_value&quot;</span><span style="color:#f29668;">&gt;</span><span>{</span><span style="color:#f07178;">format!</span><span>(</span><span style="color:#c2d94c;">&quot;$</span><span style="color:#f29718;">{:.2}</span><span style="color:#c2d94c;">&quot;</span><span style="color:#bfbab0cc;">,</span><span> cart_value)}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-                 &lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>                  </span><span style="color:#f29668;">&lt;</span><span>div class</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;product_card_list&quot;</span><span style="color:#f29668;">&gt;</span><span>{products}</span><span style="color:#f29668;">&lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span style="color:#f29668;">-               &lt;/</span><span>div</span><span style="color:#f29668;">&gt;
</span><span>              }
</span><span>          }
</span><span>      }
</span><span>  }
</span></code></pre>
<p>Теперь мы, наконец, можем добавить в корзину со страницы ProductDetail, и мы также можем видеть панель навигации на всех страницах.</p>
<p><img src="/imgs/posts/ebe0fe80_16.png" alt="" /></p>
<p><img src="/imgs/posts/ebe0fe80_17.png" alt="" /></p>
<p>Мы успешно построили SPA полностью на Rust!</p>
<p>Я разместил здесь демонстрацию, а код находится в этом репозитории GitHub. Если у вас есть вопросы или предложения, свяжитесь со мной по адресу sheshbabu [at] gmail.com.</p>
<h2 id="vyvod">Вывод</h2>
<p>Сообщество Yew проделало хорошую работу по разработке абстракций, таких как html !, Component и т.д., Так что кто-то вроде меня, знакомый с React, может сразу начать продуктивно. У него определенно есть некоторые шероховатости, такие как FetchTask, отсутствие предсказуемого управления состоянием и скудная документация, но он может стать хорошей альтернативой React, Vue и т.д., Как только эти проблемы будут исправлены.</p>
<p>Спасибо за чтение! Не стесняйтесь подписываться на меня в Twitter, чтобы увидеть больше подобных сообщений :) </p>










<script src="https://giscus.app/client.js"
    data-repo="dudochkin-victor&#x2F;dudochkin-victor.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzNzgwNTYx"
    data-category="General"
    data-category-id="DIC_kwDOADmv0c4CAhvj"
    data-mapping="pathname"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-theme="light"
    data-lang="en"
    crossorigin="anonymous"
    async>
</script>



        </div>

        
        
    </main>

    
    <footer>
        <small class="subtext">
            <a href="https://angular-rust.github.io">Dudochkin Victor</a> © 2021
        </small>
    </footer>
    
</body>
<script>
    function highlightNav(heading) {
        let pathname = location.pathname;
        document.querySelectorAll(".toc a").forEach((item) => {
            item.classList.remove("active");
        });
        document.querySelector(".toc a[href$='" + pathname + "#" + heading + "']").classList.add("active");
    }

    let currentHeading = "";
    window.onscroll = function () {
        let h = document.querySelectorAll("h1,h2,h3,h4,h5,h6");
        let elementArr = [];

        h.forEach(item => {
            if (item.id !== "") {
                elementArr[item.id] = item.getBoundingClientRect().top;
            }
        });
        elementArr.sort();
        for (let key in elementArr) {
            if (!elementArr.hasOwnProperty(key)) {
                continue;
            }
            if (elementArr[key] > 0 && elementArr[key] < 300) {
                if (currentHeading !== key) {
                    highlightNav(key);
                    currentHeading = key;
                }
                break;
            }
        }
    }
</script>

</html>
