<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>11. Развертывание в devnet | Dudochkin Victor </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="google-site-verification" content="Kepqb6k6uptlwngnHbBVJmqQtwNW8zfHyQBbTXLYAgA" />
    <meta name="yandex-verification" content="8e8bc73c2566b473" />
    <style>
    :root {
        /* Primary theme color */
        /* --primary-color: #121A26; */
        --primary-color: #0f1419;
        /* Primary theme text color */
        /* --primary-text-color: #121A26; */
        --primary-text-color: #0f1419;
        /* Primary theme link color */
        --primary-link-color: #053961;
        /* Secondary color: the background body color */
        --secondary-color: #F0F0F0;
        --secondary-text-color: #1C2834;
        /* Highlight text color of table of content */
        --toc-highlight-text-color: #053961;
    }
</style>
    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-47MMPLLY44"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-47MMPLLY44');
    </script>
    

    
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
    
        ym('87064264', "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true
        });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/87064264" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    
    
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/mdl.min.css">
    <link rel="stylesheet" href="https://dudochkin-victor.github.io/style.css">
    
    
</head>

<body>
    
<header class="box-shadow">
    

<a href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;">
    <div class="logo">
        <img src="https://dudochkin-victor.github.io/ferris.png" alt="logo">
        Dudochkin Victor
    </div>
</a>

<nav>
    <!-- 
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;showcases&#x2F;">Showcases</a>
    
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;changelog&#x2F;">Changelog</a>
    
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;about&#x2F;">About</a>
     -->

    
        
        <a class="nav-item subtitle-text" href="&#x2F;solana&#x2F;">Solana</a>
        
        <a class="nav-item subtitle-text" href="&#x2F;edgeware&#x2F;">Edgeware</a>
        
        <a class="nav-item subtitle-text" href="&#x2F;blog&#x2F;">Блог</a>
        
        <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;github.com&#x2F;dudochkin-victor">Github</a>
        
    
</nav>

</header>

 
    <main>
        
        
        
        
        
        <div class="toc">
            <div class="toc-sticky">
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/from-scratch/deploying-to-devnet/#izmenenie-klastera">Изменение кластера</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/from-scratch/deploying-to-devnet/#airdrop-na-devnet">Аирдроп на devnet</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/from-scratch/deploying-to-devnet/#razvertyvanie-programmy">Развертывание программы</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/from-scratch/deploying-to-devnet/#stoimost-razvertyvaniia">Стоимость развертывания</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/from-scratch/deploying-to-devnet/#kopirovanie-idl-faila">Копирование IDL-файла</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/from-scratch/deploying-to-devnet/#neskol-ko-sred-v-interfeise">Несколько сред в интерфейсе</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/from-scratch/deploying-to-devnet/#razvertyvanie-interfeisa">Развертывание интерфейса</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/from-scratch/deploying-to-devnet/#bonus-opublikuite-svoi-idl">Бонус: опубликуйте свой IDL</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/from-scratch/deploying-to-devnet/#tsikl-razrabotki">Цикл разработки</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/from-scratch/deploying-to-devnet/#vyvod">Вывод</a>
                </div>
                
                
            </div>
        </div>
        
        

        <div class="content text">
            
<h1>11. Развертывание в devnet</h1>

<p><a href="https://lorisleiva.com/create-a-solana-dapp-from-scratch/deploying-to-devnet">Перевод</a> | Автор оригинала: Loris</p>
<p>ЭПИЗОД 11</p>
<p>1 МЕСЯЦ НАЗАД</p>
<p>ЧТЕНИЕ 14 МИН.</p>
<p>До сих пор в этой серии мы разрабатывали наше децентрализованное приложение (dApp) только локально на нашей машине. Теперь, когда наше децентрализованное приложение готово, давайте узнаем, как его развернуть, чтобы каждый мог извлечь из него пользу.</p>
<p>В Солане есть несколько кластеров, в которые мы можем развернуться. Основной, который все используют с реальными деньгами, называется «mainnet». Другой, называемый «devnet», можно использовать для тестирования нашей программы на реальном кластере, использующем фальшивые деньги.</p>
<p>При развертывании dApps обычно сначала выполняется развертывание в кластере «devnet», как на промежуточном сервере, а затем, когда вас все устраивает, развертывание в кластере «mainnet» аналогично производственному серверу.</p>
<p>В этом эпизоде мы узнаем, как выполнить развертывание в кластере devnet. Тем не менее, развертывание в основной сети — очень похожий процесс, поэтому вы также сможете это сделать к концу этого эпизода. Кроме того, я обязательно добавлю примечание каждый раз, когда между ними будет небольшая разница.</p>
<p>Хорошо, давайте сделаем это!</p>
<h2 id="izmenenie-klastera">Изменение кластера</h2>
<p>Первое, что нужно сделать, это изменить наш кластер с локального хоста на devnet. Нам нужно сделать это в двух местах: в терминале и в настройках нашей программы.</p>
<p>Первое легко сделать. Нам просто нужно запустить эту команду в нашем терминале, чтобы сообщить Солане, что мы хотим использовать кластер devnet.</p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">solana</span><span> config set</span><span style="color:#f29718;"> --url</span><span> devnet
</span><span>
</span><span style="font-style:italic;color:#5c6773;"># Outputs:
</span><span style="font-style:italic;color:#5c6773;"># Config File: /Users/loris/.config/solana/cli/config.yml
</span><span style="font-style:italic;color:#5c6773;"># RPC URL: https://api.devnet.solana.com
</span><span style="font-style:italic;color:#5c6773;"># WebSocket URL: wss://api.devnet.solana.com/ (computed)
</span><span style="font-style:italic;color:#5c6773;"># Keypair Path: /Users/loris/.config/solana/id.json
</span><span style="font-style:italic;color:#5c6773;"># Commitment: confirmed
</span></code></pre>
<p><strong>Для основной сети</strong> вместо этого запустите <code>solana config set --url mainnet-beta</code>.</p>
<p>С этого момента любая команда solana, которую мы запускаем в нашем терминале, будет выполняться в кластере devnet. Это включает в себя «аирдроп в солане», «развертывание в солане» и т. д.</p>
<p>Это означает, что нам больше не нужно запускать локальный реестр на нашем компьютере — используя solana-test-validator или anchor localnet — для взаимодействия с блокчейном.</p>
<p>Следующее место, где нам нужно изменить наш кластер, находится в файле <code>Anchor.toml</code> нашей программы.</p>
<p>Если вы заглянете внутрь этого файла, вы должны увидеть следующее.</p>
<pre data-lang="toml" style="background-color:#0f1419;color:#bfbab0;" class="language-toml "><code class="language-toml" data-lang="toml"><span>[</span><span style="color:#59c2ff;">programs</span><span style="color:#bfbab0cc;">.</span><span style="color:#59c2ff;">localnet</span><span>]
</span><span style="color:#59c2ff;">solana_twitter </span><span>= </span><span style="color:#c2d94c;">&quot;2BDbYV1ocs2S1PsYnd5c5mqtdLWGf5VbCYvf28rs9LGj&quot;
</span><span>
</span><span style="font-style:italic;color:#5c6773;"># ...
</span><span>
</span><span>[</span><span style="color:#59c2ff;">provider</span><span>]
</span><span style="color:#59c2ff;">cluster </span><span>= </span><span style="color:#c2d94c;">&quot;localnet&quot;
</span><span style="color:#59c2ff;">wallet </span><span>= </span><span style="color:#c2d94c;">&quot;/Users/loris/.config/solana/id.json&quot;
</span></code></pre>
<ul>
<li>В разделе <code>[provider]</code> мы говорим Anchor использовать кластер локальной сети и где найти кошелек, который следует использовать для оплаты транзакций и хранения.</li>
<li>В разделе «[programs.localnet]» мы даем Anchor идентификатор программы — то есть открытый ключ — нашей программы «solana_twitter».</li>
</ul>
<p>Важно отметить, что идентификатор программы предоставляется в контексте кластера — в данном случае кластера локальной сети. Это связано с тем, что одна и та же программа может быть развернута по разным адресам в зависимости от кластера. Например, вы можете использовать другой идентификатор программы для кластера основной сети, чтобы только несколько членов с ограниченным доступом имели право на развертывание в основной сети.</p>
<p>Но подождите минутку, этот идентификатор программы общедоступен, верно?</p>
<p>Это правда! Идентификатор программы является общедоступным, но его пара ключей находится в папке target/deploy, и Anchor использует соглашение об именах, чтобы найти его. Если ваша программа называется solana_twitter, она попытается найти пару ключей, расположенную в target/deploy/solana_twitter-keypair.json. Если этот файл не может быть найден при развертывании вашей программы, будет сгенерирована новая пара ключей, дающая нам новый идентификатор программы. Именно поэтому нам пришлось обновить идентификатор программы после самого первого развертывания.</p>
<p>Хотя раньше мы не обращали особого внимания на этот файл <code>target/deploy/solana_twitter-keypair.json</code>, важно признать, что <strong>этот файл является доказательством того, что вы являетесь владельцем программы по этому адресу</strong>. Если вы развернетесь в основной сети, используя эту пару ключей, и кто-то другой получит ее, этот человек сможет развернуть любые изменения, которые он захочет, в вашу программу.</p>
<p>В нашем случае мы упростим задачу и будем использовать одну и ту же пару ключей для всех кластеров, но я бы рекомендовал использовать другую пару ключей, по крайней мере, для кластера основной сети.</p>
<pre data-lang="toml" style="background-color:#0f1419;color:#bfbab0;" class="language-toml "><code class="language-toml" data-lang="toml"><span>[</span><span style="color:#59c2ff;">programs</span><span style="color:#bfbab0cc;">.</span><span style="color:#59c2ff;">localnet</span><span>]
</span><span style="color:#59c2ff;">solana_twitter </span><span>= </span><span style="color:#c2d94c;">&quot;2BDbYV1ocs2S1PsYnd5c5mqtdLWGf5VbCYvf28rs9LGj&quot;
</span><span>
</span><span>[</span><span style="color:#59c2ff;">programs</span><span style="color:#bfbab0cc;">.</span><span style="color:#59c2ff;">devnet</span><span>]
</span><span style="color:#59c2ff;">solana_twitter </span><span>= </span><span style="color:#c2d94c;">&quot;2BDbYV1ocs2S1PsYnd5c5mqtdLWGf5VbCYvf28rs9LGj&quot;
</span><span>
</span><span>[</span><span style="color:#59c2ff;">programs</span><span style="color:#bfbab0cc;">.</span><span style="color:#59c2ff;">mainnet</span><span>]
</span><span style="color:#59c2ff;">solana_twitter </span><span>= </span><span style="color:#c2d94c;">&quot;2BDbYV1ocs2S1PsYnd5c5mqtdLWGf5VbCYvf28rs9LGj&quot;
</span><span>
</span><span style="font-style:italic;color:#5c6773;"># ...
</span><span>
</span><span>[</span><span style="color:#59c2ff;">provider</span><span>]
</span><span style="color:#59c2ff;">cluster </span><span>= </span><span style="color:#c2d94c;">&quot;devnet&quot;
</span><span style="color:#59c2ff;">wallet </span><span>= </span><span style="color:#c2d94c;">&quot;/Users/loris/.config/solana/id.json&quot;
</span></code></pre>
<p>Как вы можете видеть в приведенном выше коде, мы дважды продублировали раздел <code>[programs.localnet]</code>. Один раз для <code>[programs.devnet]</code> и один раз для <code>[programs.mainnet]</code>. Затем мы обновили <code>cluster</code> до <code>devnet</code> в разделе <code>[provider]</code>.</p>
<p>🚀 <strong>Для основной сети</strong> просто установите <code>cluster</code> на <code>mainnet</code>.</p>
<p>И это все! Теперь мы в кластере devnet.</p>
<h2 id="airdrop-na-devnet">Аирдроп на devnet</h2>
<p>Прежде чем мы сможем развернуть нашу программу в devnet, нам нужно получить немного денег на этот кластер.</p>
<p>Если вы помните, в прошлом мы использовали команду solana airdrop, чтобы получить немного денег в нашем локальном кластере. Что ж, мы можем сделать то же самое в кластере devnet, за исключением того, что команда имеет ограничение около 5 SOL.</p>
<p>Итак, давайте дадим себе несколько SOL в devnet. Мы сделаем это для обоих наших кошельков: того, который мы используем на нашей локальной машине для развертывания программы, и нашего «настоящего» кошелька, который мы используем в браузере для совершения транзакций.</p>
<p>В первом случае нам не нужно указывать адрес, потому что он находится в <code>~/.config/solana/id.json</code>, который является местом по умолчанию для поиска пары ключей вашего компьютера. Поэтому мы можем запустить следующее.</p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">solana</span><span> airdrop 5
</span></code></pre>
<p>Обратите внимание, что если нам нужно более 5 SOL, мы можем запустить эту команду еще раз. Просто мы не можем получить слишком много SOL за раз.</p>
<p>Если вы получаете следующую ошибку «Ошибка: невозможно подтвердить транзакцию. Это может произойти в таких ситуациях, как истечение срока действия транзакции и недостаточное количество средств плательщика. Часто это означает, что кран devnet исчерпан, и вам следует повторить попытку чуть позже. Вы также можете попробовать запросить меньше SOL и посмотреть, сработает ли это. Не стесняйтесь проверять раздор Соланы, чтобы получать обновления, когда он пополняется.</p>
<p>Для другого кошелька — то есть нашего «настоящего» кошелька — мы можем запустить ту же команду, но нам нужно указать его адрес в качестве второго аргумента. Для меня это выглядит так.</p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">solana</span><span> airdrop 5 B1AfN7AgpMyctfFbjmvRAvE1yziZFDb9XCwydBjJwtRN
</span></code></pre>
<p>Теперь мы готовы к развертыванию!</p>
<p><strong>Для основной сети</strong> мы не можем использовать команду airdrop, так как мы работаем с реальными деньгами. Поэтому вам нужно будет перевести немного денег на кошелек вашего локального компьютера из вашего реального кошелька. В качестве альтернативы вы можете импортировать свой реальный кошелек локально на свой компьютер и использовать его при развертывании в основной сети, указав путь к его паре ключей в опции <code>wallet</code> файла конфигурации <code>Anchor.toml</code>.</p>
<h2 id="razvertyvanie-programmy">Развертывание программы</h2>
<p>Давайте, наконец, развернем нашу программу в devnet! Как обычно, мы будем использовать команду <code>anchor deploy</code>, теперь, когда Anchor знает, в какой кластер выполнять развертывание. Хотя в этом нет необходимости, мне всегда нравится запускать сборку привязки перед развертыванием, чтобы убедиться, что я развертываю последнюю версию своего кода.</p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">anchor</span><span> build
</span><span style="color:#ffb454;">anchor</span><span> deploy
</span></code></pre>
<p>Поздравляем! Ваш код теперь доступен в кластере devnet для всех! </p>
<p>Теперь давайте обновим наш интерфейс, чтобы мы могли взаимодействовать с нашей программой в кластере devnet, а не в локальном.</p>
<p>Для этого нам нужно изменить URL-адрес кластера внутри составного файла useWorkspace.</p>
<p>Замените URL-адрес локального хоста следующим, и, бум, наш интерфейс теперь также использует кластер devnet!</p>
<pre data-lang="js" style="background-color:#0f1419;color:#bfbab0;" class="language-js "><code class="language-js" data-lang="js"><span style="color:#ff7733;">const </span><span>connection </span><span style="color:#f29668;">= new </span><span style="color:#59c2ff;">Connection</span><span>(</span><span style="color:#c2d94c;">&#39;https://api.devnet.solana.com&#39;</span><span style="color:#bfbab0cc;">, </span><span>commitment)
</span></code></pre>
<p>На этом этапе вы должны иметь возможность отправлять и читать твиты из кластера devnet с помощью приложений VueJS.</p>
<p>Теперь все, что осталось сделать, это развернуть наш интерфейс где-нибудь на сервере, чтобы другие пользователи тоже могли взаимодействовать с ним. Но сначала поговорим о затратах.</p>
<h2 id="stoimost-razvertyvaniia">Стоимость развертывания</h2>
<p>Ранее мы запустили команду для сброса 5 SOL в кошелек нашего локального компьютера, чтобы у него было достаточно денег для развертывания нашей программы. Посмотрим, во сколько нам это обошлось. Мы можем запустить следующую команду, чтобы получить доступ к балансу нашего локального кошелька.</p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">solana</span><span> balance
</span><span>
</span><span style="font-style:italic;color:#5c6773;"># Outputs:
</span><span style="font-style:italic;color:#5c6773;"># 2.361026
</span></code></pre>
<p>Теперь у нас есть 2,361026 SOL, что означает, что развертывание обошлось нам в 2,638974 SOL. На момент написания статьи это около 450 долларов.</p>
<p>К счастью для нас, мы развернули в devnet, где мы можем раздать себе немного денег, но если мы хотим развернуть это в кластере основной сети, нам нужно будет заплатить это из собственного кармана.</p>
<p>Так почему же это стоит так дорого и должны ли мы платить такие деньги каждый раз, когда развертываем?</p>
<p>Причина, по которой это стоит так дорого, заключается в том, что, как и при создании учетных записей, нам нужно выделить некоторое хранилище в блокчейне для хранения кода нашей программы. После компиляции наш код требует довольно много байтов, что означает, что сумма без арендной платы обычно довольно высока. Кроме того, Solana по умолчанию выделяет вдвое больше места, чем необходимо для хранения кода. Почему это происходит? Потому что наша программа, вероятно, получит обновления в будущем, и она пытается учесть тот факт, что при следующем развертывании нам может понадобиться больше места.</p>
<p>При необходимости мы можем изменить это, явно <a href="https://docs.solana.com/cli/deploy-a-program#redeploy-a-program">указав Солане, сколько места мы хотим выделить для нашей программы</a>.</p>
<p>Таким образом, развертывание в кластере в первый раз является дорогостоящей транзакцией из-за первоначальных денег, не облагаемых арендной платой, но впоследствии повторное развертывание не должно стоить практически ничего — т. е. цена транзакции — потому что мы уже заплатили за наше хранилище.</p>
<p>Хорошо, теперь, когда мы знаем больше об экономике развертывания, давайте вернемся к развертыванию внешнего интерфейса нашего приложения.</p>
<h2 id="kopirovanie-idl-faila">Копирование IDL-файла</h2>
<p>Если вы заглянете внутрь составного файла useWorkspace, то увидите, что мы импортируем файл IDL, сгенерированный Anchor, используя относительный путь, который находится за пределами каталога app, содержащего наше приложение VueJS.</p>
<pre data-lang="js" style="background-color:#0f1419;color:#bfbab0;" class="language-js "><code class="language-js" data-lang="js"><span style="color:#ff7733;">import </span><span>idl </span><span style="color:#ff7733;">from </span><span style="color:#c2d94c;">&#39;../../../target/idl/solana_twitter.json&#39;
</span></code></pre>
<p>Это работает на нашей машине, потому что мы создали приложение локально, и поэтому целевая папка была создана правильно. Однако при развертывании нашего интерфейса на сервере у него не будет доступа к этому <code>target</code>  репозиторию. Поэтому нам нужно скопировать и вставить сгенерированный IDL куда-нибудь в нашу папку <code>app</code>.</p>
<p>Чтобы сделать нашу жизнь немного проще, давайте добавим собственный скрипт <code>copy-idl</code> в наш файл <code>Anchor.toml</code>.</p>
<pre data-lang="toml" style="background-color:#0f1419;color:#bfbab0;" class="language-toml "><code class="language-toml" data-lang="toml"><span>[</span><span style="color:#59c2ff;">scripts</span><span>]
</span><span style="color:#59c2ff;">test </span><span>= </span><span style="color:#c2d94c;">&quot;yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/**/*.ts&quot;
</span><span style="color:#59c2ff;">copy-idl </span><span>= </span><span style="color:#c2d94c;">&quot;mkdir -p app/src/idl &amp;&amp; cp target/idl/solana_twitter.json app/src/idl/solana_twitter.json&quot;
</span></code></pre>
<p>Первая часть скрипта гарантирует, что папка app/src/idl существует, а вторая часть копирует в нее IDL-файл.</p>
<p>Теперь каждый раз, когда мы хотим скопировать этот IDL в наш интерфейс, все, что нам нужно сделать, это запустить следующую команду. Давайте сделаем это сейчас, чтобы мы могли получить доступ к файлу IDL в нашем интерфейсе.</p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">anchor</span><span> run copy-idl
</span></code></pre>
<p>Наконец, нам нужно обновить путь импорта нашего IDL-файла внутри компонуемого useWorkspace, чтобы он указывал на новый IDL-путь.</p>
<pre data-lang="js" style="background-color:#0f1419;color:#bfbab0;" class="language-js "><code class="language-js" data-lang="js"><span style="color:#ff7733;">import </span><span>idl </span><span style="color:#ff7733;">from </span><span style="color:#c2d94c;">&#39;@/idl/solana_twitter.json&#39;
</span></code></pre>
<p>Обратите внимание, что начиная с Anchor <code>v0.19.0</code> появилась новая функция, которая позволяет нам указать пользовательский каталог, в который следует копировать файл IDL каждый раз, когда мы запускаем <code>anchor build</code>.</p>
<pre data-lang="toml" style="background-color:#0f1419;color:#bfbab0;" class="language-toml "><code class="language-toml" data-lang="toml"><span>[</span><span style="color:#59c2ff;">workspace</span><span>]
</span><span style="color:#59c2ff;">types </span><span>= </span><span style="color:#c2d94c;">&quot;app/src/idl/&quot;
</span></code></pre>
<p>Звучит идеально, но на момент написания статьи он не копировал идентификатор программы внутри IDL, который нам нужен для нашего рабочего пространства. Поэтому я решил использовать традиционный сценарий копирования, но при этом следить за этой функцией, так как я уверен, что она будет продолжать улучшаться.</p>
<h2 id="neskol-ko-sred-v-interfeise">Несколько сред в интерфейсе</h2>
<p>В настоящее время нам приходится вручную обновлять URL-адрес кластера внутри составного файла useWorkspace каждый раз, когда мы хотим переключать кластеры.</p>
<p>Было бы намного лучше, если бы это можно было установить динамически. Одним из способов добиться этого было бы небольшое раскрывающееся меню в приложении, где пользователи могут выбрать свой кластер. Однако я предпочитаю иметь один явный кластер, определенный для каждой среды, в которой выполняется развертывание. Например, solana-twitter.com будет использовать кластер основной сети, тогда как devnet.solana-twitter.com будет использовать кластер devnet.</p>
<p>К счастью, приложения VueJS поддерживают несколько сред с помощью <a href="https://cli.vuejs.org/guide/mode-and-env.html#modes">функции «режим»</a>.</p>
<p>Вот как это работает.</p>
<ol>
<li>Мы создадим несколько файлов среды внутри нашего каталога <code>app</code>: <code>.env</code> для локальных переменных, <code>.env.devnet</code> для переменных devnet и <code>.env.mainnet</code> для переменных основной сети.</li>
<li>При компиляции нашего внешнего интерфейса мы можем указать VueJS, какой режим мы компилируем, и он будет использовать файл среды, соответствующий этому режиму. Это откат к использованию <code>.env</code>, поэтому мы используем его локально.</li>
<li>Любые переменные, начинающиеся с <code>VUE_APP_</code> внутри этих файлов окружения, будут автоматически внедрены в <code>process.env</code> нашего внешнего интерфейса.</li>
<li>Мы можем получить доступ к этим переменным внутри <code>useWorkspace</code>, компонуемого для динамического предоставления URL-адреса кластера.</li>
<li>Наконец, мы добавим еще несколько скриптов в наш файл package.json, чтобы помочь нам скомпилировать внешний интерфейс для всех различных режимов.</li>
</ol>
<p>Хорошо, давайте это реализуем.</p>
<p>(1) Начните с добавления следующих файлов в каталог <code>app</code> и скопируйте/вставьте их содержимое. Мы определим только одну переменную, которая предоставляет URL-адрес каждого кластера.</p>
<ul>
<li>
<p><code>.env</code></p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span>VUE_APP_CLUSTER_URL</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;http://127.0.0.1:8899&quot;
</span></code></pre>
</li>
<li>
<p><code>.env.devnet</code></p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span>VUE_APP_CLUSTER_URL</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;https://api.devnet.solana.com&quot;
</span></code></pre>
</li>
<li>
<p><code>.env.mainnet</code></p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span>VUE_APP_CLUSTER_URL</span><span style="color:#f29668;">=</span><span style="color:#c2d94c;">&quot;https://api.mainnet-beta.solana.com&quot;
</span></code></pre>
</li>
</ul>
<p>(4) Затем обновите компоновку <code>useWorkspace</code>, чтобы использовать эту переменную.</p>
<pre data-lang="js" style="background-color:#0f1419;color:#bfbab0;" class="language-js "><code class="language-js" data-lang="js"><span style="font-style:italic;color:#5c6773;">// ...
</span><span>
</span><span style="color:#ff7733;">const </span><span>clusterUrl </span><span style="color:#f29668;">= </span><span>process</span><span style="color:#f29668;">.</span><span>env</span><span style="color:#f29668;">.</span><span>VUE_APP_CLUSTER_URL
</span><span style="color:#ff7733;">const </span><span>preflightCommitment </span><span style="color:#f29668;">= </span><span style="color:#c2d94c;">&#39;processed&#39;
</span><span style="color:#ff7733;">const </span><span>commitment </span><span style="color:#f29668;">= </span><span style="color:#c2d94c;">&#39;processed&#39;
</span><span style="color:#ff7733;">const </span><span>programID </span><span style="color:#f29668;">= new </span><span style="color:#59c2ff;">PublicKey</span><span>(idl</span><span style="color:#f29668;">.</span><span>metadata</span><span style="color:#f29668;">.</span><span>address)
</span><span style="color:#ff7733;">const </span><span>workspaceSymbol </span><span style="color:#f29668;">= </span><span style="font-style:italic;color:#39bae6;">Symbol</span><span>()
</span><span>
</span><span style="color:#ff7733;">export const </span><span style="color:#ffb454;">useWorkspace </span><span style="color:#f29668;">= </span><span>() </span><span style="color:#ff7733;">=&gt; </span><span style="color:#ffb454;">inject</span><span>(workspaceSymbol)
</span><span>
</span><span style="color:#ff7733;">export const </span><span style="color:#ffb454;">initWorkspace </span><span style="color:#f29668;">= </span><span>() </span><span style="color:#ff7733;">=&gt; </span><span>{
</span><span>    </span><span style="color:#ff7733;">const </span><span>wallet </span><span style="color:#f29668;">= </span><span style="color:#ffb454;">useAnchorWallet</span><span>()
</span><span>    </span><span style="color:#ff7733;">const </span><span>connection </span><span style="color:#f29668;">= new </span><span style="color:#59c2ff;">Connection</span><span>(clusterUrl</span><span style="color:#bfbab0cc;">, </span><span>commitment)
</span><span>    </span><span style="font-style:italic;color:#5c6773;">// ...
</span><span>}
</span></code></pre>
<p>(5) Наконец, добавьте следующие сценарии в файл app/package.json.</p>
<pre data-lang="json" style="background-color:#0f1419;color:#bfbab0;" class="language-json "><code class="language-json" data-lang="json"><span style="color:#c2d94c;">&quot;scripts&quot;</span><span>: {
</span><span>  </span><span style="color:#c2d94c;">&quot;serve&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;vue-cli-service serve&quot;</span><span style="color:#bfbab0cc;">,
</span><span>  </span><span style="color:#c2d94c;">&quot;serve:devnet&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;vue-cli-service serve --mode devnet&quot;</span><span style="color:#bfbab0cc;">,
</span><span>  </span><span style="color:#c2d94c;">&quot;serve:mainnet&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;vue-cli-service serve --mode mainnet&quot;</span><span style="color:#bfbab0cc;">,
</span><span>  </span><span style="color:#c2d94c;">&quot;build&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;vue-cli-service build&quot;</span><span style="color:#bfbab0cc;">,
</span><span>  </span><span style="color:#c2d94c;">&quot;build:devnet&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;vue-cli-service build --mode devnet&quot;</span><span style="color:#bfbab0cc;">,
</span><span>  </span><span style="color:#c2d94c;">&quot;build:mainnet&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;vue-cli-service build --mode mainnet&quot;</span><span style="color:#bfbab0cc;">,
</span><span>  </span><span style="color:#c2d94c;">&quot;lint&quot;</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">&quot;vue-cli-service lint&quot;
</span><span>},
</span></code></pre>
<p>Сделано! Теперь мы можем создать наш интерфейс для devnet, используя <code>npm run build:devnet</code>, и он автоматически узнает, что нужно использовать URL-адрес кластера devnet.</p>
<p>Обратите внимание, что если у вас в данный момент запущен npm run serve на терминале, вам нужно будет выйти из него (Ctrl+C) и вместо этого запустить npn run serve:devnet, чтобы он использовал правильный URL-адрес кластера.</p>
<h2 id="razvertyvanie-interfeisa">Развертывание интерфейса</h2>
<p>Хорошо, теперь пришло время представить наше внешнее приложение миру. Существует миллион вариантов развертывания внешнего приложения, так что не стесняйтесь использовать тот метод, который вы предпочитаете.</p>
<p>В моем случае я привык развертывать приложения только для внешнего интерфейса с помощью <a href="https://www.netlify.com/">Netlify</a>, потому что это бесплатно и, честно говоря, довольно удивительно.</p>
<p>Все, что вам нужно сделать, это разместить свой код где-нибудь в репозитории, и он запросит у вас команду для запуска и каталог для обслуживания. Красиво и просто, как и должно быть.</p>
<p>Обратите внимание, что перед развертыванием я добавил небольшую фавиконку и обновил метаданные файла index.html в папке app/public. Не стесняйтесь загружать и извлекать следующий ZIP-файл в ваш «общедоступный» каталог, если вы хотите сделать то же самое.</p>
<p><a href="https://lorisleiva.com/assets/articles/2021/1212-solana-11-deploy-devnet/public.zip">Загрузить ZIP-файл</a></p>
<p>Затем в своей учетной записи Netlify я добавил новый сайт и предоставил следующие параметры.</p>
<ul>
<li>Ветка для развертывания: <code>main</code></li>
<li>Базовый каталог: <code>app</code></li>
<li>Команда сборки: <code>npm run build:devnet</code></li>
<li>Каталог публикации: <code>app/dist</code></li>
</ul>
<p><img src="https://lorisleiva.com/assets/articles/2021/1212-solana-11-deploy-devnet/netlify-1.png" alt="Screenshot of the Netlify app when creating a new site with the settings mentioned above." /></p>
<p>И это все. Наш внешний интерфейс был развернут на случайном поддомене <code>netlify.app</code>. Вы можете подключить свое собственное доменное имя бесплатно или, как и я, просто используете это как учебный проект, вы можете обновить субдомен Netlify до чего-то более приятного. В моем случае я использовал solana-twitter.netlify.app.</p>
<p><img src="https://lorisleiva.com/assets/articles/2021/1212-solana-11-deploy-devnet/netlify-2.png" alt="Screenshot of the Netlify app where I’m updating the Netlify subdomain of the site we created." /></p>
<p>Еще одна приятная особенность Netlify заключается в том, что она автоматически запускает новое развертывание каждый раз, когда вы отправляете фиксацию в выбранную вами ветку, которая по умолчанию имеет значение «main».</p>
<p>Готово! Теперь вы можете поделиться своим URL-адресом со всеми своими друзьями и начать твитить в Солане!</p>
<p><a href="https://solana-twitter.netlify.app/">Solana Twitter URL</a></p>
<h2 id="bonus-opublikuite-svoi-idl">Бонус: опубликуйте свой IDL</h2>
<p>Это необязательный шаг, но полезно знать, что вы можете опубликовать свой IDL-файл в блокчейне. Это позволяет другим инструментам в экосистеме Solana распознавать вашу программу и понимать, что она может предложить.</p>
<p>Вот пример с исследователем Solana, который я создаю. Несмотря на то, что проводник ничего не знает о нашей программе, он может получить файл IDL и соответствующим образом декодировать учетную запись Tweet, чтобы показать некоторую ценную информацию.</p>
<p><img src="https://lorisleiva.com/assets/articles/2021/1212-solana-11-deploy-devnet/solaneyes.png" alt="Screenshot of an explorer app that displays all the information of a Tweet after having given its public key." /></p>
<p>Чтобы опубликовать файл IDL, все, что вам нужно сделать, это запустить в терминале следующее.</p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">anchor</span><span> idl init </span><span style="color:#f29668;">&lt;</span><span>programId</span><span style="color:#f29668;">&gt; </span><span style="color:#bfbab0cc;">-</span><span>f </span><span style="color:#f29668;">&lt;</span><span>target/idl/program.json</span><span style="color:#f29668;">&gt;
</span></code></pre>
<p>И если ваша программа изменится в будущем, вы можете обновить опубликованный IDL, запустив:</p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">anchor</span><span> idl upgrade </span><span style="color:#f29668;">&lt;</span><span>programId</span><span style="color:#f29668;">&gt; </span><span style="color:#bfbab0cc;">-</span><span>f </span><span style="color:#f29668;">&lt;</span><span>target/idl/program.json</span><span style="color:#f29668;">&gt;
</span></code></pre>
<h2 id="tsikl-razrabotki">Цикл разработки</h2>
<p>Прежде чем я покину вас, давайте кратко рассмотрим цикл разработки, который мы использовали при создании и развертывании dApp в Солане. Я дам это вам как код, потому что, будем честными, это лучшее, что можно прочитать.</p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="font-style:italic;color:#5c6773;"># Make sure you’re on the localnet.
</span><span style="color:#ffb454;">solana</span><span> config set</span><span style="color:#f29718;"> --url</span><span> localhost
</span><span style="font-style:italic;color:#5c6773;"># And check your Anchor.toml file.
</span><span>
</span><span style="font-style:italic;color:#5c6773;"># Code…
</span><span>
</span><span style="font-style:italic;color:#5c6773;"># Run the tests.
</span><span style="color:#ffb454;">anchor</span><span> test
</span><span>
</span><span style="font-style:italic;color:#5c6773;"># Build, deploy and start a local ledger.
</span><span style="color:#ffb454;">anchor</span><span> localnet
</span><span style="font-style:italic;color:#5c6773;"># Or
</span><span style="color:#ffb454;">solana-test-validator
</span><span style="color:#ffb454;">anchor</span><span> build
</span><span style="color:#ffb454;">anchor</span><span> deploy
</span><span>
</span><span style="font-style:italic;color:#5c6773;"># Copy the new IDL to the frontend.
</span><span style="color:#ffb454;">anchor</span><span> run copy-idl
</span><span>
</span><span style="font-style:italic;color:#5c6773;"># Serve your frontend application locally.
</span><span style="color:#ffb454;">npm</span><span> run serve
</span><span>
</span><span style="font-style:italic;color:#5c6773;"># Switch to the devnet cluster to deploy there.
</span><span style="color:#ffb454;">solana</span><span> config set</span><span style="color:#f29718;"> --url</span><span> devnet
</span><span style="font-style:italic;color:#5c6773;"># And update your Anchor.toml file.
</span><span>
</span><span style="font-style:italic;color:#5c6773;"># Airdrop yourself some money if necessary.
</span><span style="color:#ffb454;">solana</span><span> airdrop 5
</span><span>
</span><span style="font-style:italic;color:#5c6773;"># Build and deploy to devnet.
</span><span style="color:#ffb454;">anchor</span><span> build
</span><span style="color:#ffb454;">anchor</span><span> deploy
</span><span>
</span><span style="font-style:italic;color:#5c6773;"># Push your code to the main branch to auto-deploy on Netlify.
</span><span style="color:#ffb454;">git</span><span> push
</span></code></pre>
<h2 id="vyvod">Вывод</h2>
<p>Мы сделали это! Вы можете поздравить себя с завершением этой серии, потому что это, безусловно, было трудным путешествием. 💪</p>
<p>Я надеюсь, что вы многому научились на этом пути и, надеюсь, достаточно, чтобы вы могли начать разрабатывать больше dApps. Если вы это сделаете, я хотел бы услышать о том, что вы строите! Ничто не сделало бы меня более счастливым, чем видеть, как эта серия статей помогает другим создавать удивительные вещи.</p>
<p>Если есть что-то еще, что вы хотели бы узнать о разработке Solana, не стесняйтесь обращаться к нам. Я планирую добавить больше бонусных эпизодов в эту серию в будущем и сделать их «только спонсорами GitHub», чтобы они могли немного помочь мне финансово.</p>
<p>Кроме того, я планирую бесплатно добавлять в свой блог больше общих статей о Солане, так что не стесняйтесь подписываться на меня в Твиттере, чтобы получать обновления.</p>
<p>Как обычно, вы можете найти репозиторий этого эпизода на GitHub и сравнить его код с предыдущим эпизодом.</p>
<p><a href="https://github.com/lorisleiva/solana-twitter/tree/episode-11">Просмотреть эпизод 11 на GitHub</a></p>
<p><a href="https://github.com/lorisleiva/solana-twitter/compare/episode-10...episode-11">Сравните с Эпизодом 10</a></p>
<p>До новых встреч в Солане! 😘</p>










<script src="https://giscus.app/client.js"
    data-repo="dudochkin-victor&#x2F;dudochkin-victor.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzNzgwNTYx"
    data-category="General"
    data-category-id="DIC_kwDOADmv0c4CAhvj"
    data-mapping="pathname"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-theme="light"
    data-lang="en"
    crossorigin="anonymous"
    async>
</script>



        </div>

        
        
    </main>

    
    <footer>
        <small class="subtext">
            <a href="https://angular-rust.github.io">Dudochkin Victor</a> © 2021
        </small>
    </footer>
    
</body>
<script>
    function highlightNav(heading) {
        let pathname = location.pathname;
        document.querySelectorAll(".toc a").forEach((item) => {
            item.classList.remove("active");
        });
        document.querySelector(".toc a[href$='" + pathname + "#" + heading + "']").classList.add("active");
    }

    let currentHeading = "";
    window.onscroll = function () {
        let h = document.querySelectorAll("h1,h2,h3,h4,h5,h6");
        let elementArr = [];

        h.forEach(item => {
            if (item.id !== "") {
                elementArr[item.id] = item.getBoundingClientRect().top;
            }
        });
        elementArr.sort();
        for (let key in elementArr) {
            if (!elementArr.hasOwnProperty(key)) {
                continue;
            }
            if (elementArr[key] > 0 && elementArr[key] < 300) {
                if (currentHeading !== key) {
                    highlightNav(key);
                    currentHeading = key;
                }
                break;
            }
        }
    }
</script>

</html>
