<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Rust Клиенты | Dudochkin Victor </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="google-site-verification" content="Kepqb6k6uptlwngnHbBVJmqQtwNW8zfHyQBbTXLYAgA" />
    <meta name="yandex-verification" content="8e8bc73c2566b473" />
    <style>
    :root {
        /* Primary theme color */
        /* --primary-color: #121A26; */
        --primary-color: #0f1419;
        /* Primary theme text color */
        /* --primary-text-color: #121A26; */
        --primary-text-color: #0f1419;
        /* Primary theme link color */
        --primary-link-color: #053961;
        /* Secondary color: the background body color */
        --secondary-color: #F0F0F0;
        --secondary-text-color: #1C2834;
        /* Highlight text color of table of content */
        --toc-highlight-text-color: #053961;
    }
</style>
    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-47MMPLLY44"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-47MMPLLY44');
    </script>
    

    
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
    
        ym('87064264', "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true
        });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/87064264" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    
    
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/mdl.min.css">
    <link rel="stylesheet" href="https://dudochkin-victor.github.io/style.css">
    
    
</head>

<body>
    
<header class="box-shadow">
    

<a href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;">
    <div class="logo">
        <img src="https://dudochkin-victor.github.io/ferris.png" alt="logo">
        Dudochkin Victor
    </div>
</a>

<nav>
    <!-- 
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;showcases&#x2F;">Showcases</a>
    
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;changelog&#x2F;">Changelog</a>
    
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;about&#x2F;">About</a>
     -->

    
        
        <a class="nav-item subtitle-text" href="&#x2F;solana&#x2F;">Solana</a>
        
        <a class="nav-item subtitle-text" href="&#x2F;edgeware&#x2F;">Edgeware</a>
        
        <a class="nav-item subtitle-text" href="&#x2F;blog&#x2F;">Блог</a>
        
        <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;github.com&#x2F;dudochkin-victor">Github</a>
        
    
</nav>

</header>

 
    <main>
        
        
        
        
        
        <div class="toc">
            <div class="toc-sticky">
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/proposals/rust-clients/#problema">Проблема</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/proposals/rust-clients/#predlozhennoe-reshenie">Предложенное решение</a>
                </div>
                
                
                <div class="toc-item-child">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/proposals/rust-clients/#obrabotka-oshibok"><small>- Обработка ошибок</small></a>
                </div>
                
                <div class="toc-item-child">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/proposals/rust-clients/#strategiia-realizatsii"><small>- Стратегия реализации</small></a>
                </div>
                
                
                
            </div>
        </div>
        
        

        <div class="content text">
            
<h1>Rust Клиенты</h1>

<h2 id="problema">Проблема</h2>
<p>Высокоуровневые тесты, такие как Bench-TPS, написаны с использованием признака «Клиент». Когда мы выполняем эти тесты как часть набора тестов, мы используем низкоуровневую реализацию BankClient. Когда нам нужно запустить тот же тест для кластера, мы используем реализацию ThinClient. Проблема с этим подходом заключается в том, что это означает, что трейт будет постоянно расширяться, включая новые служебные функции, и все его реализации должны добавлять новые функции. Отделив обращенный к пользователю объект от трейта, который абстрагирует сетевой интерфейс, мы можем расширить обращенный к пользователю объект, включив в него всевозможные полезные функции, такие как «спиннер» из RpcClient, не заботясь о необходимости расширения трейта и его реализации.</p>
<h2 id="predlozhennoe-reshenie">Предложенное решение</h2>
<p>Вместо того, чтобы реализовывать трейт <code>Client</code>, <code>ThinClient</code> должен быть создан с его реализацией. Таким образом, все служебные функции, которые в настоящее время находятся в трейте <code>Client</code>, могут быть перемещены в <code>ThinClient</code>. «Тонкий клиент» затем может перейти в «solana-sdk», поскольку все его сетевые зависимости будут в реализации «Клиента». Затем мы добавим новую реализацию <code>Client</code>, называемую <code>ClusterClient</code>, и она будет жить в ящике <code>solana-client</code>, где в настоящее время находится <code>ThinClient</code>.</p>
<p>После этой реорганизации любой код, нуждающийся в клиенте, будет написан в терминах «тонкого клиента». В модульных тестах функциональность будет вызываться с помощью <code>ThinClient&lt;BankClient&gt;</code>, тогда как функции <code>main()</code>, эталонные тесты и интеграционные тесты будут вызываться с помощью <code>ThinClient&lt;ClusterClient&gt;</code>.</p>
<p>Если компоненты более высокого уровня требуют большей функциональности, чем та, которую может реализовать <code>BankClient</code>, она должна быть реализована вторым объектом, который реализует второй признак, следуя тому же шаблону, описанному здесь.</p>
<h3 id="obrabotka-oshibok">Обработка ошибок</h3>
<p><code>Клиент</code> должен использовать существующее перечисление <code>TransportError</code> для ошибок, за исключением того, что поле <code>Custom(String)</code> должно быть изменено на <code>Custom(Box&lt;dyn Error&gt;)</code>.</p>
<h3 id="strategiia-realizatsii">Стратегия реализации</h3>
<ol>
<li>Добавьте новый объект в <code>solana-sdk</code>, <code>RpcClientTng</code>, где суффикс <code>Tng</code> является временным и означает «Следующее поколение».</li>
<li>Инициализируйте <code>RpcClientTng</code> с реализацией <code>SyncClient</code>.</li>
<li>Добавьте в solana-sdk новый объект, ThinClientTng; инициализируйте его с помощью <code>RpcClientTng</code> и реализации <code>AsyncClient</code></li>
<li>Переместите все модульные тесты из <code>BankClient</code> в <code>ThinClientTng&lt;BankClient&gt;</code></li>
<li>Добавьте <code>ClusterClient</code></li>
<li>Переместите пользователей ThinClient в ThinClientTng<ClusterClient>.</li>
<li>Удалите ThinClient и переименуйте ThinClientTng в ThinClient.</li>
<li>Переместите пользователей RpcClient в новый ThinClient<ClusterClient>.</li>
<li>Удалите RpcClient и переименуйте RpcClientTng в RpcClient.</li>
</ol>










<script src="https://giscus.app/client.js"
    data-repo="dudochkin-victor&#x2F;dudochkin-victor.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzNzgwNTYx"
    data-category="General"
    data-category-id="DIC_kwDOADmv0c4CAhvj"
    data-mapping="pathname"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-theme="light"
    data-lang="en"
    crossorigin="anonymous"
    async>
</script>



        </div>

        
        
    </main>

    
    <footer>
        <small class="subtext">
            <a href="https://angular-rust.github.io">Dudochkin Victor</a> © 2021
        </small>
    </footer>
    
</body>
<script>
    function highlightNav(heading) {
        let pathname = location.pathname;
        document.querySelectorAll(".toc a").forEach((item) => {
            item.classList.remove("active");
        });
        document.querySelector(".toc a[href$='" + pathname + "#" + heading + "']").classList.add("active");
    }

    let currentHeading = "";
    window.onscroll = function () {
        let h = document.querySelectorAll("h1,h2,h3,h4,h5,h6");
        let elementArr = [];

        h.forEach(item => {
            if (item.id !== "") {
                elementArr[item.id] = item.getBoundingClientRect().top;
            }
        });
        elementArr.sort();
        for (let key in elementArr) {
            if (!elementArr.hasOwnProperty(key)) {
                continue;
            }
            if (elementArr[key] > 0 && elementArr[key] < 300) {
                if (currentHeading !== key) {
                    highlightNav(key);
                    currentHeading = key;
                }
                break;
            }
        }
    }
</script>

</html>
