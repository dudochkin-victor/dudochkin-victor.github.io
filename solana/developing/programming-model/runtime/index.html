<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Runtime | Dudochkin Victor </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="google-site-verification" content="Kepqb6k6uptlwngnHbBVJmqQtwNW8zfHyQBbTXLYAgA" />
    <meta name="yandex-verification" content="8e8bc73c2566b473" />
    <style>
    :root {
        /* Primary theme color */
        /* --primary-color: #121A26; */
        --primary-color: #0f1419;
        /* Primary theme text color */
        /* --primary-text-color: #121A26; */
        --primary-text-color: #0f1419;
        /* Primary theme link color */
        --primary-link-color: #053961;
        /* Secondary color: the background body color */
        --secondary-color: #F0F0F0;
        --secondary-text-color: #1C2834;
        /* Highlight text color of table of content */
        --toc-highlight-text-color: #053961;
    }
</style>
    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-47MMPLLY44"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-47MMPLLY44');
    </script>
    

    
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
    
        ym('87064264', "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true
        });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/87064264" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    
    
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/mdl.min.css">
    <link rel="stylesheet" href="https://dudochkin-victor.github.io/style.css">
    
    
</head>

<body>
    
<header class="box-shadow">
    

<a href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;">
    <div class="logo">
        <img src="https://dudochkin-victor.github.io/ferris.png" alt="logo">
        Dudochkin Victor
    </div>
</a>

<nav>
    <!-- 
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;showcases&#x2F;">Showcases</a>
    
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;changelog&#x2F;">Changelog</a>
    
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;about&#x2F;">About</a>
     -->

    
        
        <a class="nav-item subtitle-text" href="&#x2F;solana&#x2F;">Solana</a>
        
        <a class="nav-item subtitle-text" href="&#x2F;edgeware&#x2F;">Edgeware</a>
        
        <a class="nav-item subtitle-text" href="&#x2F;blog&#x2F;">Блог</a>
        
        <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;github.com&#x2F;dudochkin-victor">Github</a>
        
    
</nav>

</header>

 
    <main>
        
        
        
        
        
        <div class="toc">
            <div class="toc-sticky">
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/developing/programming-model/runtime/#vozmozhnosti-programm">Возможности программ</a>
                </div>
                
                
                <div class="toc-item-child">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/developing/programming-model/runtime/#politika"><small>- Политика</small></a>
                </div>
                
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/developing/programming-model/runtime/#raschet-biudzheta">Расчет бюджета</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/developing/programming-model/runtime/#novye-vozmozhnosti">Новые возможности</a>
                </div>
                
                
            </div>
        </div>
        
        

        <div class="content text">
            
<h1>Runtime</h1>

<h2 id="vozmozhnosti-programm">Возможности программ</h2>
<p>Среда выполнения разрешает только программе-владельцу дебетовать счет или изменять его данные. Затем программа определяет дополнительные правила, определяющие, может ли клиент изменять принадлежащие ему учетные записи. В случае программы System она позволяет пользователям передавать лэмпорты, распознавая подписи транзакций. Если он увидит, что клиент подписал транзакцию с помощью <em>закрытого ключа</em> пары ключей, он узнает, что клиент авторизовал передачу токена.</p>
<p>Другими словами, весь набор учетных записей, принадлежащих данной программе, можно рассматривать как хранилище ключей и значений, где ключ — это адрес учетной записи, а значение — произвольные двоичные данные, зависящие от программы. Автор программы может решить, как управлять всем состоянием программы и, возможно, многими учетными записями.</p>
<p>После того, как среда выполнения выполнит каждую из инструкций транзакции, она использует метаданные учетной записи, чтобы убедиться, что политика доступа не была нарушена. Если программа нарушает политику, среда выполнения отбрасывает все изменения учетных записей, сделанные всеми инструкциями в транзакции, и помечает транзакцию как неудачную.</p>
<h3 id="politika">Политика</h3>
<p>После того, как программа обработала инструкцию, среда выполнения проверяет, выполняла ли программа только те операции, на которые ей было разрешено, и что результаты соответствуют политике среды выполнения.</p>
<p>Политика такова:</p>
<ul>
<li>Только владелец учетной записи может изменить владельца.
<ul>
<li>И только если учетная запись доступна для записи.</li>
<li>И только если аккаунт не исполняемый</li>
<li>И только если данные инициализированы нулями или пусты.</li>
</ul>
</li>
<li>Баланс аккаунта, не привязанного к программе, не может уменьшиться.</li>
<li>Баланс только для чтения и исполняемых аккаунтов не может измениться.</li>
<li>Только системная программа может изменить размер данных и только в том случае, если системная программа владеет учетной записью.</li>
<li>Только владелец может изменить данные учетной записи.
<ul>
<li>И если учетная запись доступна для записи.</li>
<li>А если аккаунт не исполняемый.</li>
</ul>
</li>
<li>Исполняемый файл является односторонним (false-&gt;true) и только владелец учетной записи может установить его.</li>
<li>Никто не может вносить изменения в rent_epoch, связанный с этой учетной записью.</li>
</ul>
<h2 id="raschet-biudzheta">Расчет бюджета</h2>
<p>Чтобы программа не злоупотребляла вычислительными ресурсами, каждой инструкции в транзакции назначается вычислительный бюджет. Бюджет состоит из вычислительных единиц, потребляемых программой при выполнении различных операций, и ограничений, которые программа не может превышать. Когда программа использует весь свой бюджет или превышает предел, среда выполнения останавливает программу и возвращает ошибку.</p>
<p>Следующие операции влекут за собой вычислительные затраты:</p>
<ul>
<li>Выполнение инструкций BPF</li>
<li>Вызов системных вызовов
<ul>
<li>протоколирование</li>
<li>создание программных адресов</li>
<li>межпрограммные вызовы</li>
<li>...</li>
</ul>
</li>
</ul>
<p>При межпрограммных вызовах вызываемые программы наследуют бюджет своего родителя. Если вызванная программа использует бюджет или превышает границу, вся цепочка вызовов и родитель останавливаются.</p>
<p>Текущий <a href="https://github.com/solana-labs/solana/blob/d3a3a7548c857f26ec2cb10e270da72d373020ec/sdk/src/process_instruction.rs#L65">вычислительный бюджет</a> можно найти в Solana SDK.</p>
<p>Например, если текущий бюджет:</p>
<pre data-lang="rust" style="background-color:#0f1419;color:#bfbab0;" class="language-rust "><code class="language-rust" data-lang="rust"><span>max_units</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">200</span><span style="color:#bfbab0cc;">,</span><span style="color:#f29718;">000</span><span style="color:#bfbab0cc;">,
</span><span>log_units</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">100</span><span style="color:#bfbab0cc;">,
</span><span>log_u64_units</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">100</span><span style="color:#bfbab0cc;">,
</span><span>create_program address units</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">1500</span><span style="color:#bfbab0cc;">,
</span><span>invoke_units</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">1000</span><span style="color:#bfbab0cc;">,
</span><span>max_invoke_depth</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">4</span><span style="color:#bfbab0cc;">,
</span><span>max_call_depth</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">64</span><span style="color:#bfbab0cc;">,
</span><span>stack_frame_size</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">4096</span><span style="color:#bfbab0cc;">,
</span><span>log_pubkey_units</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">100</span><span style="color:#bfbab0cc;">,
</span></code></pre>
<p>Затем программа</p>
<ul>
<li>Может выполнить 200 000 инструкций BPF, если он не делает ничего другого</li>
<li>Может регистрировать 2000 сообщений журнала</li>
<li>Не может превышать 4 КБ использования стека</li>
<li>Не может превышать глубину вызова BPF 64</li>
<li>Не может превышать 4 уровня межпрограммных вызовов.</li>
</ul>
<p>Поскольку бюджет вычислений расходуется постепенно по мере выполнения программы, общее потребление бюджета будет представлять собой комбинацию различных затрат на операции, которые она выполняет.</p>
<p>Во время выполнения программа может регистрировать оставшуюся часть вычислительного бюджета. См. <a href="developing/on-chain-programs/debugging.md#monitoring-compute-budget-consumption">debugging</a> для получения дополнительной информации.</p>
<p>Значения бюджета зависят от включения функции, взгляните на <a href="https://github.com/solana-labs/solana/blob/d3a3a7548c857f26ec2cb10e270da72d373020ec/sdk/src/process_instruction.rs#L97">новую</a> функцию вычислительного бюджета, чтобы узнать, как формируется бюджет. Понимание того, как работают <a href="runtime.md#features">функции</a> и какие функции включены в используемом кластере, требуется для определения значений текущего бюджета.</p>
<h2 id="novye-vozmozhnosti">Новые возможности</h2>
<p>По мере развития Solana могут вводиться новые функции или исправления, которые изменяют поведение кластера и выполнение программ. Изменения в поведении должны быть согласованы между различными узлами кластера, если узлы не координируются, эти изменения могут привести к нарушению консенсуса. Solana поддерживает механизм, называемый функциями времени выполнения, для облегчения беспрепятственного принятия изменений.</p>
<p>Функции времени выполнения — это скоординированные по эпохе события, в ходе которых происходит одно или несколько изменений поведения кластера. Новые изменения в Solana, которые изменят поведение, обернуты функциональными воротами и отключены по умолчанию. Затем инструменты Solana используются для активации функции, которая помечает ее как ожидающую, после того как она будет отмечена как ожидающая, функция будет активирована в следующую эпоху.</p>
<p>Чтобы определить, какие функции активированы, используйте <a href="cli/install-solana-cli-tools/">инструменты командной строки Solana</a>:</p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">solana</span><span> feature status
</span></code></pre>
<p>Если вы столкнулись с проблемами, сначала убедитесь, что версия инструментов Solana, которую вы используете, соответствует версии, возвращаемой <code>solana cluster-version</code>. Если они не совпадают <a href="cli/install-solana-cli-tools/">установите правильный набор инструментов</a>.</p>










<script src="https://giscus.app/client.js"
    data-repo="dudochkin-victor&#x2F;dudochkin-victor.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzNzgwNTYx"
    data-category="General"
    data-category-id="DIC_kwDOADmv0c4CAhvj"
    data-mapping="pathname"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-theme="light"
    data-lang="en"
    crossorigin="anonymous"
    async>
</script>



        </div>

        
        
    </main>

    
    <footer>
        <small class="subtext">
            <a href="https://angular-rust.github.io">Dudochkin Victor</a> © 2021
        </small>
    </footer>
    
</body>
<script>
    function highlightNav(heading) {
        let pathname = location.pathname;
        document.querySelectorAll(".toc a").forEach((item) => {
            item.classList.remove("active");
        });
        document.querySelector(".toc a[href$='" + pathname + "#" + heading + "']").classList.add("active");
    }

    let currentHeading = "";
    window.onscroll = function () {
        let h = document.querySelectorAll("h1,h2,h3,h4,h5,h6");
        let elementArr = [];

        h.forEach(item => {
            if (item.id !== "") {
                elementArr[item.id] = item.getBoundingClientRect().top;
            }
        });
        elementArr.sort();
        for (let key in elementArr) {
            if (!elementArr.hasOwnProperty(key)) {
                continue;
            }
            if (elementArr[key] > 0 && elementArr[key] < 300) {
                if (currentHeading !== key) {
                    highlightNav(key);
                    currentHeading = key;
                }
                break;
            }
        }
    }
</script>

</html>
