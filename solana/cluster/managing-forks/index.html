<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Управление форками | Dudochkin Victor </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="google-site-verification" content="Kepqb6k6uptlwngnHbBVJmqQtwNW8zfHyQBbTXLYAgA" />
    <meta name="yandex-verification" content="8e8bc73c2566b473" />
    <style>
    :root {
        /* Primary theme color */
        /* --primary-color: #121A26; */
        --primary-color: #0f1419;
        /* Primary theme text color */
        /* --primary-text-color: #121A26; */
        --primary-text-color: #0f1419;
        /* Primary theme link color */
        --primary-link-color: #053961;
        /* Secondary color: the background body color */
        --secondary-color: #F0F0F0;
        --secondary-text-color: #1C2834;
        /* Highlight text color of table of content */
        --toc-highlight-text-color: #053961;
    }
</style>
    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-47MMPLLY44"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-47MMPLLY44');
    </script>
    

    
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
    
        ym('87064264', "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true
        });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/87064264" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    
    
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/mdl.min.css">
    <link rel="stylesheet" href="https://dudochkin-victor.github.io/style.css">
    
    
</head>

<body>
    
<header class="box-shadow">
    

<a href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;">
    <div class="logo">
        <img src="https://dudochkin-victor.github.io/ferris.png" alt="logo">
        Dudochkin Victor
    </div>
</a>

<nav>
    <!-- 
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;showcases&#x2F;">Showcases</a>
    
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;changelog&#x2F;">Changelog</a>
    
    <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;dudochkin-victor.github.io&#x2F;about&#x2F;">About</a>
     -->

    
        
        <a class="nav-item subtitle-text" href="&#x2F;solana&#x2F;">Solana</a>
        
        <a class="nav-item subtitle-text" href="&#x2F;edgeware&#x2F;">Edgeware</a>
        
        <a class="nav-item subtitle-text" href="&#x2F;blog&#x2F;">Блог</a>
        
        <a class="nav-item subtitle-text" href="https:&#x2F;&#x2F;github.com&#x2F;dudochkin-victor">Github</a>
        
    
</nav>

</header>

 
    <main>
        
        
        
        
        
        <div class="toc">
            <div class="toc-sticky">
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/cluster/managing-forks/#aktivnye-forki">Активные форки</a>
                </div>
                
                
                <div class="toc-item">
                    <a class="subtext" href="https://dudochkin-victor.github.io/solana/cluster/managing-forks/#obrezka-i-razdavlivanie">Обрезка и раздавливание</a>
                </div>
                
                
            </div>
        </div>
        
        

        <div class="content text">
            
<h1>Управление форками</h1>

<p>Регистру разрешено разветвляться на границах слотов. Результирующая структура данных образует дерево, называемое <em>blockstore</em>. Когда валидатор интерпретирует хранилище блоков, он должен поддерживать состояние для каждого форка в цепочке. Мы называем каждый экземпляр <em>active fork</em>. Валидатор несет ответственность за взвешивание этих вилок, чтобы в конечном итоге выбрать вилку.</p>
<p>Валидатор выбирает форк, отдавая голос лидеру слота на этом форке. Голосование фиксирует валидатор на время, называемое <em>периодом блокировки</em>. Валидатору не разрешается голосовать за другую вилку, пока не истечет этот период блокировки. Каждое последующее голосование на одном и том же форке удваивает продолжительность периода блокировки. После определенного кластером количества голосов (в настоящее время 32) продолжительность периода блокировки достигает так называемого <em>max lockout</em>. Пока не будет достигнута максимальная блокировка, валидатор может дождаться окончания периода блокировки, а затем проголосовать за другой форк. Когда он голосует за другой форк, он выполняет операцию, называемую <em>rollback</em>, посредством которой состояние откатывается во времени к общей контрольной точке, а затем переходит к вершине форка, за который он только что проголосовал. Максимальное расстояние, на которое может откатиться вилка, называется глубиной отката. Глубина отката — это количество голосов, необходимое для достижения максимальной блокировки. Всякий раз, когда валидатор голосует, любые контрольные точки за пределами глубины отката становятся недоступными. То есть не существует сценария, при котором валидатору нужно будет откатиться за пределы глубины отката. Поэтому он может безопасно <em>сокращать</em> недостижимые вилки и <em>скваш</em> все контрольные точки за пределами глубины отката в корневую контрольную точку.</p>
<h2 id="aktivnye-forki">Активные форки</h2>
<p>Активная вилка представляет собой последовательность контрольных точек, длина которой как минимум на единицу больше, чем глубина отката. Самая короткая вилка будет иметь длину, ровно на единицу превышающую глубину отката. Например:</p>
<p><img src="/img/forks.svg" alt="Forks" /></p>
<p>Следующие последовательности являются <em>активными вилками</em>:</p>
<ul>
<li>{4, 2, 1}</li>
<li>{5, 2, 1}</li>
<li>{6, 3, 1}</li>
<li>{7, 3, 1}</li>
</ul>
<h2 id="obrezka-i-razdavlivanie">Обрезка и раздавливание</h2>
<p>Валидатор может проголосовать за любую контрольную точку в дереве. На диаграмме выше это все узлы, кроме листьев дерева. После голосования валидатор удаляет узлы, которые разветвляются на расстоянии, превышающем глубину отката, а затем использует возможность минимизировать использование памяти, помещая любые узлы, которые он может, в корень.</p>
<p>Начиная с приведенного выше примера, с глубиной отката 2, рассмотрим голосование по 5 против голосования по 6. Во-первых, голосование по 5:</p>
<p><img src="/img/forks-pruned.svg" alt="Forks after pruning" /></p>
<p>Новый корень равен 2, и любые активные ответвления, не являющиеся потомками от 2, удаляются.</p>
<p>В качестве альтернативы, голосование по 6:</p>
<p><img src="/img/forks-pruned2.svg" alt="Forks" /></p>
<p>Дерево остается с корнем 1, так как активная вилка, начинающаяся с 6, находится всего в 2 контрольных точках от корня.</p>










<script src="https://giscus.app/client.js"
    data-repo="dudochkin-victor&#x2F;dudochkin-victor.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzNzgwNTYx"
    data-category="General"
    data-category-id="DIC_kwDOADmv0c4CAhvj"
    data-mapping="pathname"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-theme="light"
    data-lang="en"
    crossorigin="anonymous"
    async>
</script>



        </div>

        
        
    </main>

    
    <footer>
        <small class="subtext">
            <a href="https://angular-rust.github.io">Dudochkin Victor</a> © 2021
        </small>
    </footer>
    
</body>
<script>
    function highlightNav(heading) {
        let pathname = location.pathname;
        document.querySelectorAll(".toc a").forEach((item) => {
            item.classList.remove("active");
        });
        document.querySelector(".toc a[href$='" + pathname + "#" + heading + "']").classList.add("active");
    }

    let currentHeading = "";
    window.onscroll = function () {
        let h = document.querySelectorAll("h1,h2,h3,h4,h5,h6");
        let elementArr = [];

        h.forEach(item => {
            if (item.id !== "") {
                elementArr[item.id] = item.getBoundingClientRect().top;
            }
        });
        elementArr.sort();
        for (let key in elementArr) {
            if (!elementArr.hasOwnProperty(key)) {
                continue;
            }
            if (elementArr[key] > 0 && elementArr[key] < 300) {
                if (currentHeading !== key) {
                    highlightNav(key);
                    currentHeading = key;
                }
                break;
            }
        }
    }
</script>

</html>
